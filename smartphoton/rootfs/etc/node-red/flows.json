[
    {
        "id": "c5cecf2230500b9a",
        "type": "tab",
        "label": "Warning - Avertissement",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2bcb2eaae1dc68e3",
        "type": "tab",
        "label": "Config",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "be5edd3034bf892f",
        "type": "tab",
        "label": "mqtt_ha",
        "disabled": false,
        "info": "Definir la correspondance avec ha",
        "env": []
    },
    {
        "id": "32d802144ee0875f",
        "type": "tab",
        "label": "Voltronic",
        "disabled": false,
        "info": ""
    },
    {
        "id": "66692b8d9715fc59",
        "type": "group",
        "z": "32d802144ee0875f",
        "name": "Boucle d'acquisition des données de l'onduleur.",
        "style": {
            "stroke": "#0070c0",
            "label": true,
            "color": "#0070c0"
        },
        "nodes": [
            "494546931c642171",
            "2a1ae6354e3e82fc",
            "fb55b2e9876002e5",
            "66d8ce3eb3df562a",
            "c46bba48725a7c7b",
            "048161c342e3b83c",
            "3145a80e45f7d3be",
            "a52dbd3db16c7b47",
            "b22c0cf4954eccef"
        ],
        "x": 574,
        "y": -21,
        "w": 552,
        "h": 222
    },
    {
        "id": "e7bbe1762d32303e",
        "type": "group",
        "z": "32d802144ee0875f",
        "name": "Analyse des réponses provenant de l'onduleur",
        "style": {
            "stroke": "#0070c0",
            "label": true,
            "color": "#0070c0"
        },
        "nodes": [
            "394fae8b341ca3dc",
            "8ba013a847b39d93",
            "218e550a06f8765b",
            "9355216312bfe912",
            "a617d17752d34864",
            "ee63eb1e9fe50b88",
            "9d9541adb4b07967",
            "9fe3c612a10376d0",
            "024340133e946a50"
        ],
        "x": 34,
        "y": 679,
        "w": 1092,
        "h": 222
    },
    {
        "id": "0f0cc34971cbd42b",
        "type": "group",
        "z": "2bcb2eaae1dc68e3",
        "name": "mqtt connect",
        "style": {
            "label": true
        },
        "nodes": [
            "ce97985d838afea2",
            "1e479514e95c070d",
            "0cb6ea165d96940f",
            "c94bc612b6815bb9",
            "54ba829b6910d2b4",
            "64c818fd3c742a69",
            "e9846cde1f98b1ac",
            "a5d252f6e7438157",
            "57952602e34db6ab",
            "1dded61e825c54ac"
        ],
        "x": 14,
        "y": 279,
        "w": 1092,
        "h": 222
    },
    {
        "id": "ee6f162b5f9f9c18",
        "type": "group",
        "z": "2bcb2eaae1dc68e3",
        "name": "Copie du config.json pour la version node red",
        "style": {
            "label": true
        },
        "nodes": [
            "9867dbf498b3a315",
            "899cc032477c9921"
        ],
        "x": 14,
        "y": 171.5,
        "w": 1092,
        "h": 97
    },
    {
        "id": "e4f7a7ca05b15835",
        "type": "group",
        "z": "32d802144ee0875f",
        "name": "Retour mqtt",
        "style": {
            "label": true
        },
        "nodes": [
            "0d6ae415d8d9761c",
            "73bdfb75737622b7",
            "28bb4da3aead9cb0",
            "010593246c088110",
            "fdea8bd29f439fe1",
            "988aabfd9de45b0d",
            "9af4e59534a9f1d0",
            "eaaa0f0faf58fbea"
        ],
        "x": 34,
        "y": 959,
        "w": 1092,
        "h": 122
    },
    {
        "id": "fadbd7bea4084175",
        "type": "group",
        "z": "32d802144ee0875f",
        "name": "Requête + Firmware. 1 fois au démarrage de NR",
        "style": {
            "stroke": "#0070c0",
            "label": true,
            "color": "#0070c0"
        },
        "nodes": [
            "f01b7452f9cd5bdf",
            "f6bd0e7e3dfb7856",
            "20daf792de563b06",
            "6935b6e0a599d7b2"
        ],
        "x": 34,
        "y": -1,
        "w": 522,
        "h": 82
    },
    {
        "id": "80ce9def58d73fae",
        "type": "group",
        "z": "32d802144ee0875f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6d3f58fcc31852f0",
            "9dfc1e6110354e33",
            "7869ae33f0a63238",
            "830f999d7ccf1a5f",
            "e98702b905e4a183",
            "09f79937aa931c75",
            "5a6c4281354788fb",
            "5c9f282f252bcdf8",
            "b1ac024e439f5649",
            "b6bdf402fae56196",
            "f1d39c7f15ba3e49",
            "4a2c1162e2839b16"
        ],
        "x": 554,
        "y": 359,
        "w": 572,
        "h": 282
    },
    {
        "id": "fae6c177e5eeb6fd",
        "type": "group",
        "z": "2bcb2eaae1dc68e3",
        "name": "Configuration des serials",
        "style": {
            "label": true
        },
        "nodes": [
            "2a552d0ce10aa774",
            "6015bce9bdc37949",
            "e29e7f22e0807b3a",
            "0c60c89630ec5c55",
            "8177dadee98e7cba",
            "363c5902f5716214",
            "b7386e59d513deb1",
            "3d655ad7bf8b6957",
            "83afc6ed603358e7",
            "6a0c066aa0717486",
            "51a9b8b10a122c81",
            "085feea111bab93b",
            "2195c3ef1bff6160",
            "880326e5b404164d",
            "953378928c75ec42",
            "110a4f0fe1149cf6",
            "6d5fa1bcc9a01d99",
            "538983c76a518f18",
            "7e7d4b03c274aac5"
        ],
        "x": 14,
        "y": 519,
        "w": 1092,
        "h": 282
    },
    {
        "id": "4b5e06deed959dc2",
        "type": "group",
        "z": "2bcb2eaae1dc68e3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "703658b48b52b481",
            "1592909b5161fd16",
            "1c6ea872889fe458"
        ],
        "x": 14,
        "y": 1019,
        "w": 1092,
        "h": 82
    },
    {
        "id": "02d3f3a187bb86ca",
        "type": "group",
        "z": "be5edd3034bf892f",
        "name": "Onduleur",
        "style": {
            "label": true,
            "stroke": "#ffbfbf",
            "fill": "#ffbfbf",
            "fill-opacity": "0.5"
        },
        "nodes": [
            "ffac427dac22494c",
            "f2dd87f830eab9cd",
            "371006d1cb186f75",
            "fdbd9d4b67ecad4c",
            "60e82e0320bcc250",
            "cb13017736294c50",
            "896fde51881f1688",
            "33295ebe24d36f67",
            "0eed961303067a05",
            "6cf215c3cd5a3a1a",
            "c057a81d4adc5666",
            "d20cbedd51b488db",
            "c288144a60c61eb8"
        ],
        "x": 18,
        "y": 213,
        "w": 1068,
        "h": 728
    },
    {
        "id": "5b78bcc7b86527da",
        "type": "group",
        "z": "be5edd3034bf892f",
        "name": "Config",
        "style": {
            "label": true
        },
        "nodes": [
            "4e091108f874f249",
            "49e3867630866e3a",
            "0bbba58084a86127",
            "bc95fac8ab91c063",
            "6afc2ee6a13fec77",
            "86d8a22ffb808c6e",
            "da4c9798c2dec551",
            "c8c9f7e36ef12713",
            "a0611e8e7382c1ba"
        ],
        "x": 24,
        "y": 79,
        "w": 1052,
        "h": 122
    },
    {
        "id": "f2dd87f830eab9cd",
        "type": "group",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "select",
        "style": {
            "label": true
        },
        "nodes": [
            "70c35a8a74bf19ee",
            "668601773355b5ff",
            "6fc675f540e6796a",
            "46b9a4d2f5fa24ea"
        ],
        "x": 44,
        "y": 579,
        "w": 722,
        "h": 82
    },
    {
        "id": "371006d1cb186f75",
        "type": "group",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "sensor",
        "style": {
            "label": true
        },
        "nodes": [
            "18b39c45b3095918",
            "09cdb6c3078a14a3",
            "3dd8752b9b1bf81d",
            "a8cf8c56c50d34d8",
            "13a62580d8ed6e7f",
            "418c68be8bdd4e6b",
            "d6286ee767f2f935",
            "e007bd1d1a5b6786",
            "841469b4f2f24f66",
            "138c3e0a8378849b",
            "a0387da25750b53f"
        ],
        "x": 44,
        "y": 239,
        "w": 722,
        "h": 362
    },
    {
        "id": "cb13017736294c50",
        "type": "group",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "Button",
        "style": {
            "label": true
        },
        "nodes": [
            "7720b4ea744dde26",
            "8c659f224ad78cae",
            "1135ace26c7cb459"
        ],
        "x": 44,
        "y": 679,
        "w": 522,
        "h": 82
    },
    {
        "id": "33295ebe24d36f67",
        "type": "group",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "text",
        "style": {
            "label": true
        },
        "nodes": [
            "409452c2fbfd2d19",
            "1210e3b6c293caa7",
            "cc4a8225e658ad4b"
        ],
        "x": 44,
        "y": 779,
        "w": 522,
        "h": 82
    },
    {
        "id": "db21c60ace45d1da",
        "type": "serial-port",
        "name": "",
        "serialport": "/dev/tty-onduleur",
        "serialbaud": "2400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "\\r",
        "bin": "false",
        "out": "char",
        "addchar": "",
        "responsetimeout": "900"
    },
    {
        "id": "dea3f37bb42d7a81",
        "type": "mqtt-broker",
        "name": "MQTT-Onduleur",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "autoConnect": false,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "1",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "f09d59b81c49a19e",
        "type": "serial-port",
        "name": "",
        "serialport": "/dev/tty-onduleur2",
        "serialbaud": "2400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "\\r",
        "bin": "false",
        "out": "char",
        "addchar": "",
        "responsetimeout": "900"
    },
    {
        "id": "f15ccaad81cb6adf",
        "type": "serial-port",
        "name": "",
        "serialport": "/dev/tty-onduleur3",
        "serialbaud": "2400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "\\r",
        "bin": "false",
        "out": "char",
        "addchar": "",
        "responsetimeout": "900"
    },
    {
        "id": "17ec3ca8d26a381a",
        "type": "serial-port",
        "name": "",
        "serialport": "/dev/tty-onduleur4",
        "serialbaud": "2400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "\\r",
        "bin": "false",
        "out": "char",
        "addchar": "",
        "responsetimeout": "900"
    },
    {
        "id": "f5eebd81e9f35d6c",
        "type": "mqtt-broker",
        "name": "",
        "broker": "MQTT Interne",
        "port": "1883",
        "clientid": "",
        "autoConnect": false,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "5ec2fa39f589b486",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Selon l’article L335-3 du code de la propriété intellectuelle, constitue « un délit de contrefaçon la violation de l’un des droits de l’auteur d’un logiciel définis à l’article L122-6 ».",
        "info": "",
        "x": 590,
        "y": 514,
        "wires": []
    },
    {
        "id": "344919001b0c0527",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Toute atteinte aux droits de l’auteur de logiciel peut donc être qualifiée de contrefaçon.",
        "info": "",
        "x": 320,
        "y": 600,
        "wires": []
    },
    {
        "id": "1ed5075e73b11643",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Ce logiciel est la propriété de JLM & ADC & RF, Il est soumis à la loi sur la propriété intellectuelle et les droits d'auteurs.",
        "info": "",
        "x": 420,
        "y": 134,
        "wires": []
    },
    {
        "id": "86b5a35b7eeb140e",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Il a été conçu pour gérer divers types d'onduleurs et batteries lithium",
        "info": "",
        "x": 260,
        "y": 234,
        "wires": []
    },
    {
        "id": "92288ad8466e2ad2",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "copyright ©JLM 2020 -2021 - 2022",
        "info": "",
        "x": 160,
        "y": 74,
        "wires": []
    },
    {
        "id": "0a751bc311423f38",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Seul les 3 auteurs ont le droit de modifier tout ou partie de ce logiciel",
        "info": "",
        "x": 260,
        "y": 314,
        "wires": []
    },
    {
        "id": "a6b6f7887b88b4bc",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Ne pas transmettre, copier ou modifier ce logiciel sans l'acceptation écrite de ses auteurs",
        "info": "",
        "x": 330,
        "y": 414,
        "wires": []
    },
    {
        "id": "9c0595dfd80fe4cd",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "copyright ©JLM & ADC 2023",
        "info": "",
        "x": 440,
        "y": 74,
        "wires": []
    },
    {
        "id": "11378b0e94958b12",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "copyright ©JLM & ADC & RF  2023",
        "info": "",
        "x": 720,
        "y": 74,
        "wires": []
    },
    {
        "id": "71f62c7ee0c85a1c",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "réglementation",
        "info": "# réglementation",
        "x": 100,
        "y": 20,
        "wires": []
    },
    {
        "id": "a1efd507462b8a8d",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "This software is the property of JLM & ADC & RF, and is subject to intellectual property and copyright laws.",
        "info": "",
        "x": 580,
        "y": 176,
        "wires": []
    },
    {
        "id": "17d67c052c2e91d2",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "It has been designed to manage various types of inverters and lithium batteries",
        "info": "",
        "x": 490,
        "y": 276,
        "wires": []
    },
    {
        "id": "8cb110937de31b03",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Only the 3 authors have the right to modify all or part of this software.",
        "info": "",
        "x": 460,
        "y": 356,
        "wires": []
    },
    {
        "id": "e351785631d4e5ae",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Do not transmit, copy or modify this software without the written consent of its authors.",
        "info": "",
        "x": 520,
        "y": 456,
        "wires": []
    },
    {
        "id": "7fda9f03c710a022",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "According to article L335-3 of the French Intellectual Property Code, “infringement of one of the rights of the author of a software program as defined in article L122-6” constitutes an offence of counterfeiting.",
        "info": "",
        "x": 890,
        "y": 556,
        "wires": []
    },
    {
        "id": "e84eb03154a7bb69",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "Any infringement of a software author's rights can therefore be qualified as counterfeiting.",
        "info": "",
        "x": 530,
        "y": 656,
        "wires": []
    },
    {
        "id": "43c1dc45fce687a5",
        "type": "comment",
        "z": "c5cecf2230500b9a",
        "name": "regulations",
        "info": "# regulations",
        "x": 280,
        "y": 20,
        "wires": []
    },
    {
        "id": "deb898a60168f5bc",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "19793095a8ad163f"
            ]
        ]
    },
    {
        "id": "19793095a8ad163f",
        "type": "file in",
        "z": "2bcb2eaae1dc68e3",
        "name": "",
        "filename": "/data/options.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 390,
        "y": 80,
        "wires": [
            [
                "1f1fdeb02c82a89b"
            ]
        ]
    },
    {
        "id": "1f1fdeb02c82a89b",
        "type": "json",
        "z": "2bcb2eaae1dc68e3",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 80,
        "wires": [
            [
                "6ca7719ceb3ad52d",
                "8f0cd89a86a5fa89"
            ]
        ]
    },
    {
        "id": "6ca7719ceb3ad52d",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "name": "Config global variable",
        "func": "let count = msg.payload.listonduleur.length //compte le nombre de usb\nglobal.set('countUSBOnduleur', count); //nombre d'onduleur\n\n//ajoute les config onduleur au globals\nfor (let i = 0; i < count; i++) {\n  let j = i + 1; //ajoute +1 pour demarrer a 1\n  let chemin = msg.payload.listonduleur[i].chemin;\n  let type = msg.payload.listonduleur[i].type\n  let onduleur = msg.payload.listonduleur[i].onduleur\n  let qpgs = (msg.payload.listonduleur[i].multionduleur == undefined) ? true : msg.payload.listonduleur[i].multionduleur;\n  let full = (msg.payload.listonduleur[i].full == undefined) ? true : msg.payload.listonduleur[i].full;\n  let battTension = (msg.payload.listonduleur[i].battTension == undefined) ? 48 : msg.payload.listonduleur[i].battTension\n\n  if (msg.payload.listonduleur[i].chemin != \"false\") {\n    //futur config\n    global.set('onduleurs.onduleur_' + j + '.active', true);\n    global.set('onduleurs.onduleur_' + j + '.id', j);\n    global.set('onduleurs.onduleur_' + j + '.chemin', chemin);\n    global.set('onduleurs.onduleur_' + j + '.ComType', type);\n    global.set('onduleurs.onduleur_' + j + '.type', onduleur);\n    global.set('onduleurs.onduleur_' + j + '.qpgs', qpgs);\n    global.set('onduleurs.onduleur_' + j + '.full', full);\n    global.set('onduleurs.onduleur_' + j + '.battTension', battTension);\n  }\n}\n\n//Parametre généraux\nglobal.set(\"parametre.Version\", msg.payload.version);\nglobal.set(\"parametre.config.interval\", msg.payload.interval); //2 secondes\nglobal.set(\"parametre.config.intervalBatt\", msg.payload.intervalBatt); // 7000 ms pour 7 secondes\nglobal.set(\"parametre.config.debug\", msg.payload.debug);\n\n//Nom Personalisé Onduleur\nglobal.set(\"name.Onduleur\", msg.payload.nameEntities.nameOnduleur);\nglobal.set(\"name.PV\", msg.payload.nameEntities.namePV);\nglobal.set(\"name.PV2\", msg.payload.nameEntities.namePV2);\nglobal.set(\"name.Batt_charge\", msg.payload.nameEntities.nameBatt_charge);\nglobal.set(\"name.Batt_batt_decharge\", msg.payload.nameEntities.nameBatt_batt_decharge);\nglobal.set(\"name.Batt_batt_chargedecharge\", msg.payload.nameEntities.nameBatt_batt_chargedecharge);\nglobal.set(\"name.Conso_maison\", msg.payload.nameEntities.nameConso_maison);\nglobal.set(\"name.conso_grid\", msg.payload.nameEntities.nameGrid_power);\nglobal.set(\"name.GridTension\", msg.payload.nameEntities.nameGridTension);\nglobal.set(\"name.BattTensiont\", msg.payload.nameEntities.nameBattTensiont);\nglobal.set(\"name.PvTensiont\", msg.payload.nameEntities.namePvTensiont);\nglobal.set(\"name.Pv2Tensiont\", msg.payload.nameEntities.namePv2Tensiont);\nglobal.set(\"name.OnduleurTension\", msg.payload.nameEntities.nameOnduleurTension);\nglobal.set(\"name.PvIntensite\", msg.payload.nameEntities.namePvIntensite);\nglobal.set(\"name.Pv2Intensite\", msg.payload.nameEntities.namePv2Intensite);\nglobal.set(\"name.BattChargeIntensite\", msg.payload.nameEntities.nameBattChargeIntensite);\nglobal.set(\"name.BattDechargeIntensite\", msg.payload.nameEntities.nameBattDechargeIntensite);\nglobal.set(\"name.OnduleurFrequency\", msg.payload.nameEntities.nameOnduleurFrequency);\nglobal.set(\"name.DataFrequency\", msg.payload.nameEntities.nameDataFrequency);\nglobal.set(\"name.BattCapacite\", msg.payload.nameEntities.nameBattCapacite);\nglobal.set(\"name.Mode\", msg.payload.nameEntities.nameMode);\nglobal.set(\"name.Temp\", msg.payload.nameEntities.nameTemp);\nglobal.set(\"name.Param01\", msg.payload.nameEntities.nameParam01);\nglobal.set(\"name.Param02\", msg.payload.nameEntities.nameParam02);\nglobal.set(\"name.Param05\", msg.payload.nameEntities.nameParam05);\nglobal.set(\"name.Param11\", msg.payload.nameEntities.nameParam11);\nglobal.set(\"name.Param12\", msg.payload.nameEntities.nameParam12);\nglobal.set(\"name.Param13\", msg.payload.nameEntities.nameParam13);\nglobal.set(\"name.Param16\", msg.payload.nameEntities.nameParam16);\nglobal.set(\"name.Param26\", msg.payload.nameEntities.nameParam26);\nglobal.set(\"name.Param27\", msg.payload.nameEntities.nameParam27);\nglobal.set(\"name.Param29\", msg.payload.nameEntities.nameParam29);\n\n//lovelace\nglobal.set(\"lovelace.lovelace\", msg.payload.lovelace); //Lovelace true/false\nglobal.set(\"lovelace.panneaux\", msg.payload.panneaux); //Lovelace nom panneau\nglobal.set(\"lovelace.batteries\", msg.payload.batteries); //Lovelace nom batteries\n\n//mqtt patrametre\nglobal.set(\"parametre.mqtt.Adresse\", msg.payload.mqtt.mqttadresse); //type d'batterie\nglobal.set(\"parametre.mqtt.Port\", msg.payload.mqtt.mqttport); //type d'batterie\nglobal.set(\"parametre.mqtt.Login\", msg.payload.mqtt.mqttuser); //type d'batterie\nglobal.set(\"parametre.mqtt.Password\", msg.payload.mqtt.mqttpass); //type d'batterie\nglobal.set(\"parametre.mqtt.DirSmart\", \"smartphoton\");\n\nif (msg.payload.mqtt.mqttInterne != undefined) {\n  global.set(\"mqttInterne\", msg.payload.mqtt.mqttInterne);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 80,
        "wires": [
            [
                "292d5ba57764dabf"
            ]
        ]
    },
    {
        "id": "292d5ba57764dabf",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "name": "debug 97",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 80,
        "wires": []
    },
    {
        "id": "3925f7d7faa2c1b1",
        "type": "file in",
        "z": "2bcb2eaae1dc68e3",
        "name": "Fichier exemple de config",
        "filename": "/media/smartphotonOptionsExemple.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 370,
        "y": 120,
        "wires": [
            [
                "1f1fdeb02c82a89b",
                "2a450978fdb9ac50"
            ]
        ]
    },
    {
        "id": "ce97985d838afea2",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "connect",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 320,
        "wires": [
            [
                "1e479514e95c070d"
            ]
        ]
    },
    {
        "id": "1e479514e95c070d",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "function 2",
        "func": "msg.action = \"connect\";\nmsg.broker = '{\"broker\":\"' + global.get(\"parametre.mqtt.Adresse\")+'\",'\n    + '\"port\":\"' + global.get(\"parametre.mqtt.Port\")+'\",'\n    + '\"username\":\"' + global.get(\"parametre.mqtt.Login\")+'\",'\n    + '\"password\":\"' + global.get(\"parametre.mqtt.Password\")+'\"'\n    +'}';\nreturn msg\n\n//NOLAK\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 320,
        "wires": [
            [
                "54ba829b6910d2b4"
            ]
        ]
    },
    {
        "id": "0cb6ea165d96940f",
        "type": "mqtt out",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "MQTT external broker",
        "topic": "",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "dea3f37bb42d7a81",
        "x": 980,
        "y": 360,
        "wires": []
    },
    {
        "id": "c94bc612b6815bb9",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "disconnect",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "action",
                "v": "disconnect",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 360,
        "wires": [
            [
                "0cb6ea165d96940f"
            ]
        ]
    },
    {
        "id": "54ba829b6910d2b4",
        "type": "json",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "",
        "property": "broker",
        "action": "",
        "pretty": false,
        "x": 710,
        "y": 320,
        "wires": [
            [
                "0cb6ea165d96940f"
            ]
        ]
    },
    {
        "id": "64c818fd3c742a69",
        "type": "link in",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "vers mqtt",
        "links": [
            "86d8a22ffb808c6e",
            "9355216312bfe912",
            "fdbd9d4b67ecad4c"
        ],
        "x": 725,
        "y": 400,
        "wires": [
            [
                "0cb6ea165d96940f",
                "e9846cde1f98b1ac"
            ]
        ]
    },
    {
        "id": "9867dbf498b3a315",
        "type": "exec",
        "z": "2bcb2eaae1dc68e3",
        "d": true,
        "g": "ee6f162b5f9f9c18",
        "command": "cp /data/options.json /media/smartphotonOptionsExemple.json",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 850,
        "y": 220,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "899cc032477c9921",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "ee6f162b5f9f9c18",
        "name": "Récupération config dans addon",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 220,
        "wires": [
            [
                "9867dbf498b3a315"
            ]
        ]
    },
    {
        "id": "8f0cd89a86a5fa89",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "name": "debug 164",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 120,
        "wires": []
    },
    {
        "id": "703658b48b52b481",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "4b5e06deed959dc2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 1060,
        "wires": [
            [
                "1592909b5161fd16"
            ]
        ]
    },
    {
        "id": "1592909b5161fd16",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "4b5e06deed959dc2",
        "name": "Purge variable",
        "func": "global.set(\"onduleurs\", undefined);\nglobal.set(\"batteries\", undefined);\n\nglobal.set(\"qpig\", undefined);\nglobal.set(\"qpigs2\", undefined);\nglobal.set(\"qbeqi\", undefined);\nglobal.set(\"qflag\", undefined);\nglobal.set(\"qpiws\", undefined);\nglobal.set(\"QID\", undefined);\nglobal.set(\"QSID\", undefined);\nglobal.set(\"QVFW\", undefined);\nglobal.set('onduleurs', undefined);\n\n\nfor (let i = 0; i <= 50; i++) {\n\n    for (let q = 0; q < 10; q++) {\n     global.set(i + 'qpgs' + q, undefined);\n     msg.payload = i + 'qpgs' + q;\n     node.send(msg);\n    }\n\n    global.set('qpgs' + i, undefined);\n    global.set('onduleur' + i, undefined);\n    global.set('onduleurqpgs' + i, undefined);\n    global.set('onduleurUsbPort' + i, undefined);\n    global.set('onduleurComType' + i, undefined);\n    global.set('onduleurType' + i, undefined);\n\n\n    global.set('batterie' + i, undefined);\n    global.set('batterieComType' + i, undefined);\n    global.set('batterieComType' + i, undefined);\n    global.set('battTension' + i, undefined);\n\n\n}\n\n\n//Nom Personalisé Onduleur a suppr\nglobal.set(\"nameOnduleur\", undefined); \nglobal.set(\"namePV\", undefined);\nglobal.set(\"namePV2\", undefined);\nglobal.set(\"nameBatt_charge\", undefined);\nglobal.set(\"nameBatt_batt_decharge\", undefined);\nglobal.set(\"nameBatt_batt_chargedecharge\", undefined);\nglobal.set(\"nameConso_maison\", undefined);\nglobal.set(\"nameGridTension\", undefined);\nglobal.set(\"nameBattTensiont\", undefined);\nglobal.set(\"namePvTensiont\", undefined);\nglobal.set(\"namePv2Tensiont\", undefined);\nglobal.set(\"nameOnduleurTension\", undefined);\nglobal.set(\"namePvIntensite\", undefined);\nglobal.set(\"namePv2Intensite\", undefined);\nglobal.set(\"nameBattChargeIntensite\", undefined);\nglobal.set(\"nameBattDechargeIntensite\", undefined);\nglobal.set(\"nameOnduleurFrequency\", undefined);\nglobal.set(\"nameDataFrequency\", undefined);\nglobal.set(\"nameBattCapacite\", undefined);\nglobal.set(\"nameMode\", undefined);\nglobal.set(\"nameTemp\", undefined);\nglobal.set(\"nameParam01\", undefined);\nglobal.set(\"nameParam02\", undefined);\nglobal.set(\"nameParam05\", undefined);\nglobal.set(\"nameParam11\", undefined);\nglobal.set(\"nameParam12\", undefined);\nglobal.set(\"nameParam13\", undefined);\nglobal.set(\"nameParam16\", undefined);\nglobal.set(\"nameParam26\", undefined);\nglobal.set(\"nameParam27\", undefined);\nglobal.set(\"nameParam29\", undefined);\n\n//A suppr\nglobal.set(\"onduleurType\", msg.payload.onduleur); //A suppr\nglobal.set(\"onduleurType\", undefined); //A suppr\nglobal.set(\"onduleurComType\", undefined); //A suppr\nglobal.set(\"onduleurUsbPort\", undefined); //A suppr\nglobal.set(\"qpigs2\", undefined); //A suppr\n\nglobal.set(\"mqttAdresse\", undefined); //A suppr\nglobal.set(\"mqttPort\", undefined); //A suppr\nglobal.set(\"mqttLogin\", undefined); //A suppr\nglobal.set(\"mqttPassword\", undefined); //A suppr\nglobal.set(\"mqttDirSmart\", undefined);\n//A suppr",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1060,
        "wires": [
            [
                "1c6ea872889fe458"
            ]
        ]
    },
    {
        "id": "1c6ea872889fe458",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "g": "4b5e06deed959dc2",
        "name": "debug 168",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 1060,
        "wires": []
    },
    {
        "id": "2a552d0ce10aa774",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1.3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 760,
        "wires": [
            [
                "e29e7f22e0807b3a",
                "b7386e59d513deb1",
                "51a9b8b10a122c81",
                "953378928c75ec42"
            ]
        ]
    },
    {
        "id": "6015bce9bdc37949",
        "type": "serial control",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "",
        "serial": "db21c60ace45d1da",
        "x": 630,
        "y": 560,
        "wires": [
            [
                "8177dadee98e7cba"
            ]
        ]
    },
    {
        "id": "e29e7f22e0807b3a",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "serial onduleur",
        "func": "if (global.get(\"onduleurs.onduleur_1.ComType\") == \"serial\" && global.get(\"onduleurs.onduleur_1.type\") == \"voltronic\"){\n    msg.payload = {\n    \"serialport\": global.get(\"onduleurs.onduleur_1.chemin\"),\n    \"serialbaud\": 2400,\n    \"databits\": 8,\n    \"parity\": \"none\",\n    \"stopbits\": 1,\n    \"enabled\": true\n    }\n\n    node.send(msg);\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 560,
        "wires": [
            [
                "6015bce9bdc37949"
            ]
        ]
    },
    {
        "id": "0c60c89630ec5c55",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "debug 162",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 560,
        "wires": []
    },
    {
        "id": "8177dadee98e7cba",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "function 61",
        "func": "msg.payload = \"Changement \" + global.get(\"onduleurs.onduleur_1.type\") + \" 1 sur serial \" + global.get(\"onduleurs.onduleur_1.chemin\"); //NOLAK\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 560,
        "wires": [
            [
                "0c60c89630ec5c55"
            ]
        ]
    },
    {
        "id": "363c5902f5716214",
        "type": "serial control",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "",
        "serial": "f09d59b81c49a19e",
        "x": 630,
        "y": 600,
        "wires": [
            [
                "83afc6ed603358e7"
            ]
        ]
    },
    {
        "id": "b7386e59d513deb1",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "serial onduleur",
        "func": "if (global.get(\"onduleurs.onduleur_2.ComType\") == \"serial\" && global.get(\"onduleurs.onduleur_2.type\") == \"voltronic\") {\n    msg.payload = {\n        \"serialport\": global.get(\"onduleurs.onduleur_2.chemin\"),\n        \"serialbaud\": 2400,\n        \"databits\": 8,\n        \"parity\": \"none\",\n        \"stopbits\": 1,\n        \"enabled\": true\n    }\n\n    node.send(msg);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 600,
        "wires": [
            [
                "363c5902f5716214"
            ]
        ]
    },
    {
        "id": "3d655ad7bf8b6957",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "debug 165",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 600,
        "wires": []
    },
    {
        "id": "83afc6ed603358e7",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "function 63",
        "func": "msg.payload = \"Changement \" + global.get(\"onduleurs.onduleur_2.type\") + \" 2 sur serial \" + global.get(\"onduleurs.onduleur_2.chemin\"); //NOLAK\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 600,
        "wires": [
            [
                "3d655ad7bf8b6957"
            ]
        ]
    },
    {
        "id": "6a0c066aa0717486",
        "type": "serial control",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "",
        "serial": "f15ccaad81cb6adf",
        "x": 630,
        "y": 640,
        "wires": [
            [
                "2195c3ef1bff6160"
            ]
        ]
    },
    {
        "id": "51a9b8b10a122c81",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "serial onduleur",
        "func": "if (global.get(\"onduleurs.onduleur_3.ComType\") == \"serial\" && global.get(\"onduleurs.onduleur_3.type\") == \"voltronic\") {\n    msg.payload = {\n        \"serialport\": global.get(\"onduleurs.onduleur_3.chemin\"),\n        \"serialbaud\": 2400,\n        \"databits\": 8,\n        \"parity\": \"none\",\n        \"stopbits\": 1,\n        \"enabled\": true\n    }\n\n    node.send(msg);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 640,
        "wires": [
            [
                "6a0c066aa0717486"
            ]
        ]
    },
    {
        "id": "085feea111bab93b",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "debug 166",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 640,
        "wires": []
    },
    {
        "id": "2195c3ef1bff6160",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "function 64",
        "func": "msg.payload = \"Changement \" + global.get(\"onduleurs.onduleur_3.type\") + \" 3 sur serial \" + global.get(\"onduleurs.onduleur_3.chemin\"); //NOLAK\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 640,
        "wires": [
            [
                "085feea111bab93b"
            ]
        ]
    },
    {
        "id": "880326e5b404164d",
        "type": "serial control",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "",
        "serial": "17ec3ca8d26a381a",
        "x": 630,
        "y": 680,
        "wires": [
            [
                "6d5fa1bcc9a01d99"
            ]
        ]
    },
    {
        "id": "953378928c75ec42",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "serial onduleur",
        "func": "if (global.get(\"onduleurs.onduleur_4.ComType\") == \"serial\" && global.get(\"onduleurs.onduleur_4.type\") == \"voltronic\") {\n    msg.payload = {\n        \"serialport\": global.get(\"onduleurs.onduleur_4.chemin\"),\n        \"serialbaud\": 2400,\n        \"databits\": 8,\n        \"parity\": \"none\",\n        \"stopbits\": 1,\n        \"enabled\": true\n    }\n\n    node.send(msg);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 680,
        "wires": [
            [
                "880326e5b404164d"
            ]
        ]
    },
    {
        "id": "110a4f0fe1149cf6",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "debug 167",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 680,
        "wires": []
    },
    {
        "id": "6d5fa1bcc9a01d99",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "function 65",
        "func": "msg.payload = \"Changement \" + global.get(\"onduleurs.onduleur_4.type\") + \" 4 sur serial \" + global.get(\"onduleurs.onduleur_4.chemin\"); //NOLAK\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 680,
        "wires": [
            [
                "110a4f0fe1149cf6"
            ]
        ]
    },
    {
        "id": "e9846cde1f98b1ac",
        "type": "mqtt out",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "MQTT Interne",
        "topic": "",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f5eebd81e9f35d6c",
        "x": 960,
        "y": 460,
        "wires": []
    },
    {
        "id": "a5d252f6e7438157",
        "type": "inject",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "connect",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 460,
        "wires": [
            [
                "57952602e34db6ab"
            ]
        ]
    },
    {
        "id": "57952602e34db6ab",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "function 84",
        "func": "if(global.get(\"mqttInterne\") == true){\n\n    msg.action = \"connect\";\n    msg.broker = '{\"broker\":\"mosquitto\",'\n        +'\"port\":\"1883\",'\n        +'\"username\":\"smartphoton\",'\n        +'\"password\":\"smartphoton\"'\n        +'}';\n    return msg\n\n}\n//NOLAK\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 460,
        "wires": [
            [
                "1dded61e825c54ac"
            ]
        ]
    },
    {
        "id": "1dded61e825c54ac",
        "type": "json",
        "z": "2bcb2eaae1dc68e3",
        "g": "0f0cc34971cbd42b",
        "name": "",
        "property": "broker",
        "action": "",
        "pretty": false,
        "x": 710,
        "y": 460,
        "wires": [
            [
                "e9846cde1f98b1ac"
            ]
        ]
    },
    {
        "id": "4f6da31e70097b2f",
        "type": "catch",
        "z": "2bcb2eaae1dc68e3",
        "name": "",
        "scope": [
            "6015bce9bdc37949",
            "363c5902f5716214",
            "6a0c066aa0717486",
            "880326e5b404164d",
            "aadd5b24995a151c"
        ],
        "uncaught": false,
        "x": 120,
        "y": 1120,
        "wires": [
            [
                "0c558dddeb621f2f",
                "18e3add362ad449a"
            ]
        ]
    },
    {
        "id": "0c558dddeb621f2f",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "name": "function 93",
        "func": "// Dans le nœud function\nreturn null;  // Cela évitera l'affichage dans les logs",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "18e3add362ad449a",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "name": "debug 198",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 300,
        "y": 1180,
        "wires": []
    },
    {
        "id": "538983c76a518f18",
        "type": "link in",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "Reco onduleur",
        "links": [],
        "x": 65,
        "y": 620,
        "wires": [
            [
                "7e7d4b03c274aac5"
            ]
        ]
    },
    {
        "id": "7e7d4b03c274aac5",
        "type": "function",
        "z": "2bcb2eaae1dc68e3",
        "g": "fae6c177e5eeb6fd",
        "name": "function 94",
        "func": "if (msg.voltronicNum == 1 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial') {\n\n    node.send([msg, , ,]);\n\n}\n\nif (msg.voltronicNum == 2 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial'){\n\n    node.send([,msg,,]);\n\n}\n\nif (msg.voltronicNum == 3 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial'){\n\n    node.send([,,msg,]);       \n          \n}\n\nif (msg.voltronicNum == 4 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial') {\n\n    node.send([,,,msg]);\n          \n}",
        "outputs": 4,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 620,
        "wires": [
            [
                "e29e7f22e0807b3a"
            ],
            [
                "b7386e59d513deb1"
            ],
            [
                "51a9b8b10a122c81"
            ],
            [
                "953378928c75ec42"
            ]
        ]
    },
    {
        "id": "2a450978fdb9ac50",
        "type": "debug",
        "z": "2bcb2eaae1dc68e3",
        "name": "debug 202",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 140,
        "wires": []
    },
    {
        "id": "a30b8863f694b36a",
        "type": "inject",
        "z": "be5edd3034bf892f",
        "name": "start",
        "props": [
            {
                "p": "model",
                "v": "VERSION",
                "vt": "env"
            },
            {
                "p": "manufacturer",
                "v": "Smartphoton",
                "vt": "str"
            },
            {
                "p": "value",
                "v": "{{value}}",
                "vt": "str"
            },
            {
                "p": "configuration_url",
                "v": "https://domosimple.eu",
                "vt": "str"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": true,
        "onceDelay": "20",
        "topic": "",
        "x": 110,
        "y": 40,
        "wires": [
            [
                "0e4f3d1b42c27eb3"
            ]
        ]
    },
    {
        "id": "9869264651c434b4",
        "type": "comment",
        "z": "be5edd3034bf892f",
        "name": "A remplacer par le dernier noeud",
        "info": "",
        "x": 1310,
        "y": 280,
        "wires": []
    },
    {
        "id": "289e93825403d2b3",
        "type": "debug",
        "z": "be5edd3034bf892f",
        "name": "debug 169",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 1000,
        "wires": []
    },
    {
        "id": "a1e14ed690cdf9ef",
        "type": "function",
        "z": "be5edd3034bf892f",
        "name": "chemin",
        "func": "\n\n    msg.chemin = '/homeassistant/.storage/lovelace_dashboards'\n    node.send(msg);\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1000,
        "wires": [
            [
                "5963beb2a9346304"
            ]
        ]
    },
    {
        "id": "5963beb2a9346304",
        "type": "file in",
        "z": "be5edd3034bf892f",
        "name": "",
        "filename": "chemin",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 470,
        "y": 1000,
        "wires": [
            [
                "751261bd20274074"
            ]
        ]
    },
    {
        "id": "b2cfb698f684a10b",
        "type": "inject",
        "z": "be5edd3034bf892f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 1000,
        "wires": [
            [
                "a1e14ed690cdf9ef"
            ]
        ]
    },
    {
        "id": "751261bd20274074",
        "type": "json",
        "z": "be5edd3034bf892f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 610,
        "y": 1000,
        "wires": [
            [
                "a24f572205cf9201",
                "5d458623f1a32fc9"
            ]
        ]
    },
    {
        "id": "a24f572205cf9201",
        "type": "function",
        "z": "be5edd3034bf892f",
        "name": "function 69",
        "func": "\n\n\n\n// Add a new object to the array \nmsg.payload.data.items.push({ \"id\": \"dashboard_smartphoton\", \"show_in_sidebar\": true, \"title\": \"Smartphoton\", \"require_admin\": false, \"mode\": \"storage\", \"url_path\": \"dashboard_smartphoton\" });\n\nnode.send(msg);\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1000,
        "wires": [
            [
                "0f5b8a7195f54d5e"
            ]
        ]
    },
    {
        "id": "5d458623f1a32fc9",
        "type": "debug",
        "z": "be5edd3034bf892f",
        "name": "debug 170",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 1040,
        "wires": []
    },
    {
        "id": "0f5b8a7195f54d5e",
        "type": "file",
        "z": "be5edd3034bf892f",
        "name": "",
        "filename": "chemin",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 960,
        "y": 1000,
        "wires": [
            [
                "289e93825403d2b3"
            ]
        ]
    },
    {
        "id": "0e4f3d1b42c27eb3",
        "type": "link out",
        "z": "be5edd3034bf892f",
        "name": "link out 31",
        "mode": "link",
        "links": [
            "6afc2ee6a13fec77",
            "138c3e0a8378849b",
            "6fc675f540e6796a",
            "1135ace26c7cb459",
            "cc4a8225e658ad4b",
            "0eed961303067a05"
        ],
        "x": 285,
        "y": 40,
        "wires": []
    },
    {
        "id": "ffac427dac22494c",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "homeassistant/{{type_ha}}/{{onduleurType}}_{{ha_num_onduleur}}{{ha_num_qpgs}}/{{onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}/config",
        "output": "str",
        "x": 880,
        "y": 400,
        "wires": [
            [
                "fdbd9d4b67ecad4c"
            ]
        ]
    },
    {
        "id": "70c35a8a74bf19ee",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "f2dd87f830eab9cd",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{ \n  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\", \n  \"object_id\":\"{{onduleurType}}__{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}__{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"command_topic\": \"{{global.parametre.mqtt.DirSmart}}/Modification-{{onduleurType}}/{{numOnduleur}}/Param{{ha_num_param}}\",\n  \"command_template\": \"{{value}}\",\n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{numOnduleur}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"options\":  [ {{{ha_select}}} ],\n  \"device\":{\n    \"manufacturer\":\"{{manufacturer}}\",\n  \t\"name\":\"{{global.name.Onduleur}} {{ha_num_onduleur}}\", \n  \t\"model\":\"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n  \t\"identifiers\":[\"{{onduleurType}}_{{ha_num_onduleur}}\"]\n\t}\n}",
        "output": "str",
        "x": 680,
        "y": 620,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "668601773355b5ff",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "f2dd87f830eab9cd",
        "name": "Select",
        "func": "msg.type_ha = 'select' ;\n\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n    if (global.get(\"onduleurs.onduleur_\" + i + \".active\") == true) {\n        msg.numOnduleur = i;\n        msg.onduleurType = global.get(\"onduleurs.onduleur_\" + i + \".type\");\n        msg.ha_num_onduleur = msg.numOnduleur;\n        node.send(msg);\n    }\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 620,
        "wires": [
            [
                "46b9a4d2f5fa24ea"
            ]
        ]
    },
    {
        "id": "6fc675f540e6796a",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "f2dd87f830eab9cd",
        "name": "link in 14",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 85,
        "y": 620,
        "wires": [
            [
                "668601773355b5ff"
            ]
        ]
    },
    {
        "id": "18b39c45b3095918",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{\n  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}}{{ha_num_qpgs}} {{ha_name_topic}}\",\n  {{{ha_device_class}}} \n  {{{ha_unit_of_measurement}}}\n  {{{entity_category}}}\n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{ha_num_onduleur}}/{{ha_state_topic}}\", \n  {{{attribut}}}\n  \"value_template\": \"{{ value }}\",\n  \"object_id\": \"{{onduleurType}}_{{ha_num_onduleur}}{{ha_num_qpgs}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}_{{ha_num_onduleur}}{{ha_num_qpgs}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  {{{ha_icon}}}\n  \"device\":{\n    \"manufacturer\": \"{{manufacturer}}\",\n\t  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}}{{ha_num_qpgs}}\",\n\t  \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n\t  \"identifiers\": [\"{{onduleurType}}_{{ha_num_onduleur}}{{ha_num_qpgs}}\"]\n\t}\n}",
        "output": "str",
        "x": 680,
        "y": 400,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "09cdb6c3078a14a3",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Puissance watt.....",
        "func": "\n/*-------------------------------------------------*/\n//Puissance \n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"power\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"W\",';\n msg.ha_nom_unit = 'watt';\n\t\n\t/*-------------------------------------------------*/\n\t//PV Puissance (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.PV\");\n\t msg.ha_type_topic = 'pv';\n\t msg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_19' :\n\t\t\t\t\t      (msg.onduleurType == \"easun\") ? '265' :\n\t\t\t\t\t\t  (msg.onduleurType == \"GrowattSPH\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t/*-------------------------------------------------*/\n\t//Batt Charge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.Batt_charge\");\n\t msg.ha_type_topic = 'batt_charge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-up-outline\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\")? 'custom_1' :\n\t\t\t\t    \t  (msg.onduleurType == \"easun\") ? '270' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\t\n\t/*-------------------------------------------------*/\n\t//Batt decharge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.Batt_batt_decharge\");\n\t msg.ha_type_topic = 'batt_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'custom_2' :\n\t\t\t\t\t      (msg.onduleurType == \"easun\") ? '270' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\t\n\t/*-------------------------------------------------*/\n\t//Batt charge Decharge sens (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.Batt_batt_chargedecharge\");\n\t msg.ha_type_topic = 'batt_charge_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'custom_3' :\n\t\t\t\t\t      (msg.onduleurType == \"easun\") ? '270' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t/*-------------------------------------------------*/\n\t//Conso Maison (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.Conso_maison\");\n\t msg.ha_type_topic = 'conso_maison';\n\t msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_5' :\n\t\t\t\t\t      (msg.onduleurType == \"easun\") ? '539' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t/*-------------------------------------------------*/\n\t//Conso Grid (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"name.conso_grid\");\n\t msg.ha_type_topic = 'conso_grid';\n\t msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\t\n\t msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_24' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t/*-------------------------------------------------*/\n\t//si qpigs2 (2ème string) est différent de NAK\n\t/*-------------------------------------------------*/\n\tif (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpigs2') != 'NAK'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//PV Puissance 2 (Watt)\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = global.get(\"name.PV2\");\n\t\tmsg.ha_type_topic = 'pv2';\n\t\tmsg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\t\n\t\tmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpigs2_2' :\n\t\t\t\t\t\t\t(msg.onduleurType == \"easun\") ? '' :\n\t\t\t\t\t\t\t'Erreur';\n\t\t\t\t\t\t\t\n\t\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t}\n\n\t/*-------------------------------------------------*/\n\t//si plusieur onduleur (qpgsx) est différent de NAK\n\t/*-------------------------------------------------*/\n\t\n\t/*\n\tif (global.get(\"qpgs1\") != 'NAK'){\n\n\t}\n\t*/\n\n\tif (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpgs') != false) {\n\t\tfor (let i = 2; i <= 8; i++) {\n\t\t\tlet topic = 'onduleurs.onduleur_' + msg.numOnduleur + '.qpgs_' + i;\n\t\t\tif (global.get(topic) == true) {\n\t\t\t\t\n\t\t\t\tmsg.ha_num_qpgs = '_' + i;\n\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt Charge (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"name.Batt_charge\") + ' via maitre';\n\t\t\t\tmsg.ha_type_topic = 'batt_charge_qpgs';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-up-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'custom_' + i + '01' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\t\t\t\t\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt decharge (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"name.Batt_batt_decharge\") + ' via maitre';\n\t\t\t\tmsg.ha_type_topic = 'batt_decharge_qpgs';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'custom_' + i + '02' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt charge Decharge sens (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"name.Batt_batt_chargedecharge\") + ' via maitre';\n\t\t\t\tmsg.ha_type_topic = 'batt_charge_decharge_qpgs';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'custom_' + i + '03' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 280,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "3dd8752b9b1bf81d",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Tension volt ..........",
        "func": "\n/*-------------------------------------------------*/\n//Tension \n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"voltage\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"V\",';\nmsg.ha_nom_unit = 'volt';\n\n    /*-------------------------------------------------*/\n    //Grid Tension (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.GridTension\");\n    msg.ha_type_topic = 'grid_tension';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_0' :\n        (msg.onduleurType == \"easun\") ? '531' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //Batterie Voltage (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.BattTensiont\");\n    msg.ha_type_topic = 'batt';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_8' :\n        (msg.onduleurType == \"easun\") ? '257' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //PV Voltage (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.PvTensiont\");\n    msg.ha_type_topic = 'pv';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_13' :\n                         (msg.onduleurType == \"easun\") ? '263' :\n                         'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //Onduleur Tension (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.OnduleurTension\");\n    msg.ha_type_topic = 'onduleur_tension';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_2' :\n                         (msg.onduleurType == \"easun\") ? '534' :\n                         'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\n    /*-------------------------------------------------*/\n    //si qpigs2 (2ème string) est différent de NAK\n    /*-------------------------------------------------*/\n\n    if (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpigs2') != 'NAK'){\n\n        /*-------------------------------------------------*/\n        //PV2 Voltage (Volt)\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = global.get(\"name.Pv2Tensiont\");\n        msg.ha_type_topic = 'pv2';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpigs2_1' :\n                'Erreur';\n\n        if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n    }\n    \n    /*-------------------------------------------------*/\n    //Si plusieurs onduleurs\n    /*-------------------------------------------------*/\n\tif (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpgs') != false) {\n\t\tfor (let i = 2; i <= 8; i++) {\n\t\t\tlet topic = 'onduleurs.onduleur_' + msg.numOnduleur + '.qpgs_' + i;\n\t\t\tif (global.get( topic ) == true){\n\n                msg.ha_num_qpgs = '_' + i;\n\n                /*-------------------------------------------------*/\n                //PV Voltage (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.PvTensiont\") + ' via maitre';\n                msg.ha_type_topic = 'pv_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_14' :\n                                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n                /*-------------------------------------------------*/\n                //Grid Tension (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.GridTension\") + ' via maitre';\n                msg.ha_type_topic = 'grid_tension_qpgs';\n                msg.ha_icon = '';\n\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_4' :\n                                     'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n                /*-------------------------------------------------*/\n                //Onduleur Tension (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.OnduleurTension\") + ' via maitre';\n                msg.ha_type_topic = 'onduleur_tension_qpgs';\n                msg.ha_icon = '';\n\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_6' :\n                                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n            }\n        }\n    }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 360,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "a8cf8c56c50d34d8",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "intensité Ampere",
        "func": "\n/*-------------------------------------------------*/\n//courant\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"current\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"A\",';\nmsg.ha_nom_unit = 'current';\n\n    /*-------------------------------------------------*/\n    //Pv Intensite (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.PvIntensite\");\n    msg.ha_type_topic = 'pv_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_12' :\n        (msg.onduleurType == \"easun\") ? '264' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //Grid intensite (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Grid Intensite (Amp)';\n    msg.ha_type_topic = 'grid_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"easun\") ? '532' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //Batt Charge (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.BattChargeIntensite\");\n    msg.ha_type_topic = 'batt_charge_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_9' :\n        (msg.onduleurType == \"easun\") ? '258' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    /*-------------------------------------------------*/\n    //Batt Decharge (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.BattDechargeIntensite\");\n    msg.ha_type_topic = 'batt_decharge_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_15' :\n        (msg.onduleurType == \"easun\") ? '' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n\n    /*-------------------------------------------------*/\n    //si qpigs2 (2ème string) est différent de NAK\n    /*-------------------------------------------------*/\n    if (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpigs2') != 'NAK'){\n\n        /*-------------------------------------------------*/\n        //Pv 2 Intensite (Amp)\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = global.get(\"name.Pv2Intensite\");\n        msg.ha_type_topic = 'pv2_intensite';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpigs2_0' :\n                'Erreur';\n\n        if (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n    }\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 400,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "13a62580d8ed6e7f",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Frequence Hz.....",
        "func": "\n/*-------------------------------------------------*/\n// Frequence\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"frequency\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"Hz\",';\nmsg.ha_nom_unit = 'frequency';\n\n    /*-------------------------------------------------*/\n    //Data-Frequency (Hz)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.DataFrequency\");\n    msg.ha_type_topic = 'data';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_1' :\n        (msg.onduleurType == \"easun\") ? '533' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Onduleur-Frequency (Hz)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.OnduleurFrequency\");\n    msg.ha_type_topic = 'onduleur_frequency';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_3' :\n        (msg.onduleurType == \"easun\") ? '536' :\n            'Erreur';\n\n    node.send(msg)\n\n\tif (global.get( 'onduleurqpgs' + msg.numOnduleur ) != false){\n\t\tfor (let i = 2; i <= 8; i++) {\n\t\t\tlet topic =  msg.numOnduleur + 'qpgs' + i ;\n\t\t\tif (global.get( topic ) == true){\n\n                msg.ha_num_qpgs = '_' + i;\n                \n                /*-------------------------------------------------*/\n                //Data-Frequency (Hz)\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.DataFrequency\") + ' via maitre';\n                msg.ha_type_topic = 'data_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_5' :\n                                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n                /*-------------------------------------------------*/\n                //Onduleur-Frequency (Hz) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.OnduleurFrequency\") + ' via maitre';\n                msg.ha_type_topic = 'onduleur_frequency_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_7' :\n                                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n\n            }\n\n\n        }\n    }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 440,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "418c68be8bdd4e6b",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "%........................",
        "func": "\n/*-------------------------------------------------*/\n// %\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"battery\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"%\",';\nmsg.ha_nom_unit = 'battery';\n\n    /*-------------------------------------------------*/\n    //Batterie Capacité\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.BattCapacite\");\n    msg.ha_type_topic = 'batt';\n    // msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_10' :\n        (msg.onduleurType == \"easun\") ? '256' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 480,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "d6286ee767f2f935",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Autre....................",
        "func": "\n/*-------------------------------------------------*/\n// Mode\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '';\nmsg.ha_unit_of_measurement = '';\nmsg.ha_nom_unit = 'info';\n\n    /*-------------------------------------------------*/\n    //Mode Solar\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.Mode\");\n    msg.ha_type_topic = 'mode';\n    msg.ha_icon = '';\n    msg.entity_category = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qmod_0' :\n        (msg.onduleurType == \"easun\") ? 'setup1_4' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n    /*-------------------------------------------------*/\n    //Date\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Date\";\n    msg.ha_type_topic = 'date';\n    msg.ha_icon = '';\n    msg.entity_category = '';\n\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'date_0_date' :\n                         (msg.onduleurType == \"easun\") ? '' :\n                            'Erreur';\n\n    //ajout le topic attribut\n    if (msg.onduleurType == \"voltronic\") {\n        msg.chemAttrib = global.get(\"parametre.mqtt.DirSmart\") + \"/\" + msg.onduleurType + \"_\" + msg.ha_num_onduleur + \"/date_0\";\n        msg.attribut = '\"json_attributes_topic\": \"' + msg.chemAttrib + '\",';   \n    }                 \n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n\n    msg.attribut = \"\";\n\n    /*-------------------------------------------------*/\n    //Erreur code Onduleur\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Code Erreur';\n    msg.ha_type_topic = 'code_erreur';\n    msg.ha_icon = '';\n    msg.entity_category = '\"entity_category\": \"diagnostic\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpiws_0_code' :\n                          'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n    /*-------------------------------------------------*/\n    //Erreur Onduleur\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Info Erreur';\n    msg.ha_type_topic = 'info_erreur';\n    msg.ha_icon = '';\n    msg.entity_category = '\"entity_category\": \"diagnostic\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpiws_0' :\n                          'Erreur';\n\n    //ajout le topic attribut\n    if (msg.onduleurType == \"voltronic\") {\n        msg.chemAttrib = global.get(\"parametre.mqtt.DirSmart\") + \"/\" + msg.onduleurType + \"_\" + msg.ha_num_onduleur + \"/qpiws_0_attrib\";\n        msg.attribut = '\"json_attributes_topic\": \"' + msg.chemAttrib + '\",';   \n    }  \n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n    msg.attribut = \"\";\n\n    /*-------------------------------------------------*/\n    //Version Firmware\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Version Firmware';\n    msg.ha_type_topic = 'info_firm';\n    msg.ha_icon = '';\n    msg.entity_category = '\"entity_category\": \"diagnostic\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'QVFW_0' :\n                          'Erreur';\n\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n    /*-------------------------------------------------*/\n    //Version Firmware\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Numéro de série';\n    msg.ha_type_topic = 'info_N_serie';\n    msg.ha_icon = '';\n    msg.entity_category = '\"entity_category\": \"diagnostic\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'QID_0' :\n                          'Erreur';\n\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n    /*-------------------------------------------------*/\n    //Modèle\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Modèle';\n    msg.ha_type_topic = 'info_model';\n    msg.ha_icon = '';\n    msg.entity_category = '\"entity_category\": \"diagnostic\",';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'QMN_0' :\n                          'Erreur';\n\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n\n    if (global.get(\"battNb\") != '0') {\n\n        /*-------------------------------------------------*/\n        //Total batterie\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = \"Total batterie\";\n        msg.ha_type_topic = 'total_batterie';\n        msg.ha_icon = '';\n        msg.entity_category = '';\n\n        msg.ha_state_topic = \"totalbatt\";\n\n        if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n    }\n\n\n\tif (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qpgs') != false) {\n\t\tfor (let i = 2; i <= 8; i++) {\n\t\t\tlet topic = 'onduleurs.onduleur_' + msg.numOnduleur + '.qpgs_' + i;\n\t\t\tif (global.get( topic ) == true){\n                \n                msg.ha_num_qpgs = '_' + i;\n\n                /*-------------------------------------------------*/\n                // Mode qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"name.Mode\") + ' via maitre';\n                msg.ha_type_topic = 'mode_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_2' :\n                                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n                /*-------------------------------------------------*/\n                // Code d'erreur qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = \"Code erreur\" + ' via maitre';\n                msg.ha_type_topic = 'erreur_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_3' :\n                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n                /*-------------------------------------------------*/\n                // serial number qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = \"Serial\" + ' via maitre';\n                msg.ha_type_topic = 'serial_qpgs';\n                msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpgs' + i + '_1' :\n                    'Erreur';\n\n                if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n            }\n        }\n    }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 560,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "e007bd1d1a5b6786",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Température C.......",
        "func": "\n/*-------------------------------------------------*/\n// Temperature\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"temperature\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"°C\",';\nmsg.ha_nom_unit = 'temperature';\n\n    /*-------------------------------------------------*/\n    //Temperature (°C)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"name.Temp\");\n    msg.ha_type_topic = 'temp';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'qpig_11' :\n        (msg.onduleurType == \"easun\") ? '546' :\n            'Erreur';\n\n    if (msg.ha_state_topic != 'Erreur'){node.send(msg);}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 520,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "841469b4f2f24f66",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "sensor",
        "func": "msg.type_ha = 'sensor' ;\n\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n    if (global.get(\"onduleurs.onduleur_\" + i + \".active\") == true) {\n        msg.numOnduleur = i;\n        msg.onduleurType = global.get(\"onduleurs.onduleur_\" + i + \".type\");\n        msg.ha_num_onduleur = msg.numOnduleur;\n        node.send(msg);\n    }\n\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 400,
        "wires": [
            [
                "09cdb6c3078a14a3",
                "3dd8752b9b1bf81d",
                "a8cf8c56c50d34d8",
                "13a62580d8ed6e7f",
                "418c68be8bdd4e6b",
                "e007bd1d1a5b6786",
                "d6286ee767f2f935",
                "a0387da25750b53f"
            ]
        ]
    },
    {
        "id": "138c3e0a8378849b",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "link in 13",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 85,
        "y": 400,
        "wires": [
            [
                "841469b4f2f24f66"
            ]
        ]
    },
    {
        "id": "fdbd9d4b67ecad4c",
        "type": "link out",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "MQTT-External-broker-ou",
        "mode": "link",
        "links": [
            "64c818fd3c742a69"
        ],
        "x": 1035,
        "y": 400,
        "wires": []
    },
    {
        "id": "4e091108f874f249",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "sensor smart",
        "func": "\nmsg.type_ha = 'sensor';\nmsg.onduleurType = 'config';\n\nnode.send(msg);",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 120,
        "wires": [
            [
                "49e3867630866e3a"
            ]
        ]
    },
    {
        "id": "49e3867630866e3a",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "Autre",
        "func": "\n/*-------------------------------------------------*/\n// Mode\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '';\nmsg.ha_unit_of_measurement = '';\nmsg.ha_nom_unit = 'info';\n\n    /*-------------------------------------------------*/\n    //Nombre de connexion usb\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Nombre de connexion onduleur ';\n    msg.ha_type_topic = 'nb_onduleur';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = 'nbconnexionOnduleur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Version\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Version';\n    msg.ha_type_topic = 'model';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = 'version';\n\n    node.send(msg)\n    \n    /*-------------------------------------------------*/\n    //Version\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Version';\n    msg.ha_type_topic = 'model';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = 'version';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Total batterie\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Total batterie\";\n    msg.ha_type_topic = 'total_batterie';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = \"totalbatt\";\n\n    node.send(msg);\n    \n\n    // Valeur différente connexion onduleur\n    let count = global.get(\"countUSBOnduleur\")\n    for (let i = 1; i <= count; i++) {\n\n                //Chemin\n                msg.ha_name_topic = \"Onduleur \" + i + \" Chemin\";\n                msg.ha_type_topic = 'onduleur' + i + 'Chemin';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'onduleur' + i + 'Chemin';\n\n                node.send(msg);\n        \n                //Type \n                msg.ha_name_topic = \"Onduleur \" + i + \" Type\";\n                msg.ha_type_topic = 'onduleur' + i + 'Type';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'onduleur' + i + 'Type';\n\n                node.send(msg);\n\n                //TypeCom (ip ou serial)\n                msg.ha_name_topic = \"Onduleur \" + i + \" TypeCom\";\n                msg.ha_type_topic = 'onduleur' + i + 'TypeCom';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'onduleur' + i + 'TypeCom';\n\n                node.send(msg);\n            \n                //Tension des batterie\n                msg.ha_name_topic = \"Onduleur \" + i + \" Tension\";\n                msg.ha_type_topic = 'onduleur' + i + 'Tension';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'onduleur' + i + 'Tension';\n\n                node.send(msg);\n\n                //Status de communication\n                msg.ha_name_topic = \"Onduleur \" + i + \" Communication\";\n                msg.ha_type_topic = 'onduleur' + i + 'Communication';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'onduleur' + i + '_status';\n\n                node.send(msg);\n\n\n    }\n\n    // Valeur différente connexion onduleur\n    count = global.get(\"countUSBBatterie\")\n    for (let i = 1; i <= count; i++) {\n\n                //Chemin\n                msg.ha_name_topic = \"Batterie \" + i + \" Chemin\";\n                msg.ha_type_topic = 'batterie' + i + 'Chemin';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'batterie' + i + 'Chemin';\n\n                node.send(msg);\n        \n                //Type \n                msg.ha_name_topic = \"Batterie \" + i + \" Type\";\n                msg.ha_type_topic = 'batterie' + i + 'Type';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'batterie' + i + 'Type';\n\n                node.send(msg);\n\n                //TypeCom (ip ou serial)\n                msg.ha_name_topic = \"Batterie \" + i + \" TypeCom\";\n                msg.ha_type_topic = 'batterie' + i + 'TypeCom';\n                msg.ha_icon = '';\n                msg.ha_state_topic = 'batterie' + i + 'TypeCom';\n\n                node.send(msg);\n\n    }\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 120,
        "wires": [
            [
                "0bbba58084a86127"
            ]
        ]
    },
    {
        "id": "0bbba58084a86127",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{\n  \"name\": \"{{ha_name_topic}}\",\n  {{{ha_device_class}}} \n  {{{ha_unit_of_measurement}}}\n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}{{ha_num_onduleur}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"object_id\": \"{{onduleurType}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  {{{ha_icon}}}\n  \"device\":{\n    \"manufacturer\": \"{{manufacturer}}\",\n\t  \"name\": \"Smartphoton\",\n\t  \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n\t  \"identifiers\": [\"{{onduleurType}}\"]\n\t}\n}",
        "output": "str",
        "x": 680,
        "y": 120,
        "wires": [
            [
                "ffac427dac22494c",
                "bc95fac8ab91c063"
            ]
        ]
    },
    {
        "id": "bc95fac8ab91c063",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "valeurConfig",
        "func": "//Message a mqtt\n\n//Nombre de connexion\nmsg.topic = 'smartphoton/config/nbconnexionOnduleur';\nmsg.payload = global.get(\"countUSBOnduleur\");\n\nnode.send(msg);\n\n//Nombre de connexion\nmsg.topic = 'smartphoton/config/version';\nmsg.payload = msg.model;\n\nnode.send(msg);\n\n// Valeur différente connexion onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n        //Chemin\n        msg.topic = 'smartphoton/config/onduleur' + i + 'Chemin';\n        msg.payload = global.get('onduleurs.onduleur_' + i + '.chemin');\n\n        node.send(msg);\n\n        //Type\n        msg.topic = 'smartphoton/config/onduleur' + i + 'Type';\n        msg.payload = global.get('onduleurs.onduleur_' + i + '.type');\n\n        node.send(msg);\n\n        //TypeCom (ip ou serial)\n        msg.topic = 'smartphoton/config/onduleur' + i + 'TypeCom';\n        msg.payload = global.get('onduleurs.onduleur_' + i + '.ComType');\n\n        node.send(msg);\n\n\n        //Tension des batterie\n        msg.topic = 'smartphoton/config/onduleur' + i + 'Tension';\n        msg.payload = global.get('onduleurs.onduleur_' + i + '.battTension');\n\n        node.send(msg);\n\n\n}\n\n// Valeur différente connexion Batterie\ncount = global.get(\"countUSBBatterie\")\nfor (let i = 1; i <= count; i++) {\n\n        //Chemin\n        msg.topic = 'smartphoton/config/batterie' + i + 'Chemin';\n        msg.payload = global.get('batteries.batterie_' + i + '.chemin');\n\n        node.send(msg);\n\n        //Type \n        msg.topic = 'smartphoton/config/batterie' + i + 'Type';\n        msg.payload = global.get('batteries.batterie_' + i + '.type');\n\n        node.send(msg);\n\n        //TypeCom (ip ou serial)\n        msg.topic = 'smartphoton/config/batterie' + i + 'TypeCom';\n        msg.payload = global.get('batteries.batterie_' + i + '.ComType');\n\n        node.send(msg);\n\n        //Total Batterie\n        msg.topic = 'smartphoton/config/totalbatt';\n        msg.payload = global.get('batteries.batterie_' + i + '.battNb');\n\n        node.send(msg);\n\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 120,
        "wires": [
            [
                "86d8a22ffb808c6e"
            ]
        ]
    },
    {
        "id": "6afc2ee6a13fec77",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "link in 12",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 65,
        "y": 120,
        "wires": [
            [
                "4e091108f874f249",
                "c8c9f7e36ef12713"
            ]
        ]
    },
    {
        "id": "86d8a22ffb808c6e",
        "type": "link out",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "MQTT-External-broker-ou",
        "mode": "link",
        "links": [
            "64c818fd3c742a69"
        ],
        "x": 1035,
        "y": 120,
        "wires": []
    },
    {
        "id": "da4c9798c2dec551",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "Autre",
        "func": "\n/*-------------------------------------------------*/\n// Mode\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '';\nmsg.ha_unit_of_measurement = '';\nmsg.ha_nom_unit = 'info';\n\n    /*-------------------------------------------------*/\n    //Nombre de connexion usb\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = 'Création des capteurs ';\n    msg.ha_type_topic = 'nb_onduleur';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = 'nbconnexionOnduleur';\n\n    /*node.send(msg)*/\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 160,
        "wires": [
            [
                "a0611e8e7382c1ba"
            ]
        ]
    },
    {
        "id": "c8c9f7e36ef12713",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "button",
        "func": "\n\n\nmsg.type_ha = 'button';\nmsg.onduleurType = 'config';\n\nnode.send(msg);",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 160,
        "wires": [
            [
                "da4c9798c2dec551"
            ]
        ]
    },
    {
        "id": "a0611e8e7382c1ba",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "5b78bcc7b86527da",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{ \n  \"name\": \"{{ha_name_topic}}\", \n  \"object_id\":\"{{onduleurType}}__{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}__{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"command_topic\": \"{{global.parametre.mqtt.DirSmart}}/Modification-{{onduleurType}}/templateSensor\",\n  \"command_template\": \"{{value}}\",\n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{numOnduleur}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"options\":  [ {{{ha_select}}} ],\n  \"device\":{\n    \"manufacturer\": \"{{manufacturer}}\",\n\t  \"name\": \"Smartphoton\",\n\t  \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n\t  \"identifiers\": [\"{{onduleurType}}\"]\n\t}\n}",
        "output": "str",
        "x": 680,
        "y": 160,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "60e82e0320bcc250",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{ \n  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\", \n  \"object_id\": \"{{onduleurType}}_{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{numOnduleur}}/{{command}}\", \n  \"command_topic\": \"{{global.parametre.mqtt.DirSmart}}/Modification-{{onduleurType}}/{{numOnduleur}}/ParamDate\",\n  \"device\": {\n    \"manufacturer\": \"{{manufacturer}}\", \n    \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}}\", \n    \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n    \"identifiers\": [\"{{onduleurType}}_{{ha_num_onduleur}}\"] \n  }\n}",
        "output": "str",
        "x": 680,
        "y": 720,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "7720b4ea744dde26",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "cb13017736294c50",
        "name": "function parametre",
        "func": "/*-------------------------------------------------*/\n//Date\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"Règler la date\";\nmsg.ha_type_topic = 'date';\nmsg.ha_num_param = '0';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'date'  \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '' \n        \n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 720,
        "wires": [
            [
                "60e82e0320bcc250"
            ]
        ]
    },
    {
        "id": "8c659f224ad78cae",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "cb13017736294c50",
        "name": "button",
        "func": "msg.type_ha = 'button' ;\n\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n    if (global.get(\"onduleurs.onduleur_\" + i + \".active\") == true) {\n        msg.numOnduleur = i;\n        msg.onduleurType = global.get(\"onduleurs.onduleur_\" + i + \".type\");\n        msg.ha_num_onduleur = msg.numOnduleur;\n        node.send(msg);\n    }\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 720,
        "wires": [
            [
                "7720b4ea744dde26"
            ]
        ]
    },
    {
        "id": "1135ace26c7cb459",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "cb13017736294c50",
        "name": "link in 19",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 85,
        "y": 720,
        "wires": [
            [
                "8c659f224ad78cae"
            ]
        ]
    },
    {
        "id": "896fde51881f1688",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{ \n  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\", \n  \"object_id\": \"{{onduleurType}}_{{ha_num_onduleur}}_{{ha_type_topic}}\",\n  \"unique_id\": \"{{onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{numOnduleur}}/command\", \n  \"command_topic\": \"{{global.parametre.mqtt.DirSmart}}/Modification-{{onduleurType}}/{{numOnduleur}}/ParamCom\",\n  \"device\": {\n    \"manufacturer\": \"{{manufacturer}}\", \n    \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}}\", \n    \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n    \"identifiers\": [\"{{onduleurType}}_{{ha_num_onduleur}}\"] \n  }\n}",
        "output": "str",
        "x": 680,
        "y": 820,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "409452c2fbfd2d19",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "33295ebe24d36f67",
        "name": "function parametre",
        "func": "/*-------------------------------------------------*/\n//Date\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"Commande\";\nmsg.ha_type_topic = 'com';\nmsg.ha_num_param = '0';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'com'  \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '' \n        \n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 820,
        "wires": [
            [
                "896fde51881f1688"
            ]
        ]
    },
    {
        "id": "1210e3b6c293caa7",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "33295ebe24d36f67",
        "name": "Commande",
        "func": "msg.type_ha = 'text' ;\n\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n    if (global.get(\"onduleurs.onduleur_\" + i + \".active\") == true) {\n        msg.numOnduleur = i;\n        msg.onduleurType = global.get(\"onduleurs.onduleur_\" + i + \".type\");\n        msg.ha_num_onduleur = msg.numOnduleur;\n        node.send(msg);\n    }\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 820,
        "wires": [
            [
                "409452c2fbfd2d19"
            ]
        ]
    },
    {
        "id": "cc4a8225e658ad4b",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "33295ebe24d36f67",
        "name": "link in 20",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 85,
        "y": 820,
        "wires": [
            [
                "1210e3b6c293caa7"
            ]
        ]
    },
    {
        "id": "0eed961303067a05",
        "type": "link in",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "link in 3",
        "links": [
            "0e4f3d1b42c27eb3"
        ],
        "x": 85,
        "y": 900,
        "wires": [
            [
                "6cf215c3cd5a3a1a"
            ]
        ]
    },
    {
        "id": "6cf215c3cd5a3a1a",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "number",
        "func": "msg.type_ha = 'number' ;\n\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\nfor (let i = 1; i <= count; i++) {\n\n    if (global.get(\"onduleurs.onduleur_\" + i + \".active\") == true) {\n        msg.numOnduleur = i;\n        msg.onduleurType = global.get(\"onduleurs.onduleur_\" + i + \".type\");\n        msg.ha_num_onduleur = msg.numOnduleur;\n        node.send(msg);\n    }\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 900,
        "wires": [
            [
                "c057a81d4adc5666"
            ]
        ]
    },
    {
        "id": "c057a81d4adc5666",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "function parametre",
        "func": "if (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qdop') != 'NAK'){\n    /*-------------------------------------------------*/\n    //QDOP\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Capacité de recharge de la batterie\";\n    msg.ha_type_topic = 'Battery_max_charging';\n    msg.ha_num_param = 'qdop8';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qdop_8' \n            msg.min = 5;\n            msg.max = 95;\n            msg.step = 1;\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            \n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n\n    msg.ha_name_topic = \"Capacité de re-décharge de la batterie\";\n    msg.ha_type_topic = 'Battery_max_discharging';\n    msg.ha_num_param = 'qdop9';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qdop_9' \n            msg.min = 10;\n            msg.max = 100;\n            msg.step = 1;\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            \n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n\n    msg.ha_name_topic = \"Capacité insuffisante de la batterie\";\n    msg.ha_type_topic = 'battery_under_capacity';\n    msg.ha_num_param = 'qdop10';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qdop_10' \n            msg.min = 0;\n            msg.max = 90;\n            msg.step = 1;\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            \n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 900,
        "wires": [
            [
                "d20cbedd51b488db"
            ]
        ]
    },
    {
        "id": "d20cbedd51b488db",
        "type": "template",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{ \n  \"name\": \"{{global.name.Onduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\", \n  \"object_id\":\"{{onduleurType}}_{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"command_topic\": \"{{global.parametre.mqtt.DirSmart}}/Modification-{{onduleurType}}/{{numOnduleur}}/Param{{ha_num_param}}\",\n  \"command_template\": \"{{value}}\",\n  \"state_topic\": \"{{global.parametre.mqtt.DirSmart}}/{{onduleurType}}_{{numOnduleur}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"unit_of_measurement\": \"%\",\n  \"mode\": \"box\",\n  \"min\": {{min}},\n  \"max\": {{max}},\n  \"step\": {{step}},\n  \"device\":{\n    \"manufacturer\":\"{{manufacturer}}\",\n  \t\"name\":\"{{global.name.Onduleur}} {{ha_num_onduleur}}\", \n  \t\"model\":\"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n  \t\"identifiers\":[\"{{onduleurType}}_{{ha_num_onduleur}}\"]\n\t}\n}",
        "output": "str",
        "x": 680,
        "y": 900,
        "wires": [
            [
                "ffac427dac22494c"
            ]
        ]
    },
    {
        "id": "46b9a4d2f5fa24ea",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "f2dd87f830eab9cd",
        "name": "function parametre",
        "func": "/*-------------------------------------------------*/\n//Paramètre 01\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param01\");\nmsg.ha_type_topic = 'param01';\nmsg.ha_num_param = '01';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_16' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57860' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n/*-------------------------------------------------*/\n//Paramètre 02\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param02\");\nmsg.ha_type_topic = 'param02';\nmsg.ha_num_param = '02';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_14' \n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n         msg.ha_select = option(90, 10, 10, 0, '0', '') + ',\"100\",\"110\",\"120\",\"130\",\"140\",\"150\"' ;\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57866' \n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n        msg.ha_select = option(80, 10, 10, 0, '', '');\n\n    }                      \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n/*-------------------------------------------------*/\n//Paramètre 05\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param05\");\nmsg.ha_type_topic = 'param05';\nmsg.ha_num_param = '05';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_12' \n        msg.ha_select = '\"AGM\",\"Flooded\",\"User\",\"Pylon\",\"Weco\",\"Soltaro\",\"Lib\",\"Lic\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57348' \n        msg.ha_select = '\"USE\",\"SLD\",\"FLD\",\"GEL\",\"LIFEPO4X14\",\"LIFEPO4X15\",\"LIFEPO4X16\",\"LIFEPO4X7\",\"LIFEPO4X8\",\"LIFEPO4X9\",\"TERNARYIX7\",\"TERNARYIX8\",\"TERNARYIX13\",\"TERNARYIX14\"'\n\n    }\n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n\n/*-------------------------------------------------*/\n//Paramètre 11\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param11\");\nmsg.ha_type_topic = 'param11';\nmsg.ha_num_param = '11';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_13' \n        let tableau = global.get(\"onduleurs.onduleur_\" + msg.ha_num_onduleur + \".param11\");\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '\"02\",' + option(60, 10, 10, 0, '', '') :\n                        //(global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? '\"02\",' + option(140, 10, 10, 0, '', '') :\n\t\t\t\t\t    (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? tableau.map(x => `\"${x}\"`).join(\",\") :\n                        'Erreur'; \n\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57861'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? '\"02\",' + option(60, 10, 10, 0, '', '') :\n\t\t\t\t\t    'Erreur'; \n        \n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 12\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param12\");\nmsg.ha_type_topic = 'param12';\nmsg.ha_num_param = '12';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_8' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(25.5, 22, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(51, 44, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57371'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(25.5, 25.5, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                      \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 13\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param13\");\nmsg.ha_type_topic = 'param13';\nmsg.ha_num_param = '13';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_22' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(58, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57378'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 16\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param16\");\nmsg.ha_type_topic = 'param16';\nmsg.ha_num_param = '16';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_17' \n        msg.ha_select = '\"CUE\",\"CSO\",\"SNU\",\"OSO\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57871' \n        msg.ha_select = '\"CSO\",\"CUB\",\"SNU\",\"OSO\"'\n\n    }\n    if( msg.ha_state_topic != '') {node.send(msg)}\n\n/*-------------------------------------------------*/\n//Paramètre 26\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param26\");\nmsg.ha_type_topic = 'param26';\nmsg.ha_num_param = '26';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_10' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(32, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(64.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57354'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                     \n    if( msg.ha_state_topic != '') {node.send(msg)}\n\n/*-------------------------------------------------*/\n//Paramètre 27\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param27\");\nmsg.ha_type_topic = 'param27';\nmsg.ha_num_param = '27';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_11' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(58.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57351'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 29\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param29\");\nmsg.ha_type_topic = 'param29';\nmsg.ha_num_param = '29';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_9' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(24, 21, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(48.1, 42, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57357'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n       \n\n    }                   \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//fonction calcul incrémentation\n/*-------------------------------------------------*/\nfunction option(max, min, increment, decimal, prefixe, suffixe) {\n    let str = '';\n    for (let i = min; i <= max; i += increment) {\n\n        str = str + '\"' + prefixe + i.toFixed(decimal) + suffixe + '\",';\n        \n\n    }\n    //on enleve la virgule\n    str = str.slice(0, -1);\n  return str;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 620,
        "wires": [
            [
                "70c35a8a74bf19ee"
            ]
        ]
    },
    {
        "id": "c288144a60c61eb8",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "02d3f3a187bb86ca",
        "name": "ancien function parametre",
        "func": "/*-------------------------------------------------*/\n//Paramètre 01\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param01\");\nmsg.ha_type_topic = 'param01';\nmsg.ha_num_param = '01';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_16' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57860' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n/*-------------------------------------------------*/\n//Paramètre 02\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param02\");\nmsg.ha_type_topic = 'param02';\nmsg.ha_num_param = '02';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_14' \n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n         msg.ha_select = option(90, 10, 10, 0, '0', '') + ',\"100\",\"110\",\"120\",\"130\",\"140\",\"150\"' ;\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57866' \n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n        msg.ha_select = option(80, 10, 10, 0, '', '');\n\n    }                      \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n/*-------------------------------------------------*/\n//Paramètre 05\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param05\");\nmsg.ha_type_topic = 'param05';\nmsg.ha_num_param = '05';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_12' \n        msg.ha_select = '\"AGM\",\"Flooded\",\"User\",\"Pylon\",\"Weco\",\"Soltaro\",\"Lib\",\"Lic\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57348' \n        msg.ha_select = '\"USE\",\"SLD\",\"FLD\",\"GEL\",\"LIFEPO4X14\",\"LIFEPO4X15\",\"LIFEPO4X16\",\"LIFEPO4X7\",\"LIFEPO4X8\",\"LIFEPO4X9\",\"TERNARYIX7\",\"TERNARYIX8\",\"TERNARYIX13\",\"TERNARYIX14\"'\n\n    }\n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n\n/*-------------------------------------------------*/\n//Paramètre 11\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param11\");\nmsg.ha_type_topic = 'param11';\nmsg.ha_num_param = '11';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_13' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '\"02\",' + option(60, 10, 10, 0, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? '\"02\",' + option(120, 10, 10, 0, '', '') :\n\t\t\t\t\t    'Erreur'; \n\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57861'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? '\"02\",' + option(60, 10, 10, 0, '', '') :\n\t\t\t\t\t    'Erreur'; \n        \n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 12\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param12\");\nmsg.ha_type_topic = 'param12';\nmsg.ha_num_param = '12';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_8' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(25.5, 22, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(51, 44, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57371'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(25.5, 25.5, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                      \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 13\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param13\");\nmsg.ha_type_topic = 'param13';\nmsg.ha_num_param = '13';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_22' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(58, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57378'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 16\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param16\");\nmsg.ha_type_topic = 'param16';\nmsg.ha_num_param = '16';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_17' \n        msg.ha_select = '\"CUE\",\"CSO\",\"SNU\",\"OSO\"'\n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57871' \n        msg.ha_select = '\"CSO\",\"CUB\",\"SNU\",\"OSO\"'\n\n    }\n    if( msg.ha_state_topic != '') {node.send(msg)}\n\n/*-------------------------------------------------*/\n//Paramètre 26\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param26\");\nmsg.ha_type_topic = 'param26';\nmsg.ha_num_param = '26';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_10' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(32, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(64.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57354'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                     \n    if( msg.ha_state_topic != '') {node.send(msg)}\n\n/*-------------------------------------------------*/\n//Paramètre 27\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param27\");\nmsg.ha_type_topic = 'param27';\nmsg.ha_num_param = '27';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_11' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(58.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57351'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                 \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\n/*-------------------------------------------------*/\n//Paramètre 29\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"name.Param29\");\nmsg.ha_type_topic = 'param29';\nmsg.ha_num_param = '29';\n\n    if (msg.onduleurType == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_9' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? option(24, 21, 0.5, 1, '', '') :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(48.1, 42, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n        \n\n    }else if (msg.onduleurType == \"easun\"){\n\n        msg.ha_state_topic = '57357'\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 12) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 24) ? '' :\n                        (global.get(\"onduleurs.onduleur_\" + msg.numOnduleur + \".battTension\") == 48) ? option(60, 40, 0.4, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n       \n\n    }                   \n    if (msg.ha_state_topic != '') { node.send(msg) }\n\n\nif (global.get('onduleurs.onduleur_' + msg.numOnduleur + '.qled') != 'NAK'){\n    /*-------------------------------------------------*/\n    //Paramètre 92 Luminosité Led\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Luminosité des LEDs\";\n    msg.ha_type_topic = 'param92';\n    msg.ha_num_param = '92';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qled_3' \n            msg.ha_select = '\"Faible\", \"Moyen\", \"Haut\"'\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            msg.ha_select = '\"Faible\", \"Moyen\", \"Haut\"'\n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n\n    /*-------------------------------------------------*/\n    //Paramètre 93 Vitesse Led\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Vitesse des LEDs\";\n    msg.ha_type_topic = 'param93';\n    msg.ha_num_param = '93';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qled_1' \n            msg.ha_select = '\"Faible\", \"Moyen\", \"Rapide\"'\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            msg.ha_select = '\"Faible\", \"Moyen\", \"Rapide\"'\n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n\n    /*-------------------------------------------------*/\n    //Paramètre 94 Effet Led\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Effet des LEDs\";\n    msg.ha_type_topic = 'param94';\n    msg.ha_num_param = '94';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qled_2' \n            msg.ha_select = '\"Circulaire\", \"Roue\", \"Chasing\", \"Fixe\"'\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            msg.ha_select = '\"Circulaire\", \"Roue\", \"Chasing\", \"Fixe\"'\n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n\n    /*-------------------------------------------------*/\n    //Paramètre 95 Effet Led\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = \"Données des LEDs\";\n    msg.ha_type_topic = 'param95';\n    msg.ha_num_param = '95';\n\n        if (msg.onduleurType == \"voltronic\"){\n\n            msg.ha_state_topic = 'qled_4' \n            msg.ha_select = '\"Puissance PV\", \"SoC Batterie\", \"Pourcentage de charge\", \"Source\", \"Charge Decharge\"'\n\n        }else if (msg.onduleurType == \"easun\"){\n\n            msg.ha_state_topic = '' \n            msg.ha_select = '\"Puissance PV\", \"SoC Batterie\", \"Pourcentage de charge\", \"Source\", \"Charge Decharge\"'\n\n        }                 \n        if (msg.ha_state_topic != '') { node.send(msg) }\n}\n\n/*-------------------------------------------------*/\n//fonction calcul incrémentation\n/*-------------------------------------------------*/\nfunction option(max, min, increment, decimal, prefixe, suffixe) {\n    let str = '';\n    for (let i = min; i <= max; i += increment) {\n\n        str = str + '\"' + prefixe + i.toFixed(decimal) + suffixe + '\",';\n        \n\n    }\n    //on enleve la virgule\n    str = str.slice(0, -1);\n  return str;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "a0387da25750b53f",
        "type": "function",
        "z": "be5edd3034bf892f",
        "g": "371006d1cb186f75",
        "name": "Énergies PV et Load",
        "func": "/*-------------------------------------------------*/\n// ÉNERGIES PV ET LOAD - MQTT Discovery Auto (kWh)\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"energy\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"kWh\",';\nmsg.ha_nom_unit = 'kwh';\n\n/*-------------------------------------------------*/\n// PV Production Jour (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"PV Production Jour\";\nmsg.ha_type_topic = 'energie_pv_jour';\nmsg.ha_icon = '\"icon\": \"mdi:solar-power\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_pv_jour' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// PV Production Mois (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"PV Production Mois\";\nmsg.ha_type_topic = 'energie_pv_mois';\nmsg.ha_icon = '\"icon\": \"mdi:solar-power\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_pv_mois' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// PV Production Année (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"PV Production Année\";\nmsg.ha_type_topic = 'energie_pv_annee';\nmsg.ha_icon = '\"icon\": \"mdi:solar-power\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_pv_annee' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// PV Production Totale (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"PV Production Totale\";\nmsg.ha_type_topic = 'energie_pv_total';\nmsg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\nmsg.ha_state_class = '\"state_class\": \"total_increasing\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_pv_total' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// Load Consommation Jour (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"Load Consommation Jour\";\nmsg.ha_type_topic = 'energie_load_jour';\nmsg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_load_jour' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// Load Consommation Mois (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"Load Consommation Mois\";\nmsg.ha_type_topic = 'energie_load_mois';\nmsg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_load_mois' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// Load Consommation Année (kWh)\n/*-------------------------------------------------*/\n// ⚠️ NOTE: Cette commande peut retourner NAK sur certains onduleurs\n// Le capteur sera créé mais pourrait rester sans valeur si NAK\nmsg.ha_name_topic = \"Load Consommation Année\";\nmsg.ha_type_topic = 'energie_load_annee';\nmsg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt\",';\nmsg.ha_state_class = '\"state_class\": \"total\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_load_annee' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}\n\n/*-------------------------------------------------*/\n// Load Consommation Totale (kWh)\n/*-------------------------------------------------*/\nmsg.ha_name_topic = \"Load Consommation Totale\";\nmsg.ha_type_topic = 'energie_load_total';\nmsg.ha_icon = '\"icon\": \"mdi:transmission-tower\",';\nmsg.ha_state_class = '\"state_class\": \"total_increasing\",';\n\nmsg.ha_state_topic = (msg.onduleurType == \"voltronic\") ? 'energie_load_total' :\n                      'Erreur';\n\nif (msg.ha_state_topic != 'Erreur'){node.send(msg)}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 320,
        "wires": [
            [
                "18b39c45b3095918"
            ]
        ]
    },
    {
        "id": "6d3f58fcc31852f0",
        "type": "serial request",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "",
        "serial": "db21c60ace45d1da",
        "x": 670,
        "y": 400,
        "wires": [
            [
                "7869ae33f0a63238",
                "9dfc1e6110354e33"
            ]
        ]
    },
    {
        "id": "7869ae33f0a63238",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "onduleur",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 420,
        "wires": []
    },
    {
        "id": "394fae8b341ca3dc",
        "type": "link in",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "Parsing-response-in",
        "links": [
            "9dfc1e6110354e33",
            "09f79937aa931c75",
            "b1ac024e439f5649",
            "4a2c1162e2839b16"
        ],
        "x": 75,
        "y": 780,
        "wires": [
            [
                "9d9541adb4b07967"
            ]
        ]
    },
    {
        "id": "9dfc1e6110354e33",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "Parsing-response-ou",
        "mode": "link",
        "links": [
            "394fae8b341ca3dc"
        ],
        "x": 1085,
        "y": 400,
        "wires": []
    },
    {
        "id": "8ba013a847b39d93",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "Tri Q...",
        "func": "/* PARSER TRI Q... MODIFIÉ - AVEC SUPPORT ÉNERGIES + kWh (1 décimale) */\n\nif (msg.topic == \"command\") {\n   msg.type = msg.topic;\n  msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/command';\n  node.send(msg);\n\n  \n} else if(msg.topic == \"qmchgcr\"){\n  // Nettoyage et création du tableau\n    msg.payload = msg.payload.slice(1, -3);\n    msg.payload = msg.payload.trim().split(/\\s+/);\n\n    // Stocker dans le contexte global\n    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + \".param11\", msg.payload);\n\n/* ==================== NOUVEAU: PARSER ÉNERGIES (EN kWh) ==================== */\n\n} else if (msg.topic == \"qed\" || msg.topic == \"qem\" || msg.topic == \"qey\" || msg.topic == \"qet\" ||\n           msg.topic == \"qld\" || msg.topic == \"qlm\" || msg.topic == \"qly\" || msg.topic == \"qlt\") {\n    \n    // Parser les réponses d'énergies\n    // Format: (NNNNNNNN<CRC><cr>\n    \n    // Extraire la valeur (8 chiffres)\n    let response = msg.payload.toString('utf8');\n    let match = response.match(/\\(([0-9]{1,8})/);\n    \n    if (match && match[1]) {\n        let energieWh = parseInt(match[1]);\n        \n        // Conversion en kWh avec 1 décimale\n        let energieKwh = (energieWh / 1000).toFixed(1);\n        \n        // Mapper les topics aux noms lisibles\n        let energieMap = {\n            'qed': 'energie_pv_jour',\n            'qem': 'energie_pv_mois',\n            'qey': 'energie_pv_annee',\n            'qet': 'energie_pv_total',\n            'qld': 'energie_load_jour',\n            'qlm': 'energie_load_mois',\n            'qly': 'energie_load_annee',\n            'qlt': 'energie_load_total'\n        };\n        \n        let energieName = energieMap[msg.topic] || msg.topic;\n        \n        // Stocker dans le contexte global (en kWh)\n        global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + \".\" + energieName, parseFloat(energieKwh));\n        \n        // Préparer pour MQTT\n        msg.payload = parseFloat(energieKwh); // kWh avec 1 décimale\n        msg.type = msg.topic;\n        msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + \n                    global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + \n                    msg.voltronicNum + '/' + energieName;\n        \n        node.status({\n            fill: \"green\",\n            shape: \"dot\",\n            text: energieName + \": \" + energieKwh + \" kWh\"\n        });\n        \n        node.send(msg);\n    } else {\n        node.warn(\"Réponse énergie invalide: \" + response);\n    }\n\n/* ==================== FIN PARSER ÉNERGIES ==================== */\n\n} else if ( msg.payload != \"ACK\"){\n  msg.payload = msg.payload.slice(1, -3);\n  msg.payload = msg.payload.split(' ');\n  \n  // Si NAK on l'enregistre variable flow\n  if (msg.payload == \"NAK\"){\n\n    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + \".\" + msg.topic, \"NAK\");\n\n  }\n\n    // msg.payload.length\n    //Nomage préfix\n    var name = msg.topic + '_';\n    msg.type = msg.topic;\n    var payload = msg.payload\n    var count = msg.payload.length\n\n    for (let i = 0; i <= count; i++) {\n      \n      msg.payload = payload[i];\n      \n      //vérification si c'est le qpig_24 (consomation réseaux)\n      if ( name + i == \"qpig_24\"){\n\n\n          msg.payload = parseFloat( msg.payload);// transformation valeur string en number\n\n          if (msg.payload <= 35000){\n            //si en dessous de 35000 on laisse passer la valeur \n            msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i;\n            node.send(msg);\n            \n          }\n\n      }else{\n\n        msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i;\n        node.send(msg);\n\n      }\n      \n    \n\n  }\n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 820,
        "wires": [
            [
                "a617d17752d34864"
            ]
        ]
    },
    {
        "id": "218e550a06f8765b",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "Calcul",
        "func": "msg.payload = msg.payload.slice(1, -3);\nmsg.payload = msg.payload.split(' ');\nlet name = 'custom_'; //préfix custom\n\nif (msg.topic == \"qpig\") {\n\n    //numéro du calcul\n    let tab = [\"1_battChargeWatt\", \"2_battDechargeWatt\", \"3_battChargeDechargeWatt\"]\n\n\n    let payload = msg.payload\n    let count = tab.length //compte le nombre du tableau \n\n\n    for (let i = 1; i <= count; i++) {\n\n        /*-------------------------------------------------*/\n        //1 Batterie charge en watt\n        /*-------------------------------------------------*/\n        if (i == 1) {\n\n            //calcul\n            let charge = payload[9] * payload[8];\n            msg.payload = charge.toFixed(2);\n        }\n\n        /*-------------------------------------------------*/\n        //2 Batterie Decharge en watt\n        /*-------------------------------------------------*/\n        if (i == 2) {\n\n            //calcul\n            let decharge = payload[15] * payload[8];\n            msg.payload = decharge.toFixed(2);\n        }\n\n        //nouveau Parametre pour mqtt en custom\n        msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i;\n        node.send(msg);\n\n        /*-------------------------------------------------*/\n        //3 Batterie charge positive, Decharge négative en watt\n        /*-------------------------------------------------*/\n        if (i == 3) {\n\n            let charge = payload[9] * payload[8];\n            let decharge = payload[15] * payload[8];\n            \n            if (charge >= 0 && decharge == 0) {\n\n                msg.payload = charge.toFixed(2);\n                \n            }else if (charge == 0 && decharge >= 0){\n\n                decharge = -decharge;\n                msg.payload = decharge.toFixed(2);\n\n            }else{\n\n                msg.payload = 0;\n\n            }\n\n        }\n        //nouveau Parametre pour mqtt en custom\n        msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i;\n        node.send(msg);\n    }\n\n\n\n   \n\n/*qpgsn*/\n}else{\n\n    \n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false' && msg.topic == topic){\n                \n                let payload = msg.payload\n                \n                /*-------------------------------------------------*/\n                //1 Batterie charge en watt qpgs\n                /*-------------------------------------------------*/\n\n                let charge = payload[11] * payload[12];\n                msg.payload = charge.toFixed(2);\n\n                msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i + '01';\n                node.send(msg);\n\n\n\n                /*-------------------------------------------------*/\n                //2 Batterie Decharge en watt qpgs\n                /*-------------------------------------------------*/\n                charge = payload[11] * payload[26];\n                msg.payload = charge.toFixed(2);\n\n                msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i + '02';\n                node.send(msg);\n\n\n\n                /*-------------------------------------------------*/\n                //3 Batterie charge positive, Decharge négative en watt qpgs\n                /*-------------------------------------------------*/\n\n                charge = payload[11] * payload[12];\n                let decharge = payload[11] * payload[26];;\n\n                if (charge >= 0 && decharge == 0) {\n\n                    msg.payload = charge.toFixed(2);\n\n                } else if (charge == 0 && decharge >= 0) {\n\n                    decharge = -decharge;\n                    msg.payload = decharge.toFixed(2);\n\n                } else {\n\n                    msg.payload = 0;\n\n                }\n\n                msg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/' + name + i + '03';\n                node.send(msg);\n\n                \n\n            }\n    }\n\n\n}\n\nmsg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/config/onduleur' + msg.voltronicNum + '_status';\nmsg.payload = msg.status;\nnode.send(msg);",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 780,
        "wires": [
            [
                "9355216312bfe912"
            ]
        ]
    },
    {
        "id": "9355216312bfe912",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "link out 12",
        "mode": "link",
        "links": [
            "64c818fd3c742a69"
        ],
        "x": 1085,
        "y": 780,
        "wires": []
    },
    {
        "id": "0d6ae415d8d9761c",
        "type": "mqtt in",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "mqtt in dynamique",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "dea3f37bb42d7a81",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 510,
        "y": 1000,
        "wires": [
            [
                "eaaa0f0faf58fbea"
            ]
        ]
    },
    {
        "id": "73bdfb75737622b7",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "function 30",
        "func": "msg.action = \"subscribe\";\nmsg.topic = global.get(\"parametre.mqtt.DirSmart\") + '/Modification-voltronic/#';\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 1000,
        "wires": [
            [
                "0d6ae415d8d9761c",
                "9af4e59534a9f1d0"
            ]
        ]
    },
    {
        "id": "28bb4da3aead9cb0",
        "type": "inject",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1000,
        "wires": [
            [
                "73bdfb75737622b7"
            ]
        ]
    },
    {
        "id": "010593246c088110",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "58e1bd9f6bb96874"
        ],
        "x": 1085,
        "y": 1000,
        "wires": []
    },
    {
        "id": "f01b7452f9cd5bdf",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "fadbd7bea4084175",
        "name": "function 43",
        "func": "setTimeout(function () {\n    msg.topic = \"QSID\";\n    msg.payload = new Buffer([81, 83, 73, 68, 187, 5, 13]);\n    node.send(msg);\n}, 20000);\n\nsetTimeout(function () {\n    msg.topic = \"QID\";\n    msg.payload = new Buffer([81, 73, 68, 214, 234, 13]);\n    node.send(msg);\n}, 21000);\n\nsetTimeout(function () {\n    msg.topic = \"QVFW\";\n    msg.payload = new Buffer([81, 86, 70, 87, 98, 153, 13]);\n    node.send(msg);\n}, 22000);\n\nsetTimeout(function () {\n    msg.topic = \"QMN\";\n    msg.payload = new Buffer([81, 77, 78, 187, 100, 13]);\n    node.send(msg);\n}, 23000);\n\nif (global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".full\") === true) {\n    setTimeout(function () {\n        msg.topic = \"qpigs2\";\n        msg.payload = new Buffer([81, 80, 73, 71, 83, 50, 104, 45, 13]);\n        node.send(msg);\n    }, 100);\n}\n\n/* ==================== FONCTION CRC (à placer AVANT les setTimeout) ==================== */\n\nfunction createMessage(command) {\n    // Fonction CRC16 XModem\n    function crc16(str, crc = 0, xorout = 0) {\n        for (let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n            t = (crc >> 8) ^ str.charCodeAt(i);\n            t ^= t >> 4;\n            crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n        }\n        return crc ^ xorout;\n    }\n\n    // Encode la commande en HEX et ajoute le CRC\n    let commandHex = Buffer.from(command).toString('hex');\n    let crcHex = crc16(command).toString(16).padStart(4, '0');\n    let messageHex = commandHex + crcHex + \"0D\";\n    return Buffer.from(messageHex, \"hex\");\n}\n\n/* ==================== ÉNERGIES PV (Mois, Année, Total) ==================== */\n\n// ⚠️ IMPORTANT: Capturer msg pour les setTimeout\nconst msgCapture = msg;\nconst voltronicNum = msg.voltronicNum;\n\n// QEM - Énergie PV du mois\nsetTimeout(function () {\n    const now = new Date();\n    const year = now.getFullYear().toString();\n    const month = (now.getMonth() + 1).toString().padStart(2, '0');\n    const dateStr = year + month;\n\n    const newMsg = {\n        topic: \"qem\",\n        payload: createMessage(\"QEM\" + dateStr),\n        energieDate: dateStr,\n        voltronicNum: voltronicNum\n    };\n    node.send(newMsg);\n}, 24000);\n\n// QEY - Énergie PV de l'année\nsetTimeout(function () {\n    const year = new Date().getFullYear().toString();\n\n    const newMsg = {\n        topic: \"qey\",\n        payload: createMessage(\"QEY\" + year),\n        energieDate: year,\n        voltronicNum: voltronicNum\n    };\n    node.send(newMsg);\n}, 25000);\n\n// QET - Énergie PV totale\nsetTimeout(function () {\n    const newMsg = {\n        topic: \"qet\",\n        payload: createMessage(\"QET\"),\n        voltronicNum: voltronicNum\n    };\n    node.send(newMsg);\n}, 26000);\n\n/* ==================== ÉNERGIES LOAD (Mois, Année, Total) ==================== */\n\n// QLM - Énergie Load du mois\nsetTimeout(function () {\n    const now = new Date();\n    const year = now.getFullYear().toString();\n    const month = (now.getMonth() + 1).toString().padStart(2, '0');\n    const dateStr = year + month;\n\n    const newMsg = {\n        topic: \"qlm\",\n        payload: createMessage(\"QLM\" + dateStr),\n        energieDate: dateStr,\n        voltronicNum: voltronicNum\n    };\n    node.send(newMsg);\n}, 27000);\n\n// QLY - Énergie Load de l'année (avec gestion NAK)\nif (global.get('onduleurs.onduleur_' + voltronicNum + '.qly') !== \"NAK\") {\n    setTimeout(function () {\n        const year = new Date().getFullYear().toString();\n\n        const newMsg = {\n            topic: \"qly\",\n            payload: createMessage(\"QLY\" + year),\n            energieDate: year,\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 28000);\n}\n\n// QLT - Énergie Load totale\nsetTimeout(function () {\n    const newMsg = {\n        topic: \"qlt\",\n        payload: createMessage(\"QLT\"),\n        voltronicNum: voltronicNum\n    };\n    node.send(newMsg);\n}, 29000);\n\n/* ==================== MULTI-ONDULEURS (QPGS) ==================== */\n\nif (global.get('onduleurs.onduleur_' + voltronicNum + '.qpgs') != false) {\n    let seconde = 30000; // Commence après les énergies\n    for (let i = 1; i <= 8; i++) {\n        (function (index) {\n            setTimeout(function () {\n                const newMsg = {\n                    topic: \"qpgs\" + index,\n                    payload: (index == 1 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_1\") != false) ? new Buffer([81, 80, 71, 83, 49, 47, 251, 13]) :\n                        (index == 2 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_2\") != false) ? new Buffer([81, 80, 71, 83, 50, 31, 152, 13]) :\n                            (index == 3 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_3\") != false) ? new Buffer([81, 80, 71, 83, 51, 15, 185, 13]) :\n                                (index == 4 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_4\") != false) ? new Buffer([81, 80, 71, 83, 52, 127, 94, 13]) :\n                                    (index == 5 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_5\") != false) ? new Buffer([81, 80, 71, 83, 53, 111, 127, 13]) :\n                                        (index == 6 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_6\") != false) ? new Buffer([81, 80, 71, 83, 54, 95, 28, 13]) :\n                                            (index == 7 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_7\") != false) ? new Buffer([81, 80, 71, 83, 55, 79, 61, 13]) :\n                                                (index == 8 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_8\") != false) ? new Buffer([81, 80, 71, 83, 56, 190, 210, 13]) :\n                                                    (index == 9 && global.get(\"onduleurs.onduleur_\" + voltronicNum + \".qpgs_9\") != false) ? new Buffer([81, 80, 71, 83, 57, 174, 243, 13]) :\n                                                        'Erreur',\n                    voltronicNum: voltronicNum\n                };\n                node.send(newMsg);\n            }, seconde + index * 1200);\n        })(i);\n    }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 40,
        "wires": [
            [
                "20daf792de563b06"
            ]
        ]
    },
    {
        "id": "f6bd0e7e3dfb7856",
        "type": "inject",
        "z": "32d802144ee0875f",
        "g": "fadbd7bea4084175",
        "name": "start",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 40,
        "wires": [
            [
                "6935b6e0a599d7b2"
            ]
        ]
    },
    {
        "id": "20daf792de563b06",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "fadbd7bea4084175",
        "name": "To-serial-ou",
        "mode": "link",
        "links": [
            "58e1bd9f6bb96874"
        ],
        "x": 515,
        "y": 40,
        "wires": []
    },
    {
        "id": "830f999d7ccf1a5f",
        "type": "serial request",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "",
        "serial": "f09d59b81c49a19e",
        "x": 670,
        "y": 460,
        "wires": [
            [
                "e98702b905e4a183",
                "09f79937aa931c75"
            ]
        ]
    },
    {
        "id": "e98702b905e4a183",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "onduleur",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 480,
        "wires": []
    },
    {
        "id": "09f79937aa931c75",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "Parsing-response-ou",
        "mode": "link",
        "links": [
            "394fae8b341ca3dc"
        ],
        "x": 1085,
        "y": 460,
        "wires": []
    },
    {
        "id": "5a6c4281354788fb",
        "type": "serial request",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "",
        "serial": "f15ccaad81cb6adf",
        "x": 670,
        "y": 520,
        "wires": [
            [
                "5c9f282f252bcdf8",
                "b1ac024e439f5649"
            ]
        ]
    },
    {
        "id": "5c9f282f252bcdf8",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "onduleur",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 540,
        "wires": []
    },
    {
        "id": "b1ac024e439f5649",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "Parsing-response-ou",
        "mode": "link",
        "links": [
            "394fae8b341ca3dc"
        ],
        "x": 1085,
        "y": 520,
        "wires": []
    },
    {
        "id": "b6bdf402fae56196",
        "type": "serial request",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "",
        "serial": "17ec3ca8d26a381a",
        "x": 670,
        "y": 580,
        "wires": [
            [
                "f1d39c7f15ba3e49",
                "4a2c1162e2839b16"
            ]
        ]
    },
    {
        "id": "f1d39c7f15ba3e49",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "onduleur",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 600,
        "wires": []
    },
    {
        "id": "4a2c1162e2839b16",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "80ce9def58d73fae",
        "name": "Parsing-response-ou",
        "mode": "link",
        "links": [
            "394fae8b341ca3dc"
        ],
        "x": 1085,
        "y": 580,
        "wires": []
    },
    {
        "id": "6935b6e0a599d7b2",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "fadbd7bea4084175",
        "name": "true",
        "func": "\n    // nombre d'entrée onduleur\n    let count = global.get(\"countUSBOnduleur\")\n    for (let i = 1; i <= count; i++) {\n        \n        //vérification si l'onduleur est voltronic\n        if (global.get(\"onduleurs.onduleur_\" + i + \".type\") == 'voltronic' ){\n\n            msg.voltronicNum = i;\n            node.send(msg);\n\n        }\n\n    }\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 40,
        "wires": [
            [
                "f01b7452f9cd5bdf"
            ]
        ]
    },
    {
        "id": "d12f4cf116cabefb",
        "type": "function",
        "z": "32d802144ee0875f",
        "name": "function 66",
        "func": "if (global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'ip') {\n\n    let chemin = global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".chemin\").split(\":\");\n    msg.host = chemin[0];\n    msg.port = chemin[1];\n    \n    node.send([msg, , , ,]);\n\n}\n\nif (msg.voltronicNum == 1 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial') {\n\n    node.send([, msg, , ,]);\n\n}\n\nif (msg.voltronicNum == 2 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial'){\n\n    node.send([,,msg,,]);\n\n}\n\nif (msg.voltronicNum == 3 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial'){\n\n    node.send([,,,msg,]);       \n          \n}\n\nif (msg.voltronicNum == 4 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".ComType\") == 'serial') {\n\n    node.send([,,,,msg]);\n          \n}",
        "outputs": 5,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 460,
        "wires": [
            [],
            [
                "6d3f58fcc31852f0"
            ],
            [
                "830f999d7ccf1a5f"
            ],
            [
                "5a6c4281354788fb"
            ],
            [
                "b6bdf402fae56196"
            ]
        ]
    },
    {
        "id": "fdea8bd29f439fe1",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "Remplace mqtt => onduleur",
        "func": "// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\n\n/********************* si ip *********************/\nfor (let i = 1; i <= count; i++) {\n\n    let dir = global.get(\"parametre.mqtt.DirSmart\") + '/Modification-voltronic/' + i + '/Param';\n    let payload = '';\n\n\n    /*-------------------------------------------------*/\n    //parametre 01\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '01') {\n\n        msg.voltronicNum = i;\n\n        //option remplace\n        msg.payload = (msg.payload == \"UTI\") ? new Buffer([80,79,80,48,48,194,72,13]) :\n                  (msg.payload == \"SOL\") ? new Buffer([80,79,80,48,49,210,105,13]) :\n                  (msg.payload == \"SBU\") ? new Buffer([80,79,80,48,50,226,11,13]) :\n                  'Erreur';\n\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 02\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '02') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"010\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,49,48,77,185,13]) :\n                (msg.payload == \"020\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,50,48,24,234,13]) :\n                (msg.payload == \"030\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,51,48,43,219,13]) :\n                (msg.payload == \"040\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,52,48,178,76,13]) :\n                (msg.payload == \"050\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,53,48,129,125,13]) :\n                (msg.payload == \"060\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,54,48,212,46,13]) :\n                (msg.payload == \"070\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,55,48,231,31,13]) :\n                (msg.payload == \"080\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,78,67,72,71,67,48,56,48,247,33,13]) :\n                (msg.payload == \"010\") ? new Buffer([77,78,67,72,71,67,48,48,49,48,18,59,13]) :\n                (msg.payload == \"020\") ? new Buffer([77,78,67,72,71,67,48,48,50,48,71,104,13]) :\n                (msg.payload == \"030\") ? new Buffer([77,78,67,72,71,67,48,48,51,48,116,89,13]) :\n                (msg.payload == \"040\") ? new Buffer([77,78,67,72,71,67,48,48,52,48,237,206,13]) :\n                (msg.payload == \"050\") ? new Buffer([77,78,67,72,71,67,48,48,53,48,222,255,13]) :\n                (msg.payload == \"060\") ? new Buffer([77,78,67,72,71,67,48,48,54,48,139,172,13]) :\n                (msg.payload == \"070\") ? new Buffer([77,78,67,72,71,67,48,48,55,48,184,157,13]) :\n                (msg.payload == \"080\") ? new Buffer([77,78,67,72,71,67,48,48,56,48,168,163,13]) :\n                (msg.payload == \"090\") ? new Buffer([77,78,67,72,71,67,48,48,57,48,155,146,13]) :\n                (msg.payload == \"100\") ? new Buffer([77,78,67,72,71,67,48,49,48,48,22,58,13]) :\n                (msg.payload == \"110\") ? new Buffer([77,78,67,72,71,67,48,49,49,48,37,11,13]) :\n                (msg.payload == \"120\") ? new Buffer([77,78,67,72,71,67,48,49,50,48,112,88,13]) :\n                (msg.payload == \"130\") ? new Buffer([77,78,67,72,71,67,48,48,49,51,48,106,115,13]) :\n                                'Erreur';\n\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 05\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '05') {\n    \n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"AGn\") ? new Buffer([80,66,84,48,48,39,14,13]) :\n                (msg.payload == \"FLd\") ? new Buffer([80,66,84,48,49,55,47,13]) :\n                (msg.payload == \"USE\") ? new Buffer([80,66,84,48,50,7,76,13]) :\n                (msg.payload == \"PYL\") ? new Buffer([80,66,84,48,51,23,109,13]) :\n                (msg.payload == \"uEC\") ? new Buffer([80,66,84,48,52,103,138,13]) :\n                (msg.payload == \"SOL\") ? new Buffer([80,66,84,48,53,119,171,13]) :\n                (msg.payload == \"LIb\") ? new Buffer([80,66,84,48,54,71,200,13]) :\n                (msg.payload == \"LIc\") ? new Buffer([80,66,84,48,55,87,233,13]) :\n                'Erreur';\n\n    }\n\n\n    /*-------------------------------------------------*/\n    //parametre 11\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '11') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"02\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,85,67,72,71,67,48,48,50,181,209,13]) :\n                (msg.payload == \"10\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,85,67,72,71,67,48,49,48,166,162,13]) :\n                (msg.payload == \"20\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,85,67,72,71,67,48,50,48,243,241,13]) :\n                (msg.payload == \"30\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,85,67,72,71,67,48,51,48,192,192,13]) :\n                (msg.payload == \"50\" && global.get(i + \"qpgs1\") == false) ? new Buffer([77,85,67,72,71,67,48,53,48,106,102,13]) :\n                (msg.payload == \"02\" ) ? new Buffer([77,85,67,72,71,67,48,48,48,50,86,13,13]) :\n                (msg.payload == \"10\" ) ? new Buffer([77,85,67,72,71,67,48,48,49,48,69,126,13]) :\n                (msg.payload == \"20\" ) ? new Buffer([77,85,67,72,71,67,48,48,50,48,16,45,13]) :\n                (msg.payload == \"30\" ) ? new Buffer([77,85,67,72,71,67,48,48,51,48,35,28,13]) :\n                (msg.payload == \"40\" ) ? new Buffer([77,85,67,72,71,67,48,48,52,48,186,139,13]) :\n                (msg.payload == \"50\" ) ? new Buffer([77,85,67,72,71,67,48,48,53,48,137,186,13]) :\n                (msg.payload == \"60\" ) ? new Buffer([77,85,67,72,71,67,48,48,54,48,220,233,13]) :\n                (msg.payload == \"70\" ) ? new Buffer([77,85,67,72,71,67,48,48,55,48,239,216,13]) :\n                (msg.payload == \"80\" ) ? new Buffer([77,85,67,72,71,67,48,48,56,48,255,230,13]) :\n                (msg.payload == \"90\" ) ? new Buffer([77,85,67,72,71,67,48,48,57,48,204,215,13]) :\n                (msg.payload == \"100\" ) ? new Buffer([77,85,67,72,71,67,48,49,48,48,65,127,13]) :\n                (msg.payload == \"110\" ) ? new Buffer([77,85,67,72,71,67,48,49,49,48,114,78,13]) :\n                (msg.payload == \"120\" ) ? new Buffer([77,85,67,72,71,67,48,49,50,48,39,29,13]) :\n                'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 12\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '12') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"22.0\") ? new Buffer([80,66,67,86,50,50,46,48,115,210,13]) :\n                (msg.payload == \"22.5\") ? new Buffer([80,66,67,86,50,50,46,53,35,119,13]) :\n                (msg.payload == \"23.0\") ? new Buffer([80,66,67,86,50,51,46,48,68,226,13]) :\n                (msg.payload == \"23.5\") ? new Buffer([80,66,67,86,50,51,46,53,20,71,13]) :\n                (msg.payload == \"24.0\") ? new Buffer([80,66,67,86,50,52,46,48,193,114,13]) :\n                (msg.payload == \"24.5\") ? new Buffer([80,66,67,86,50,52,46,53,145,215,13]) :\n                (msg.payload == \"25.0\") ? new Buffer([80,66,67,86,50,53,46,48,246,66,13]) :\n                (msg.payload == \"25.5\") ? new Buffer([80,66,67,86,50,53,46,53,166,231,13]) :\n                (msg.payload == \"44.0\") ? new Buffer([80,66,67,86,52,52,46,48,230,235,13]) :\n                (msg.payload == \"45.0\") ? new Buffer([80,66,67,86,52,53,46,48,209,219,13]) :\n                (msg.payload == \"46.0\") ? new Buffer([80,66,67,86,52,54,46,48,136,139,13]) :\n                (msg.payload == \"47.0\") ? new Buffer([80,66,67,86,52,55,46,48,191,187,13]) :\n                (msg.payload == \"48.0\") ? new Buffer([80,66,67,86,52,56,46,48,147,138,13]) :\n                (msg.payload == \"49.0\") ? new Buffer([80,66,67,86,52,57,46,48,164,186,13]) :\n                (msg.payload == \"50.0\") ? new Buffer([80,66,67,86,53,48,46,48,76,159,13]) :\n                (msg.payload == \"51.0\") ? new Buffer([80,66,67,86,53,49,46,48,123,175,13]) :\n                msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 13\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '13') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"24.0\") ? new Buffer([80,66,68,86,50,52,46,48,147,48]) :\n                (msg.payload == \"24.5\") ? new Buffer([80,66,68,86,50,52,46,53,89,150,13]) :\n                (msg.payload == \"25.0\") ? new Buffer([80,66,68,86,50,53,46,48,62,3,13]) :\n                (msg.payload == \"25.5\") ? new Buffer([80,66,68,86,50,53,46,53,110,166,13]) :\n                (msg.payload == \"26.0\") ? new Buffer([80,66,68,86,50,54,46,48,103,83,13]) :\n                (msg.payload == \"26.5\") ? new Buffer([80,66,68,86,50,54,46,53,55,246,13]) :\n                (msg.payload == \"27.0\") ? new Buffer([80,66,68,86,50,55,46,48,80,99,13]) :\n                (msg.payload == \"27.5\") ? new Buffer([80,66,68,86,50,55,46,53,198,13]) :\n                (msg.payload == \"28.0\") ? new Buffer([80,66,68,86,50,56,46,48,124,82,13]) :\n                (msg.payload == \"28.5\") ? new Buffer([80,66,68,86,50,56,46,53,44,247,13]) :\n                (msg.payload == \"29.0\") ? new Buffer([80,66,68,86,50,57,46,48,75,98,13]) :\n                (msg.payload == \"48.0\") ? new Buffer([80,66,68,86,52,56,46,48,91,203,13]) :\n                (msg.payload == \"49.0\") ? new Buffer([80,66,68,86,52,57,46,48,108,251,13]) :\n                (msg.payload == \"50.0\") ? new Buffer([80,66,68,86,53,48,46,48,132,222,13]) :\n                (msg.payload == \"51.0\") ? new Buffer([80,66,68,86,53,49,46,48,179,238,13]) :\n                (msg.payload == \"52.0\") ? new Buffer([80,66,68,86,53,50,46,48,234,190,13]) :\n                (msg.payload == \"53.0\") ? new Buffer([80,66,68,86,53,51,46,48,221,142,13]) :\n                (msg.payload == \"54.0\") ? new Buffer([80,66,68,86,53,52,46,48,88,30,13]) :\n                (msg.payload == \"55.0\") ? new Buffer([80,66,68,86,53,53,46,48,111,46,13]) :\n                (msg.payload == \"56.0\") ? new Buffer([80,66,68,86,53,54,46,48,54,126,13]) :\n                (msg.payload == \"57.0\") ? new Buffer([80,66,68,86,53,55,46,48,20,224]) :\n                (msg.payload == \"58.0\") ? new Buffer([80,66,68,86,53,56,46,48,45,127,13]) :\n                msg.payload;\n    }\n\n\n    /*-------------------------------------------------*/\n    //parametre 16\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '16') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"CUE\") ? new Buffer([80,67,80,48,48,141,122,13]) :\n                (msg.payload == \"CSO\") ? new Buffer([80,67,80,48,49,157,91,13]) :\n                (msg.payload == \"SNU\") ? new Buffer([80,67,80,48,50,173,56,13]) :\n                (msg.payload == \"OSO\") ? new Buffer([80,67,80,48,51,189,25,13]) :\n                msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 26\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '26') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"24.0\") ? new Buffer([80,67,86,86,50,52,46,48,32,150,13]) :\n                    (msg.payload == \"24.1\") ? new Buffer([80,67,86,86,50,52,46,49,48,183,13]) :\n                    (msg.payload == \"24.2\") ? new Buffer([80,67,86,86,50,52,46,50,212,13]) :\n                    (msg.payload == \"24.3\") ? new Buffer([80,67,86,86,50,52,46,51,16,245,13]) :\n                    (msg.payload == \"24.4\") ? new Buffer([80,67,86,86,50,52,46,52,96,18,13]) :\n                    (msg.payload == \"24.5\") ? new Buffer([80,67,86,86,50,52,46,53,112,51,13]) :\n                    (msg.payload == \"24.6\") ? new Buffer([80,67,86,86,50,52,46,54,64,80,13]) :\n                    (msg.payload == \"24.7\") ? new Buffer([80,67,86,86,50,52,46,55,80,113,13]) :\n                    (msg.payload == \"24.8\") ? new Buffer([80,67,86,86,50,52,46,56,161,158,13]) :\n                    (msg.payload == \"24.9\") ? new Buffer([80,67,86,86,50,52,46,57,177,191,13]) :\n                    (msg.payload == \"25.0\") ? new Buffer([80,67,86,86,50,53,46,48,23,166,13]) :\n                    (msg.payload == \"25.1\") ? new Buffer([80,67,86,86,50,53,46,49,120,112]) :\n                    (msg.payload == \"25.2\") ? new Buffer([80,67,86,86,50,53,46,50,55,228,13]) :\n                    (msg.payload == \"25.3\") ? new Buffer([80,67,86,86,50,53,46,51,39,197,13]) :\n                    (msg.payload == \"25.4\") ? new Buffer([80,67,86,86,50,53,46,52,87,34,13]) :\n                    (msg.payload == \"25.5\") ? new Buffer([80,67,86,86,50,53,46,53,71,3,13]) :\n                    (msg.payload == \"25.6\") ? new Buffer([80,67,86,86,50,53,46,54,119,96,13]) :\n                    (msg.payload == \"25.7\") ? new Buffer([80,67,86,86,50,53,46,55,103,65,13]) :\n                    (msg.payload == \"25.8\") ? new Buffer([80,67,86,86,50,53,46,56,150,174,13]) :\n                    (msg.payload == \"25.9\") ? new Buffer([80,67,86,86,50,53,46,57,134,143,13]) :\n                    (msg.payload == \"26.0\") ? new Buffer([80,67,86,86,50,54,46,48,78,246,13]) :\n                    (msg.payload == \"26.1\") ? new Buffer([80,67,86,86,50,54,46,49,94,215,13]) :\n                    (msg.payload == \"26.2\") ? new Buffer([80,67,86,86,50,54,46,50,110,180,13]) :\n                    (msg.payload == \"26.3\") ? new Buffer([80,67,86,86,50,54,46,51,126,149,13]) :\n                    (msg.payload == \"26.4\") ? new Buffer([80,67,86,86,50,54,46,52,231,32]) :\n                    (msg.payload == \"26.5\") ? new Buffer([80,67,86,86,50,54,46,53,30,83,13]) :\n                    (msg.payload == \"26.6\") ? new Buffer([80,67,86,86,50,54,46,54,46,48,13]) :\n                    (msg.payload == \"26.7\") ? new Buffer([80,67,86,86,50,54,46,55,62,17,13]) :\n                    (msg.payload == \"26.8\") ? new Buffer([80,67,86,86,50,54,46,56,207,254,13]) :\n                    (msg.payload == \"26.9\") ? new Buffer([80,67,86,86,50,54,46,57,223,223,13]) :\n                    (msg.payload == \"27.0\") ? new Buffer([80,67,86,86,50,55,46,48,121,198,13]) :\n                    (msg.payload == \"27.1\") ? new Buffer([80,67,86,86,50,55,46,49,105,231,13]) :\n                    (msg.payload == \"27.2\") ? new Buffer([80,67,86,86,50,55,46,50,89,132,13]) :\n                    (msg.payload == \"27.3\") ? new Buffer([80,67,86,86,50,55,46,51,73,165,13]) :\n                    (msg.payload == \"27.4\") ? new Buffer([80,67,86,86,50,55,46,52,57,66,13]) :\n                    (msg.payload == \"27.5\") ? new Buffer([80,67,86,86,50,55,46,53,41,99,13]) :\n                    (msg.payload == \"27.6\") ? new Buffer([80,67,86,86,50,55,46,54,25,0,13]) :\n                    (msg.payload == \"27.7\") ? new Buffer([80,67,86,86,50,55,46,55,146,16]) :\n                    (msg.payload == \"27.8\") ? new Buffer([80,67,86,86,50,55,46,56,248,206,13]) :\n                    (msg.payload == \"27.9\") ? new Buffer([80,67,86,86,50,55,46,57,232,239,13]) :\n                    (msg.payload == \"28.0\") ? new Buffer([80,67,86,86,50,56,46,48,85,247,13]) :\n                    (msg.payload == \"28.1\") ? new Buffer([80,67,86,86,50,56,46,49,69,214,13]) :\n                    (msg.payload == \"28.2\") ? new Buffer([80,67,86,86,50,56,46,50,117,181,13]) :\n                    (msg.payload == \"28.3\") ? new Buffer([80,67,86,86,50,56,46,51,101,148,13]) :\n                    (msg.payload == \"28.4\") ? new Buffer([80,67,86,86,50,56,46,52,21,115,13]) :\n                    (msg.payload == \"28.5\") ? new Buffer([80,67,86,86,50,56,46,53,85,32]) :\n                    (msg.payload == \"28.6\") ? new Buffer([80,67,86,86,50,56,46,54,53,49,13]) :\n                    (msg.payload == \"28.7\") ? new Buffer([80,67,86,86,50,56,46,55,37,16,13]) :\n                    (msg.payload == \"28.8\") ? new Buffer([80,67,86,86,50,56,46,56,212,255,13]) :\n                    (msg.payload == \"28.9\") ? new Buffer([80,67,86,86,50,56,46,57,196,222,13]) :\n                    (msg.payload == \"29.0\") ? new Buffer([80,67,86,86,50,57,46,48,98,199,13]) :\n                    (msg.payload == \"29.1\") ? new Buffer([80,67,86,86,50,57,46,49,114,230,13]) :\n                    (msg.payload == \"29.2\") ? new Buffer([80,67,86,86,50,57,46,50,66,133,13]) :\n                    (msg.payload == \"29.3\") ? new Buffer([80,67,86,86,50,57,46,51,82,164,13]) :\n                    (msg.payload == \"29.4\") ? new Buffer([80,67,86,86,50,57,46,52,34,67,13]) :\n                    (msg.payload == \"29.5\") ? new Buffer([80,67,86,86,50,57,46,53,50,98,13]) :\n                    (msg.payload == \"29.6\") ? new Buffer([80,67,86,86,50,57,46,54,32,16]) :\n                    (msg.payload == \"29.7\") ? new Buffer([80,67,86,86,50,57,46,55,18,32,13]) :\n                    (msg.payload == \"29.8\") ? new Buffer([80,67,86,86,50,57,46,56,227,207,13]) :\n                    (msg.payload == \"29.9\") ? new Buffer([80,67,86,86,50,57,46,57,243,238,13]) :\n                    (msg.payload == \"30.0\") ? new Buffer([80,67,86,86,51,48,46,48,138,226,13]) :\n                    (msg.payload == \"30.1\") ? new Buffer([80,67,86,86,51,48,46,49,154,195,13]) :\n                    (msg.payload == \"30.2\") ? new Buffer([80,67,86,86,51,48,46,50,170,160,13]) :\n                    (msg.payload == \"30.3\") ? new Buffer([80,67,86,86,51,48,46,51,186,129,13]) :\n                    (msg.payload == \"30.4\") ? new Buffer([80,67,86,86,51,48,46,52,202,102,13]) :\n                    (msg.payload == \"30.5\") ? new Buffer([80,67,86,86,51,48,46,53,218,71,13]) :\n                    (msg.payload == \"30.6\") ? new Buffer([80,67,86,86,51,48,46,54,234,36,13]) :\n                    (msg.payload == \"30.7\") ? new Buffer([80,67,86,86,51,48,46,55,250,5,13]) :\n                    (msg.payload == \"30.8\") ? new Buffer([80,67,86,86,51,48,46,56,190,160]) :\n                    (msg.payload == \"30.9\") ? new Buffer([80,67,86,86,51,48,46,57,27,203,13]) :\n                    (msg.payload == \"31.0\") ? new Buffer([80,67,86,86,51,49,46,48,189,210,13]) :\n                    (msg.payload == \"31.1\") ? new Buffer([80,67,86,86,51,49,46,49,173,243,13]) :\n                    (msg.payload == \"31.2\") ? new Buffer([80,67,86,86,51,49,46,50,157,144,13]) :\n                    (msg.payload == \"31.3\") ? new Buffer([80,67,86,86,51,49,46,51,141,177,13]) :\n                    (msg.payload == \"31.4\") ? new Buffer([80,67,86,86,51,49,46,52,253,86,13]) :\n                    (msg.payload == \"31.5\") ? new Buffer([80,67,86,86,51,49,46,53,237,119,13]) :\n                    (msg.payload == \"24.0\") ? new Buffer([80,67,86,86,50,52,46,48,32,150,13]) :\n                    (msg.payload == \"24.1\") ? new Buffer([80,67,86,86,50,52,46,49,48,183,13]) :\n                    (msg.payload == \"24.2\") ? new Buffer([80,67,86,86,50,52,46,50,212,13]) :\n                    (msg.payload == \"24.3\") ? new Buffer([80,67,86,86,50,52,46,51,16,245,13]) :\n                    (msg.payload == \"24.4\") ? new Buffer([80,67,86,86,50,52,46,52,96,18,13]) :\n                    (msg.payload == \"24.5\") ? new Buffer([80,67,86,86,50,52,46,53,112,51,13]) :\n                    (msg.payload == \"24.6\") ? new Buffer([80,67,86,86,50,52,46,54,64,80,13]) :\n                    (msg.payload == \"24.7\") ? new Buffer([80,67,86,86,50,52,46,55,80,113,13]) :\n                    (msg.payload == \"24.8\") ? new Buffer([80,67,86,86,50,52,46,56,161,158,13]) :\n                    (msg.payload == \"24.9\") ? new Buffer([80,67,86,86,50,52,46,57,177,191,13]) :\n                    (msg.payload == \"25.0\") ? new Buffer([80,67,86,86,50,53,46,48,23,166,13]) :\n                    (msg.payload == \"25.1\") ? new Buffer([80,67,86,86,50,53,46,49,120,112]) :\n                    (msg.payload == \"25.2\") ? new Buffer([80,67,86,86,50,53,46,50,55,228,13]) :\n                    (msg.payload == \"25.3\") ? new Buffer([80,67,86,86,50,53,46,51,39,197,13]) :\n                    (msg.payload == \"25.4\") ? new Buffer([80,67,86,86,50,53,46,52,87,34,13]) :\n                    (msg.payload == \"25.5\") ? new Buffer([80,67,86,86,50,53,46,53,71,3,13]) :\n                    (msg.payload == \"25.6\") ? new Buffer([80,67,86,86,50,53,46,54,119,96,13]) :\n                    (msg.payload == \"25.7\") ? new Buffer([80,67,86,86,50,53,46,55,103,65,13]) :\n                    (msg.payload == \"25.8\") ? new Buffer([80,67,86,86,50,53,46,56,150,174,13]) :\n                    (msg.payload == \"25.9\") ? new Buffer([80,67,86,86,50,53,46,57,134,143,13]) :\n                    (msg.payload == \"26.0\") ? new Buffer([80,67,86,86,50,54,46,48,78,246,13]) :\n                    (msg.payload == \"26.1\") ? new Buffer([80,67,86,86,50,54,46,49,94,215,13]) :\n                    (msg.payload == \"26.2\") ? new Buffer([80,67,86,86,50,54,46,50,110,180,13]) :\n                    (msg.payload == \"26.3\") ? new Buffer([80,67,86,86,50,54,46,51,126,149,13]) :\n                    (msg.payload == \"26.4\") ? new Buffer([80,67,86,86,50,54,46,52,231,32]) :\n                    (msg.payload == \"26.5\") ? new Buffer([80,67,86,86,50,54,46,53,30,83,13]) :\n                    (msg.payload == \"26.6\") ? new Buffer([80,67,86,86,50,54,46,54,46,48,13]) :\n                    (msg.payload == \"26.7\") ? new Buffer([80,67,86,86,50,54,46,55,62,17,13]) :\n                    (msg.payload == \"26.8\") ? new Buffer([80,67,86,86,50,54,46,56,207,254,13]) :\n                    (msg.payload == \"26.9\") ? new Buffer([80,67,86,86,50,54,46,57,223,223,13]) :\n                    (msg.payload == \"27.0\") ? new Buffer([80,67,86,86,50,55,46,48,121,198,13]) :\n                    (msg.payload == \"27.1\") ? new Buffer([80,67,86,86,50,55,46,49,105,231,13]) :\n                    (msg.payload == \"27.2\") ? new Buffer([80,67,86,86,50,55,46,50,89,132,13]) :\n                    (msg.payload == \"27.3\") ? new Buffer([80,67,86,86,50,55,46,51,73,165,13]) :\n                    (msg.payload == \"27.4\") ? new Buffer([80,67,86,86,50,55,46,52,57,66,13]) :\n                    (msg.payload == \"27.5\") ? new Buffer([80,67,86,86,50,55,46,53,41,99,13]) :\n                    (msg.payload == \"27.6\") ? new Buffer([80,67,86,86,50,55,46,54,25,0,13]) :\n                    (msg.payload == \"27.7\") ? new Buffer([80,67,86,86,50,55,46,55,146,16]) :\n                    (msg.payload == \"27.8\") ? new Buffer([80,67,86,86,50,55,46,56,248,206,13]) :\n                    (msg.payload == \"27.9\") ? new Buffer([80,67,86,86,50,55,46,57,232,239,13]) :\n                    (msg.payload == \"28.0\") ? new Buffer([80,67,86,86,50,56,46,48,85,247,13]) :\n                    (msg.payload == \"28.1\") ? new Buffer([80,67,86,86,50,56,46,49,69,214,13]) :\n                    (msg.payload == \"28.2\") ? new Buffer([80,67,86,86,50,56,46,50,117,181,13]) :\n                    (msg.payload == \"28.3\") ? new Buffer([80,67,86,86,50,56,46,51,101,148,13]) :\n                    (msg.payload == \"28.4\") ? new Buffer([80,67,86,86,50,56,46,52,21,115,13]) :\n                    (msg.payload == \"28.5\") ? new Buffer([80,67,86,86,50,56,46,53,85,32]) :\n                    (msg.payload == \"28.6\") ? new Buffer([80,67,86,86,50,56,46,54,53,49,13]) :\n                    (msg.payload == \"28.7\") ? new Buffer([80,67,86,86,50,56,46,55,37,16,13]) :\n                    (msg.payload == \"28.8\") ? new Buffer([80,67,86,86,50,56,46,56,212,255,13]) :\n                    (msg.payload == \"28.9\") ? new Buffer([80,67,86,86,50,56,46,57,196,222,13]) :\n                    (msg.payload == \"29.0\") ? new Buffer([80,67,86,86,50,57,46,48,98,199,13]) :\n                    (msg.payload == \"29.1\") ? new Buffer([80,67,86,86,50,57,46,49,114,230,13]) :\n                    (msg.payload == \"29.2\") ? new Buffer([80,67,86,86,50,57,46,50,66,133,13]) :\n                    (msg.payload == \"29.3\") ? new Buffer([80,67,86,86,50,57,46,51,82,164,13]) :\n                    (msg.payload == \"29.4\") ? new Buffer([80,67,86,86,50,57,46,52,34,67,13]) :\n                    (msg.payload == \"29.5\") ? new Buffer([80,67,86,86,50,57,46,53,50,98,13]) :\n                    (msg.payload == \"29.6\") ? new Buffer([80,67,86,86,50,57,46,54,32,16]) :\n                    (msg.payload == \"29.7\") ? new Buffer([80,67,86,86,50,57,46,55,18,32,13]) :\n                    (msg.payload == \"29.8\") ? new Buffer([80,67,86,86,50,57,46,56,227,207,13]) :\n                    (msg.payload == \"29.9\") ? new Buffer([80,67,86,86,50,57,46,57,243,238,13]) :\n                    (msg.payload == \"30.0\") ? new Buffer([80,67,86,86,51,48,46,48,138,226,13]) :\n                    (msg.payload == \"30.1\") ? new Buffer([80,67,86,86,51,48,46,49,154,195,13]) :\n                    (msg.payload == \"30.2\") ? new Buffer([80,67,86,86,51,48,46,50,170,160,13]) :\n                    (msg.payload == \"30.3\") ? new Buffer([80,67,86,86,51,48,46,51,186,129,13]) :\n                    (msg.payload == \"30.4\") ? new Buffer([80,67,86,86,51,48,46,52,202,102,13]) :\n                    (msg.payload == \"30.5\") ? new Buffer([80,67,86,86,51,48,46,53,218,71,13]) :\n                    (msg.payload == \"30.6\") ? new Buffer([80,67,86,86,51,48,46,54,234,36,13]) :\n                    (msg.payload == \"30.7\") ? new Buffer([80,67,86,86,51,48,46,55,250,5,13]) :\n                    (msg.payload == \"30.8\") ? new Buffer([80,67,86,86,51,48,46,56,190,160]) :\n                    (msg.payload == \"30.9\") ? new Buffer([80,67,86,86,51,48,46,57,27,203,13]) :\n                    (msg.payload == \"31.0\") ? new Buffer([80,67,86,86,51,49,46,48,189,210,13]) :\n                    (msg.payload == \"31.1\") ? new Buffer([80,67,86,86,51,49,46,49,173,243,13]) :\n                    (msg.payload == \"31.2\") ? new Buffer([80,67,86,86,51,49,46,50,157,144,13]) :\n                    (msg.payload == \"31.3\") ? new Buffer([80,67,86,86,51,49,46,51,141,177,13]) :\n                    (msg.payload == \"31.4\") ? new Buffer([80,67,86,86,51,49,46,52,253,86,13]) :\n                    (msg.payload == \"31.5\") ? new Buffer([80,67,86,86,51,49,46,53,237,119,13]) :\n                    (msg.payload == \"40.0\") ? new Buffer([80,67,86,86,52,48,46,48,219,207,13]) :\n                    (msg.payload == \"40.1\") ? new Buffer([80,67,86,86,52,48,46,49,203,238,13]) :\n                    (msg.payload == \"40.2\") ? new Buffer([80,67,86,86,52,48,46,50,251,141,13]) :\n                    (msg.payload == \"40.3\") ? new Buffer([80,67,86,86,52,48,46,51,235,172,13]) :\n                    (msg.payload == \"40.4\") ? new Buffer([80,67,86,86,52,48,46,52,155,75,13]) :\n                    (msg.payload == \"40.5\") ? new Buffer([80,67,86,86,52,48,46,53,139,106,13]) :\n                    (msg.payload == \"40.6\") ? new Buffer([80,67,86,86,52,48,46,54,187,9,13]) :\n                    (msg.payload == \"40.7\") ? new Buffer([80,67,86,86,52,48,46,55,171,40,13]) :\n                    (msg.payload == \"40.8\") ? new Buffer([80,67,86,86,52,48,46,56,90,199,13]) :\n                    (msg.payload == \"40.9\") ? new Buffer([80,67,86,86,52,48,46,57,74,230,13]) :\n                    (msg.payload == \"41.0\") ? new Buffer([80,67,86,86,52,49,46,48,236,255,13]) :\n                    (msg.payload == \"41.1\") ? new Buffer([80,67,86,86,52,49,46,49,252,222,13]) :\n                    (msg.payload == \"41.2\") ? new Buffer([80,67,86,86,52,49,46,50,204,189,13]) :\n                    (msg.payload == \"41.3\") ? new Buffer([80,67,86,86,52,49,46,51,220,156,13]) :\n                    (msg.payload == \"41.4\") ? new Buffer([80,67,86,86,52,49,46,52,172,123,13]) :\n                    (msg.payload == \"41.5\") ? new Buffer([80,67,86,86,52,49,46,53,188,90,13]) :\n                    (msg.payload == \"41.6\") ? new Buffer([80,67,86,86,52,49,46,54,140,57,13]) :\n                    (msg.payload == \"41.7\") ? new Buffer([80,67,86,86,52,49,46,55,156,24,13]) :\n                    (msg.payload == \"41.8\") ? new Buffer([80,67,86,86,52,49,46,56,109,247,13]) :\n                    (msg.payload == \"41.9\") ? new Buffer([80,67,86,86,52,49,46,57,125,214,13]) :\n                    (msg.payload == \"42.0\") ? new Buffer([80,67,86,86,52,50,46,48,181,175,13]) :\n                    (msg.payload == \"42.1\") ? new Buffer([80,67,86,86,52,50,46,49,165,142,13]) :\n                    (msg.payload == \"42.2\") ? new Buffer([80,67,86,86,52,50,46,50,149,237,13]) :\n                    (msg.payload == \"42.3\") ? new Buffer([80,67,86,86,52,50,46,51,133,204,13]) :\n                    (msg.payload == \"42.4\") ? new Buffer([80,67,86,86,52,50,46,52,245,43,13]) :\n                    (msg.payload == \"42.5\") ? new Buffer([80,67,86,86,52,50,46,53,229,10,13]) :\n                    (msg.payload == \"42.6\") ? new Buffer([80,67,86,86,52,50,46,54,213,105,13]) :\n                    (msg.payload == \"42.7\") ? new Buffer([80,67,86,86,52,50,46,55,197,72,13]) :\n                    (msg.payload == \"42.8\") ? new Buffer([80,67,86,86,52,50,46,56,52,167,13]) :\n                    (msg.payload == \"42.9\") ? new Buffer([80,67,86,86,52,50,46,57,36,134,13]) :\n                    (msg.payload == \"43.0\") ? new Buffer([80,67,86,86,52,51,46,48,130,159,13]) :\n                    (msg.payload == \"43.1\") ? new Buffer([80,67,86,86,52,51,46,49,146,190,13]) :\n                    (msg.payload == \"43.2\") ? new Buffer([80,67,86,86,52,51,46,50,162,221,13]) :\n                    (msg.payload == \"43.3\") ? new Buffer([80,67,86,86,52,51,46,51,178,252,13]) :\n                    (msg.payload == \"43.4\") ? new Buffer([80,67,86,86,52,51,46,52,194,27,13]) :\n                    (msg.payload == \"43.5\") ? new Buffer([80,67,86,86,52,51,46,53,210,58,13]) :\n                    (msg.payload == \"43.6\") ? new Buffer([80,67,86,86,52,51,46,54,226,89,13]) :\n                    (msg.payload == \"43.7\") ? new Buffer([80,67,86,86,52,51,46,55,242,120,13]) :\n                    (msg.payload == \"43.8\") ? new Buffer([80,67,86,86,52,51,46,56,57,112]) :\n                    (msg.payload == \"43.9\") ? new Buffer([80,67,86,86,52,51,46,57,19,182,13]) :\n                    (msg.payload == \"44.0\") ? new Buffer([80,67,86,86,52,52,46,48,112,240]) :\n                    (msg.payload == \"44.1\") ? new Buffer([80,67,86,86,52,52,46,49,23,46,13]) :\n                    (msg.payload == \"44.2\") ? new Buffer([80,67,86,86,52,52,46,50,39,77,13]) :\n                    (msg.payload == \"44.3\") ? new Buffer([80,67,86,86,52,52,46,51,55,108,13]) :\n                    (msg.payload == \"44.4\") ? new Buffer([80,67,86,86,52,52,46,52,71,139,13]) :\n                    (msg.payload == \"44.5\") ? new Buffer([80,67,86,86,52,52,46,53,87,170,13]) :\n                    (msg.payload == \"44.6\") ? new Buffer([80,67,86,86,52,52,46,54,103,201,13]) :\n                    (msg.payload == \"44.7\") ? new Buffer([80,67,86,86,52,52,46,55,119,232,13]) :\n                    (msg.payload == \"44.8\") ? new Buffer([80,67,86,86,52,52,46,56,134,7,13]) :\n                    (msg.payload == \"44.9\") ? new Buffer([80,67,86,86,52,52,46,57,150,38,13]) :\n                    (msg.payload == \"45.0\") ? new Buffer([80,67,86,86,52,53,46,48,48,63,13]) :\n                    (msg.payload == \"45.1\") ? new Buffer([80,67,86,86,52,53,46,49,32,30,13]) :\n                    (msg.payload == \"45.2\") ? new Buffer([80,67,86,86,52,53,46,50,16,125,13]) :\n                    (msg.payload == \"45.3\") ? new Buffer([80,67,86,86,52,53,46,51,92,13]) :\n                    (msg.payload == \"45.4\") ? new Buffer([80,67,86,86,52,53,46,52,112,187,13]) :\n                    (msg.payload == \"45.5\") ? new Buffer([80,67,86,86,52,53,46,53,96,154,13]) :\n                    (msg.payload == \"45.6\") ? new Buffer([80,67,86,86,52,53,46,54,80,249,13]) :\n                    (msg.payload == \"45.7\") ? new Buffer([80,67,86,86,52,53,46,55,64,216,13]) :\n                    (msg.payload == \"45.8\") ? new Buffer([80,67,86,86,52,53,46,56,177,55,13]) :\n                    (msg.payload == \"45.9\") ? new Buffer([80,67,86,86,52,53,46,57,161,22,13]) :\n                    (msg.payload == \"46.0\") ? new Buffer([80,67,86,86,52,54,46,48,105,111,13]) :\n                    (msg.payload == \"46.1\") ? new Buffer([80,67,86,86,52,54,46,49,121,78,13]) :\n                    (msg.payload == \"46.2\") ? new Buffer([80,67,86,86,52,54,46,50,73,45,13]) :\n                    (msg.payload == \"46.3\") ? new Buffer([80,67,86,86,52,54,46,51,89,12,13]) :\n                    (msg.payload == \"46.4\") ? new Buffer([80,67,86,86,52,54,46,52,41,235,13]) :\n                    (msg.payload == \"46.5\") ? new Buffer([80,67,86,86,52,54,46,53,57,202,13]) :\n                    (msg.payload == \"46.6\") ? new Buffer([80,67,86,86,52,54,46,54,154,144]) :\n                    (msg.payload == \"46.7\") ? new Buffer([80,67,86,86,52,54,46,55,25,136,13]) :\n                    (msg.payload == \"46.8\") ? new Buffer([80,67,86,86,52,54,46,56,232,103,13]) :\n                    (msg.payload == \"46.9\") ? new Buffer([80,67,86,86,52,54,46,57,248,70,13]) :\n                    (msg.payload == \"47.0\") ? new Buffer([80,67,86,86,52,55,46,48,94,95,13]) :\n                    (msg.payload == \"47.1\") ? new Buffer([80,67,86,86,52,55,46,49,78,126,13]) :\n                    (msg.payload == \"47.2\") ? new Buffer([80,67,86,86,52,55,46,50,126,29,13]) :\n                    (msg.payload == \"47.3\") ? new Buffer([80,67,86,86,52,55,46,51,110,60,13]) :\n                    (msg.payload == \"47.4\") ? new Buffer([80,67,86,86,52,55,46,52,30,219,13]) :\n                    (msg.payload == \"47.5\") ? new Buffer([80,67,86,86,52,55,46,53,239,160]) :\n                    (msg.payload == \"47.6\") ? new Buffer([80,67,86,86,52,55,46,54,62,153,13]) :\n                    (msg.payload == \"47.7\") ? new Buffer([80,67,86,86,52,55,46,55,46,184,13]) :\n                    (msg.payload == \"47.8\") ? new Buffer([80,67,86,86,52,55,46,56,223,87,13]) :\n                    (msg.payload == \"47.9\") ? new Buffer([80,67,86,86,52,55,46,57,207,118,13]) :\n                    (msg.payload == \"48.0\") ? new Buffer([80,67,86,86,52,56,46,48,114,110,13]) :\n                    (msg.payload == \"48.1\") ? new Buffer([80,67,86,86,52,56,46,49,98,79,13]) :\n                    (msg.payload == \"48.2\") ? new Buffer([80,67,86,86,52,56,46,50,82,44,13]) :\n                    (msg.payload == \"48.3\") ? new Buffer([80,67,86,86,52,56,46,51,66,13,13]) :\n                    (msg.payload == \"48.4\") ? new Buffer([80,67,86,86,52,56,46,52,50,234,13]) :\n                    (msg.payload == \"48.5\") ? new Buffer([80,67,86,86,52,56,46,53,34,203,13]) :\n                    (msg.payload == \"48.6\") ? new Buffer([80,67,86,86,52,56,46,54,18,168,13]) :\n                    (msg.payload == \"48.7\") ? new Buffer([80,67,86,86,52,56,46,55,40,144]) :\n                    (msg.payload == \"48.8\") ? new Buffer([80,67,86,86,52,56,46,56,243,102,13]) :\n                    (msg.payload == \"48.9\") ? new Buffer([80,67,86,86,52,56,46,57,227,71,13]) :\n                    (msg.payload == \"49.0\") ? new Buffer([80,67,86,86,52,57,46,48,69,94,13]) :\n                    (msg.payload == \"49.1\") ? new Buffer([80,67,86,86,52,57,46,49,85,127,13]) :\n                    (msg.payload == \"49.2\") ? new Buffer([80,67,86,86,52,57,46,50,101,28,13]) :\n                    (msg.payload == \"49.3\") ? new Buffer([80,67,86,86,52,57,46,51,117,61,13]) :\n                    (msg.payload == \"49.4\") ? new Buffer([80,67,86,86,52,57,46,52,93,160]) :\n                    (msg.payload == \"49.5\") ? new Buffer([80,67,86,86,52,57,46,53,21,251,13]) :\n                    (msg.payload == \"49.6\") ? new Buffer([80,67,86,86,52,57,46,54,37,152,13]) :\n                    (msg.payload == \"49.7\") ? new Buffer([80,67,86,86,52,57,46,55,53,185,13]) :\n                    (msg.payload == \"49.8\") ? new Buffer([80,67,86,86,52,57,46,56,196,86,13]) :\n                    (msg.payload == \"49.9\") ? new Buffer([80,67,86,86,52,57,46,57,212,119,13]) :\n                    (msg.payload == \"50.0\") ? new Buffer([80,67,86,86,53,48,46,48,173,123,13]) :\n                    (msg.payload == \"50.1\") ? new Buffer([80,67,86,86,53,48,46,49,189,90,13]) :\n                    (msg.payload == \"50.2\") ? new Buffer([80,67,86,86,53,48,46,50,141,57,13]) :\n                    (msg.payload == \"50.3\") ? new Buffer([80,67,86,86,53,48,46,51,157,24,13]) :\n                    (msg.payload == \"50.4\") ? new Buffer([80,67,86,86,53,48,46,52,237,255,13]) :\n                    (msg.payload == \"50.5\") ? new Buffer([80,67,86,86,53,48,46,53,253,222,13]) :\n                    (msg.payload == \"50.6\") ? new Buffer([80,67,86,86,53,48,46,54,205,189,13]) :\n                    (msg.payload == \"50.7\") ? new Buffer([80,67,86,86,53,48,46,55,221,156,13]) :\n                    (msg.payload == \"50.8\") ? new Buffer([80,67,86,86,53,48,46,56,44,115,13]) :\n                    (msg.payload == \"50.9\") ? new Buffer([80,67,86,86,53,48,46,57,60,82,13]) :\n                    (msg.payload == \"51.0\") ? new Buffer([80,67,86,86,53,49,46,48,154,75,13]) :\n                    (msg.payload == \"51.1\") ? new Buffer([80,67,86,86,53,49,46,49,138,106,13]) :\n                    (msg.payload == \"51.2\") ? new Buffer([80,67,86,86,53,49,46,50,186,9,13]) :\n                    (msg.payload == \"51.3\") ? new Buffer([80,67,86,86,53,49,46,51,170,40,13]) :\n                    (msg.payload == \"51.4\") ? new Buffer([80,67,86,86,53,49,46,52,218,207,13]) :\n                    (msg.payload == \"51.5\") ? new Buffer([80,67,86,86,53,49,46,53,202,238,13]) :\n                    (msg.payload == \"51.6\") ? new Buffer([80,67,86,86,53,49,46,54,250,141,13]) :\n                    (msg.payload == \"51.7\") ? new Buffer([80,67,86,86,53,49,46,55,234,172,13]) :\n                    (msg.payload == \"51.8\") ? new Buffer([80,67,86,86,53,49,46,56,27,67,13]) :\n                    (msg.payload == \"51.9\") ? new Buffer([80,67,86,86,53,49,46,57,182,32]) :\n                    (msg.payload == \"52.0\") ? new Buffer([80,67,86,86,53,50,46,48,195,27,13]) :\n                    (msg.payload == \"52.1\") ? new Buffer([80,67,86,86,53,50,46,49,211,58,13]) :\n                    (msg.payload == \"52.2\") ? new Buffer([80,67,86,86,53,50,46,50,227,89,13]) :\n                    (msg.payload == \"52.3\") ? new Buffer([80,67,86,86,53,50,46,51,243,120,13]) :\n                    (msg.payload == \"52.4\") ? new Buffer([80,67,86,86,53,50,46,52,131,159,13]) :\n                    (msg.payload == \"52.5\") ? new Buffer([80,67,86,86,53,50,46,53,147,190,13]) :\n                    (msg.payload == \"52.6\") ? new Buffer([80,67,86,86,53,50,46,54,163,221,13]) :\n                    (msg.payload == \"52.7\") ? new Buffer([80,67,86,86,53,50,46,55,179,252,13]) :\n                    (msg.payload == \"52.8\") ? new Buffer([80,67,86,86,53,50,46,56,66,19,13]) :\n                    (msg.payload == \"52.9\") ? new Buffer([80,67,86,86,53,50,46,57,82,50,13]) :\n                    (msg.payload == \"53.0\") ? new Buffer([80,67,86,86,53,51,46,48,244,43,13]) :\n                    (msg.payload == \"53.1\") ? new Buffer([80,67,86,86,53,51,46,49,228,10,13]) :\n                    (msg.payload == \"53.2\") ? new Buffer([80,67,86,86,53,51,46,50,212,105,13]) :\n                    (msg.payload == \"53.3\") ? new Buffer([80,67,86,86,53,51,46,51,196,72,13]) :\n                    (msg.payload == \"53.4\") ? new Buffer([80,67,86,86,53,51,46,52,180,175,13]) :\n                    (msg.payload == \"53.5\") ? new Buffer([80,67,86,86,53,51,46,53,164,142,13]) :\n                    (msg.payload == \"53.6\") ? new Buffer([80,67,86,86,53,51,46,54,148,237,13]) :\n                    (msg.payload == \"53.7\") ? new Buffer([80,67,86,86,53,51,46,55,132,204,13]) :\n                    (msg.payload == \"53.8\") ? new Buffer([80,67,86,86,53,51,46,56,117,35,13]) :\n                    (msg.payload == \"53.9\") ? new Buffer([80,67,86,86,53,51,46,57,101,2,13]) :\n                    (msg.payload == \"54.0\") ? new Buffer([80,67,86,86,53,52,46,48,113,187,13]) :\n                    (msg.payload == \"54.1\") ? new Buffer([80,67,86,86,53,52,46,49,97,154,13]) :\n                    (msg.payload == \"54.2\") ? new Buffer([80,67,86,86,53,52,46,50,81,249,13]) :\n                    (msg.payload == \"54.3\") ? new Buffer([80,67,86,86,53,52,46,51,65,216,13]) :\n                    (msg.payload == \"54.4\") ? new Buffer([80,67,86,86,53,52,46,52,49,63,13]) :\n                    (msg.payload == \"54.5\") ? new Buffer([80,67,86,86,53,52,46,53,33,30,13]) :\n                    (msg.payload == \"54.6\") ? new Buffer([80,67,86,86,53,52,46,54,17,125,13]) :\n                    (msg.payload == \"54.7\") ? new Buffer([80,67,86,86,53,52,46,55,21,192]) :\n                    (msg.payload == \"54.8\") ? new Buffer([80,67,86,86,53,52,46,56,240,179,13]) :\n                    (msg.payload == \"54.9\") ? new Buffer([80,67,86,86,53,52,46,57,224,146,13]) :\n                    (msg.payload == \"55.0\") ? new Buffer([80,67,86,86,53,53,46,48,70,139,13]) :\n                    (msg.payload == \"55.1\") ? new Buffer([80,67,86,86,53,53,46,49,86,170,13]) :\n                    (msg.payload == \"55.2\") ? new Buffer([80,67,86,86,53,53,46,50,102,201,13]) :\n                    (msg.payload == \"55.3\") ? new Buffer([80,67,86,86,53,53,46,51,118,232,13]) :\n                    (msg.payload == \"55.4\") ? new Buffer([80,67,86,86,53,53,46,52,96,240]) :\n                    (msg.payload == \"55.5\") ? new Buffer([80,67,86,86,53,53,46,53,22,46,13]) :\n                    (msg.payload == \"55.6\") ? new Buffer([80,67,86,86,53,53,46,54,38,77,13]) :\n                    (msg.payload == \"55.7\") ? new Buffer([80,67,86,86,53,53,46,55,54,108,13]) :\n                    (msg.payload == \"55.8\") ? new Buffer([80,67,86,86,53,53,46,56,199,131,13]) :\n                    (msg.payload == \"55.9\") ? new Buffer([80,67,86,86,53,53,46,57,215,162,13]) :\n                    (msg.payload == \"56.0\") ? new Buffer([80,67,86,86,53,54,46,48,31,219,13]) :\n                    (msg.payload == \"56.1\") ? new Buffer([80,67,86,86,53,54,46,49,255,160]) :\n                    (msg.payload == \"56.2\") ? new Buffer([80,67,86,86,53,54,46,50,63,153,13]) :\n                    (msg.payload == \"56.3\") ? new Buffer([80,67,86,86,53,54,46,51,47,184,13]) :\n                    (msg.payload == \"56.4\") ? new Buffer([80,67,86,86,53,54,46,52,95,95,13]) :\n                    (msg.payload == \"56.5\") ? new Buffer([80,67,86,86,53,54,46,53,79,126,13]) :\n                    (msg.payload == \"56.6\") ? new Buffer([80,67,86,86,53,54,46,54,127,29,13]) :\n                    (msg.payload == \"56.7\") ? new Buffer([80,67,86,86,53,54,46,55,111,60,13]) :\n                    (msg.payload == \"56.8\") ? new Buffer([80,67,86,86,53,54,46,56,158,211,13]) :\n                    (msg.payload == \"56.9\") ? new Buffer([80,67,86,86,53,54,46,57,142,242,13]) :\n                    (msg.payload == \"57.0\") ? new Buffer([80,67,86,86,53,55,46,48,40,235,13]) :\n                    (msg.payload == \"57.1\") ? new Buffer([80,67,86,86,53,55,46,49,56,202,13]) :\n                    (msg.payload == \"57.2\") ? new Buffer([80,67,86,86,53,55,46,50,138,144]) :\n                    (msg.payload == \"57.3\") ? new Buffer([80,67,86,86,53,55,46,51,24,136,13]) :\n                    (msg.payload == \"57.4\") ? new Buffer([80,67,86,86,53,55,46,52,104,111,13]) :\n                    (msg.payload == \"57.5\") ? new Buffer([80,67,86,86,53,55,46,53,120,78,13]) :\n                    (msg.payload == \"57.6\") ? new Buffer([80,67,86,86,53,55,46,54,72,45,13]) :\n                    (msg.payload == \"57.7\") ? new Buffer([80,67,86,86,53,55,46,55,88,12,13]) :\n                    (msg.payload == \"57.8\") ? new Buffer([80,67,86,86,53,55,46,56,169,227,13]) :\n                    (msg.payload == \"57.9\") ? new Buffer([80,67,86,86,53,55,46,57,185,194,13]) :\n                    (msg.payload == \"58.0\") ? new Buffer([80,67,86,86,53,56,46,48,77,160]) :\n                    (msg.payload == \"58.1\") ? new Buffer([80,67,86,86,53,56,46,49,20,251,13]) :\n                    (msg.payload == \"58.2\") ? new Buffer([80,67,86,86,53,56,46,50,36,152,13]) :\n                    (msg.payload == \"58.3\") ? new Buffer([80,67,86,86,53,56,46,51,52,185,13]) :\n                    (msg.payload == \"58.4\") ? new Buffer([80,67,86,86,53,56,46,52,68,94,13]) :\n                    (msg.payload == \"58.5\") ? new Buffer([80,67,86,86,53,56,46,53,84,127,13]) :\n                    (msg.payload == \"58.6\") ? new Buffer([80,67,86,86,53,56,46,54,100,28,13]) :\n                    (msg.payload == \"58.7\") ? new Buffer([80,67,86,86,53,56,46,55,116,61,13]) :\n                    (msg.payload == \"58.8\") ? new Buffer([80,67,86,86,53,56,46,56,133,210,13]) :\n                    (msg.payload == \"58.9\") ? new Buffer([80,67,86,86,53,56,46,57,149,243,13]) :\n                    (msg.payload == \"59.0\") ? new Buffer([80,67,86,86,53,57,46,48,51,234,13]) :\n                    (msg.payload == \"59.1\") ? new Buffer([80,67,86,86,53,57,46,49,35,203,13]) :\n                    (msg.payload == \"59.2\") ? new Buffer([80,67,86,86,53,57,46,50,19,168,13]) :\n                    (msg.payload == \"59.3\") ? new Buffer([80,67,86,86,53,57,46,51,56,144]) :\n                    (msg.payload == \"59.4\") ? new Buffer([80,67,86,86,53,57,46,52,115,110,13]) :\n                    (msg.payload == \"59.5\") ? new Buffer([80,67,86,86,53,57,46,53,99,79,13]) :\n                    (msg.payload == \"59.6\") ? new Buffer([80,67,86,86,53,57,46,54,83,44,13]) :\n                    (msg.payload == \"59.7\") ? new Buffer([80,67,86,86,53,57,46,55,67,13,13]) :\n                    (msg.payload == \"59.8\") ? new Buffer([80,67,86,86,53,57,46,56,178,226,13]) :\n                    (msg.payload == \"59.9\") ? new Buffer([80,67,86,86,53,57,46,57,162,195,13]) :\n                    (msg.payload == \"60.0\") ? new Buffer([80,67,86,86,54,48,46,48,54,167,13]) :\n                    (msg.payload == \"60.1\") ? new Buffer([80,67,86,86,54,48,46,49,38,134,13]) :\n                    (msg.payload == \"60.2\") ? new Buffer([80,67,86,86,54,48,46,50,22,229,13]) :\n                    (msg.payload == \"60.3\") ? new Buffer([80,67,86,86,54,48,46,51,108,64]) :\n                    (msg.payload == \"60.4\") ? new Buffer([80,67,86,86,54,48,46,52,118,35,13]) :\n                    (msg.payload == \"60.5\") ? new Buffer([80,67,86,86,54,48,46,53,102,2,13]) :\n                    (msg.payload == \"60.6\") ? new Buffer([80,67,86,86,54,48,46,54,86,97,13]) :\n                    (msg.payload == \"60.7\") ? new Buffer([80,67,86,86,54,48,46,55,70,64,13]) :\n                    (msg.payload == \"60.8\") ? new Buffer([80,67,86,86,54,48,46,56,183,175,13]) :\n                    (msg.payload == \"60.9\") ? new Buffer([80,67,86,86,54,48,46,57,167,142,13]) :\n                    (msg.payload == \"61.0\") ? new Buffer([80,67,86,86,54,49,46,48,25,112]) :\n                    (msg.payload == \"61.1\") ? new Buffer([80,67,86,86,54,49,46,49,17,182,13]) :\n                    (msg.payload == \"61.2\") ? new Buffer([80,67,86,86,54,49,46,50,33,213,13]) :\n                    (msg.payload == \"61.3\") ? new Buffer([80,67,86,86,54,49,46,51,49,244,13]) :\n                    (msg.payload == \"61.4\") ? new Buffer([80,67,86,86,54,49,46,52,65,19,13]) :\n                    (msg.payload == \"61.5\") ? new Buffer([80,67,86,86,54,49,46,53,81,50,13]) :\n                    (msg.payload == \"61.6\") ? new Buffer([80,67,86,86,54,49,46,54,97,81,13]) :\n                    (msg.payload == \"61.7\") ? new Buffer([80,67,86,86,54,49,46,55,113,112,13]) :\n                    (msg.payload == \"61.8\") ? new Buffer([80,67,86,86,54,49,46,56,128,159,13]) :\n                    (msg.payload == \"61.9\") ? new Buffer([80,67,86,86,54,49,46,57,144,190,13]) :\n                    (msg.payload == \"62.0\") ? new Buffer([80,67,86,86,54,50,46,48,88,199,13]) :\n                    (msg.payload == \"62.1\") ? new Buffer([80,67,86,86,54,50,46,49,72,230,13]) :\n                    (msg.payload == \"62.2\") ? new Buffer([80,67,86,86,54,50,46,50,120,133,13]) :\n                    (msg.payload == \"62.3\") ? new Buffer([80,67,86,86,54,50,46,51,104,164,13]) :\n                    (msg.payload == \"62.4\") ? new Buffer([80,67,86,86,54,50,46,52,24,67,13]) :\n                    (msg.payload == \"62.5\") ? new Buffer([80,67,86,86,54,50,46,53,134,32]) :\n                    (msg.payload == \"62.6\") ? new Buffer([80,67,86,86,54,50,46,54,56,1,13]) :\n                    (msg.payload == \"62.7\") ? new Buffer([80,67,86,86,54,50,46,55,40,32,13]) :\n                    (msg.payload == \"62.8\") ? new Buffer([80,67,86,86,54,50,46,56,217,207,13]) :\n                    (msg.payload == \"62.9\") ? new Buffer([80,67,86,86,54,50,46,57,201,238,13]) :\n                    (msg.payload == \"63.0\") ? new Buffer([80,67,86,86,54,51,46,48,111,247,13]) :\n                    (msg.payload == \"63.1\") ? new Buffer([80,67,86,86,54,51,46,49,127,214,13]) :\n                    (msg.payload == \"63.2\") ? new Buffer([80,67,86,86,54,51,46,50,79,181,13]) :\n                    (msg.payload == \"63.3\") ? new Buffer([80,67,86,86,54,51,46,51,95,148,13]) :\n                    (msg.payload == \"63.4\") ? new Buffer([80,67,86,86,54,51,46,52,47,115,13]) :\n                    (msg.payload == \"63.5\") ? new Buffer([80,67,86,86,54,51,46,53,63,82,13]) :\n                    (msg.payload == \"63.6\") ? new Buffer([80,67,86,86,54,51,46,54,243,16]) :\n                    (msg.payload == \"63.7\") ? new Buffer([80,67,86,86,54,51,46,55,31,16,13]) :\n                    (msg.payload == \"63.8\") ? new Buffer([80,67,86,86,54,51,46,56,238,255,13]) :\n                    (msg.payload == \"63.9\") ? new Buffer([80,67,86,86,54,51,46,57,254,222,13]) :\n                    (msg.payload == \"64.0\") ? new Buffer([80,67,86,86,54,52,46,48,234,103,13]) :\n                    (msg.payload == \"64.1\") ? new Buffer([80,67,86,86,54,52,46,49,250,70,13]) :\n\n\n                msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 27\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '27') {\n\n        msg.voltronicNum = i;\n\n        //option remplace\n        msg.payload = (msg.payload == \"25.0\") ? new Buffer([80,66,70,84,50,53,46,48,241,192,13]) :\n                (msg.payload == \"25.1\") ? new Buffer([80,66,70,84,50,53,46,49,225,225,13]) :\n                (msg.payload == \"25.2\") ? new Buffer([80,66,70,84,50,53,46,50,209,130,13]) :\n                (msg.payload == \"25.3\") ? new Buffer([80,66,70,84,50,53,46,51,193,163,13]) :\n                (msg.payload == \"25.4\") ? new Buffer([80,66,70,84,50,53,46,52,177,68,13]) :\n                (msg.payload == \"25.5\") ? new Buffer([80,66,70,84,50,53,46,53,161,101,13]) :\n                (msg.payload == \"25.6\") ? new Buffer([80,66,70,84,50,53,46,54,145,6,13]) :\n                (msg.payload == \"25.7\") ? new Buffer([80,66,70,84,50,53,46,55,129,39,13]) :\n                (msg.payload == \"25.8\") ? new Buffer([80,66,70,84,50,53,46,56,112,200,13]) :\n                (msg.payload == \"25.9\") ? new Buffer([80,66,70,84,50,53,46,57,96,233,13]) :\n                (msg.payload == \"26.0\") ? new Buffer([80,66,70,84,50,54,46,48,168,144,13]) :\n                (msg.payload == \"26.1\") ? new Buffer([80,66,70,84,50,54,46,49,184,177,13]) :\n                (msg.payload == \"26.2\") ? new Buffer([80,66,70,84,50,54,46,50,136,210,13]) :\n                (msg.payload == \"26.3\") ? new Buffer([80,66,70,84,50,54,46,51,152,243,13]) :\n                (msg.payload == \"26.4\") ? new Buffer([80,66,70,84,50,54,46,52,232,20,13]) :\n                (msg.payload == \"26.5\") ? new Buffer([80,66,70,84,50,54,46,53,248,53,13]) :\n                (msg.payload == \"26.6\") ? new Buffer([80,66,70,84,50,54,46,54,200,86,13]) :\n                (msg.payload == \"26.7\") ? new Buffer([80,66,70,84,50,54,46,55,216,119,13]) :\n                (msg.payload == \"26.8\") ? new Buffer([80,66,70,84,50,54,46,56,41,152,13]) :\n                (msg.payload == \"26.9\") ? new Buffer([80,66,70,84,50,54,46,57,57,185,13]) :\n                (msg.payload == \"27.0\") ? new Buffer([80,66,70,84,50,55,46,48,159,160,13]) :\n                (msg.payload == \"27.1\") ? new Buffer([80,66,70,84,50,55,46,49,143,129,13]) :\n                (msg.payload == \"27.2\") ? new Buffer([80,66,70,84,50,55,46,50,191,226,13]) :\n                (msg.payload == \"27.3\") ? new Buffer([80,66,70,84,50,55,46,51,175,195,13]) :\n                (msg.payload == \"27.4\") ? new Buffer([80,66,70,84,50,55,46,52,223,36,13]) :\n                (msg.payload == \"27.5\") ? new Buffer([80,66,70,84,50,55,46,53,207,5,13]) :\n                (msg.payload == \"27.6\") ? new Buffer([80,66,70,84,50,55,46,54,255,102,13]) :\n                (msg.payload == \"27.7\") ? new Buffer([80,66,70,84,50,55,46,55,239,71,13]) :\n                (msg.payload == \"27.8\") ? new Buffer([80,66,70,84,50,55,46,56,30,168,13]) :\n                (msg.payload == \"27.9\") ? new Buffer([80,66,70,84,50,55,46,57,232,144]) :\n                (msg.payload == \"28.0\") ? new Buffer([80,66,70,84,50,56,46,48,179,145,13]) :\n                (msg.payload == \"28.1\") ? new Buffer([80,66,70,84,50,56,46,49,163,176,13]) :\n                (msg.payload == \"28.2\") ? new Buffer([80,66,70,84,50,56,46,50,147,211,13]) :\n                (msg.payload == \"28.3\") ? new Buffer([80,66,70,84,50,56,46,51,131,242,13]) :\n                (msg.payload == \"28.4\") ? new Buffer([80,66,70,84,50,56,46,52,243,21,13]) :\n                (msg.payload == \"28.5\") ? new Buffer([80,66,70,84,50,56,46,53,227,52,13]) :\n                (msg.payload == \"28.6\") ? new Buffer([80,66,70,84,50,56,46,54,211,87,13]) :\n                (msg.payload == \"28.7\") ? new Buffer([80,66,70,84,50,56,46,55,195,118,13]) :\n                (msg.payload == \"28.8\") ? new Buffer([80,66,70,84,50,56,46,56,50,153,13]) :\n                (msg.payload == \"28.9\") ? new Buffer([80,66,70,84,50,56,46,57,34,184,13]) :\n                (msg.payload == \"29.0\") ? new Buffer([80,66,70,84,50,57,46,48,132,161,13]) :\n                (msg.payload == \"29.1\") ? new Buffer([80,66,70,84,50,57,46,49,148,128,13]) :\n                (msg.payload == \"29.2\") ? new Buffer([80,66,70,84,50,57,46,50,164,227,13]) :\n                (msg.payload == \"29.3\") ? new Buffer([80,66,70,84,50,57,46,51,180,194,13]) :\n                (msg.payload == \"29.4\") ? new Buffer([80,66,70,84,50,57,46,52,196,37,13]) :\n                (msg.payload == \"29.5\") ? new Buffer([80,66,70,84,50,57,46,53,212,4,13]) :\n                (msg.payload == \"29.6\") ? new Buffer([80,66,70,84,50,57,46,54,228,103,13]) :\n                (msg.payload == \"29.7\") ? new Buffer([80,66,70,84,50,57,46,55,244,70,13]) :\n                (msg.payload == \"29.8\") ? new Buffer([80,66,70,84,50,57,46,56,90,144]) :\n                (msg.payload == \"29.9\") ? new Buffer([80,66,70,84,50,57,46,57,21,136,13]) :\n                (msg.payload == \"30.0\") ? new Buffer([80,66,70,84,51,48,46,48,108,132,13]) :\n                (msg.payload == \"30.1\") ? new Buffer([80,66,70,84,51,48,46,49,124,165,13]) :\n                (msg.payload == \"30.2\") ? new Buffer([80,66,70,84,51,48,46,50,76,198,13]) :\n                (msg.payload == \"30.3\") ? new Buffer([80,66,70,84,51,48,46,51,92,231,13]) :\n                (msg.payload == \"30.4\") ? new Buffer([80,66,70,84,51,48,46,52,44,0,13]) :\n                (msg.payload == \"30.5\") ? new Buffer([80,66,70,84,51,48,46,53,60,33,13]) :\n                (msg.payload == \"30.6\") ? new Buffer([80,66,70,84,51,48,46,54,196,32]) :\n                (msg.payload == \"30.7\") ? new Buffer([80,66,70,84,51,48,46,55,28,99,13]) :\n                (msg.payload == \"30.8\") ? new Buffer([80,66,70,84,51,48,46,56,237,140,13]) :\n                (msg.payload == \"30.9\") ? new Buffer([80,66,70,84,51,48,46,57,253,173,13]) :\n                (msg.payload == \"31.0\") ? new Buffer([80,66,70,84,51,49,46,48,91,180,13]) :\n                (msg.payload == \"31.1\") ? new Buffer([80,66,70,84,51,49,46,49,75,149,13]) :\n                (msg.payload == \"31.2\") ? new Buffer([80,66,70,84,51,49,46,50,123,246,13]) :\n                (msg.payload == \"31.3\") ? new Buffer([80,66,70,84,51,49,46,51,107,215,13]) :\n                (msg.payload == \"31.4\") ? new Buffer([80,66,70,84,51,49,46,52,27,48,13]) :\n                (msg.payload == \"31.5\") ? new Buffer([80,66,70,84,51,49,46,53,177,16]) :\n                (msg.payload == \"48.0\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 48, 148, 8, 13]) :\n                (msg.payload == \"48.1\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 49, 132, 41, 13]) :\n                (msg.payload == \"48.2\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 50, 180, 74, 13]) :\n                (msg.payload == \"48.3\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 51, 164, 107, 13]) :\n                (msg.payload == \"48.4\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 52, 212, 140, 13]) :\n                (msg.payload == \"48.5\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 53, 196, 173, 13]) :\n                (msg.payload == \"48.6\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 54, 244, 206, 13]) :\n                (msg.payload == \"48.7\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 55, 228, 239, 13]) :\n                (msg.payload == \"48.8\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 56, 21, 0, 13]) :\n                (msg.payload == \"48.9\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 57, 82, 16]) :\n                (msg.payload == \"49.0\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 48, 163, 56, 13]) :\n                (msg.payload == \"49.1\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 49, 179, 25, 13]) :\n                (msg.payload == \"49.2\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 50, 131, 122, 13]) :\n                (msg.payload == \"49.3\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 51, 147, 91, 13]) :\n                (msg.payload == \"49.4\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 52, 227, 188, 13]) :\n                (msg.payload == \"49.5\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 53, 243, 157, 13]) :\n                (msg.payload == \"49.6\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 54, 195, 254, 13]) :\n                (msg.payload == \"49.7\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 55, 211, 223, 13]) :\n                (msg.payload == \"49.8\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 56, 34, 48, 13]) :\n                (msg.payload == \"49.9\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 57, 50, 17, 13]) :\n                (msg.payload == \"50.0\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 48, 75, 29, 13]) :\n                (msg.payload == \"50.1\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 49, 91, 60, 13]) :\n                (msg.payload == \"50.2\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 50, 107, 95, 13]) :\n                (msg.payload == \"50.3\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 51, 123, 126, 13]) :\n                (msg.payload == \"50.4\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 52, 185, 144]) :\n                (msg.payload == \"50.5\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 53, 27, 184, 13]) :\n                (msg.payload == \"50.6\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 54, 43, 219, 13]) :\n                (msg.payload == \"50.7\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 55, 59, 250, 13]) :\n                (msg.payload == \"50.8\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 56, 202, 21, 13]) :\n                (msg.payload == \"50.9\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 57, 218, 52, 13]) :\n                (msg.payload == \"51.0\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 48, 124, 45, 13]) :\n                (msg.payload == \"51.1\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 49, 108, 12, 13]) :\n                (msg.payload == \"51.2\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 50, 92, 111, 13]) :\n                (msg.payload == \"51.3\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 51, 76, 78, 13]) :\n                (msg.payload == \"51.4\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 52, 60, 169, 13]) :\n                (msg.payload == \"51.5\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 53, 44, 136, 13]) :\n                (msg.payload == \"51.6\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 54, 28, 235, 13]) :\n                (msg.payload == \"51.7\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 55, 204, 160]) :\n                (msg.payload == \"51.8\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 56, 253, 37, 13]) :\n                (msg.payload == \"51.9\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 57, 237, 4, 13]) :\n                (msg.payload == \"52.0\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 48, 37, 125, 13]) :\n                (msg.payload == \"52.1\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 49, 53, 92, 13]) :\n                (msg.payload == \"52.2\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 50, 83, 240]) :\n                (msg.payload == \"52.3\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 51, 21, 30, 13]) :\n                (msg.payload == \"52.4\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 52, 101, 249, 13]) :\n                (msg.payload == \"52.5\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 53, 117, 216, 13]) :\n                (msg.payload == \"52.6\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 54, 69, 187, 13]) :\n                (msg.payload == \"52.7\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 55, 85, 154, 13]) :\n                (msg.payload == \"52.8\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 56, 164, 117, 13]) :\n                (msg.payload == \"52.9\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 57, 180, 84, 13]) :\n                (msg.payload == \"53.0\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 48, 18, 77, 13]) :\n                (msg.payload == \"53.1\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 49, 38, 192]) :\n                (msg.payload == \"53.2\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 50, 50, 15, 13]) :\n                (msg.payload == \"53.3\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 51, 34, 46, 13]) :\n                (msg.payload == \"53.4\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 52, 82, 201, 13]) :\n                (msg.payload == \"53.5\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 53, 66, 232, 13]) :\n                (msg.payload == \"53.6\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 54, 114, 139, 13]) :\n                (msg.payload == \"53.7\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 55, 98, 170, 13]) :\n                (msg.payload == \"53.8\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 56, 147, 69, 13]) :\n                (msg.payload == \"53.9\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 57, 131, 100, 13]) :\n                (msg.payload == \"54.0\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 48, 151, 221, 13]) :\n                (msg.payload == \"54.1\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 49, 135, 252, 13]) :\n                (msg.payload == \"54.2\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 50, 183, 159, 13]) :\n                (msg.payload == \"54.3\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 51, 167, 190, 13]) :\n                (msg.payload == \"54.4\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 52, 215, 89, 13]) :\n                (msg.payload == \"54.5\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 53, 199, 120, 13]) :\n                (msg.payload == \"54.6\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 54, 247, 27, 13]) :\n                (msg.payload == \"54.7\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 55, 231, 58, 13]) :\n                (msg.payload == \"54.8\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 56, 22, 213, 13]) :\n                (msg.payload == \"54.9\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 57, 111, 64]) :\n                (msg.payload == \"55.0\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 48, 160, 237, 13]) :\n                (msg.payload == \"55.1\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 49, 176, 204, 13]) :\n                (msg.payload == \"55.2\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 50, 128, 175, 13]) :\n                (msg.payload == \"55.3\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 51, 144, 142, 13]) :\n                (msg.payload == \"55.4\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 52, 224, 105, 13]) :\n                (msg.payload == \"55.5\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 53, 240, 72, 13]) :\n                (msg.payload == \"55.6\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 54, 192, 43, 13]) :\n                (msg.payload == \"55.7\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 55, 208, 10, 13]) :\n                (msg.payload == \"55.8\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 56, 33, 229, 13]) :\n                (msg.payload == \"55.9\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 57, 49, 196, 13]) :\n                (msg.payload == \"56.0\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 48, 249, 189, 13]) :\n                (msg.payload == \"56.1\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 49, 233, 156, 13]) :\n                (msg.payload == \"56.2\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 50, 217, 255, 13]) :\n                (msg.payload == \"56.3\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 51, 201, 222, 13]) :\n                (msg.payload == \"56.4\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 52, 185, 57, 13]) :\n                (msg.payload == \"56.5\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 53, 169, 24, 13]) :\n                (msg.payload == \"56.6\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 54, 153, 123, 13]) :\n                (msg.payload == \"56.7\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 55, 137, 90, 13]) :\n                (msg.payload == \"56.8\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 56, 120, 181, 13]) :\n                (msg.payload == \"56.9\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 57, 104, 148, 13]) :\n                (msg.payload == \"57.0\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 48, 206, 141, 13]) :\n                (msg.payload == \"57.1\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 49, 222, 172, 13]) :\n                (msg.payload == \"57.2\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 50, 238, 207, 13]) :\n                (msg.payload == \"57.3\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 51, 254, 238, 13]) :\n                (msg.payload == \"57.4\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 52, 142, 9, 13]) :\n                (msg.payload == \"57.5\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 53, 158, 40, 13]) :\n                (msg.payload == \"57.6\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 54, 174, 75, 13]) :\n                (msg.payload == \"57.7\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 55, 190, 106, 13]) :\n                (msg.payload == \"57.8\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 56, 79, 133, 13]) :\n                (msg.payload == \"57.9\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 57, 95, 164, 13]) :\n                (msg.payload == \"58.0\") ? new Buffer([80, 66, 70, 84, 53, 56, 46, 48, 226, 188, 13]) :\n                msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 29\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '29') {\n\n        msg.voltronicNum = i;\n        \n        //option remplace\n        msg.payload = (msg.payload == \"21.0\") ? new Buffer([80,83,68,86,50,49,46,48,109,217,13]) :\n                (msg.payload == \"21.1\") ? new Buffer([80,83,68,86,50,49,46,49,125,248,13]) :\n                (msg.payload == \"21.2\") ? new Buffer([80,83,68,86,50,49,46,50,77,155,13]) :\n                (msg.payload == \"21.3\") ? new Buffer([80,83,68,86,50,49,46,51,93,186,13]) :\n                (msg.payload == \"21.4\") ? new Buffer([80,83,68,86,50,49,46,52,45,93,13]) :\n                (msg.payload == \"21.5\") ? new Buffer([80,83,68,86,50,49,46,53,61,124,13]) :\n                (msg.payload == \"21.6\") ? new Buffer([80,83,68,86,50,49,46,54,209,240]) :\n                (msg.payload == \"21.7\") ? new Buffer([80,83,68,86,50,49,46,55,29,62,13]) :\n                (msg.payload == \"21.8\") ? new Buffer([80,83,68,86,50,49,46,56,236,209,13]) :\n                (msg.payload == \"21.9\") ? new Buffer([80,83,68,86,50,49,46,57,252,240,13]) :\n                (msg.payload == \"22.0\") ? new Buffer([80,83,68,86,50,50,46,48,52,137,13]) :\n                (msg.payload == \"22.1\") ? new Buffer([80,83,68,86,50,50,46,49,36,168,13]) :\n                (msg.payload == \"22.2\") ? new Buffer([80,83,68,86,50,50,46,50,20,203,13]) :\n                (msg.payload == \"22.3\") ? new Buffer([80,83,68,86,50,50,46,51,78,160]) :\n                (msg.payload == \"22.4\") ? new Buffer([80,83,68,86,50,50,46,52,116,13,13]) :\n                (msg.payload == \"22.5\") ? new Buffer([80,83,68,86,50,50,46,53,100,44,13]) :\n                (msg.payload == \"22.6\") ? new Buffer([80,83,68,86,50,50,46,54,84,79,13]) :\n                (msg.payload == \"22.7\") ? new Buffer([80,83,68,86,50,50,46,55,68,110,13]) :\n                (msg.payload == \"22.8\") ? new Buffer([80,83,68,86,50,50,46,56,181,129,13]) :\n                (msg.payload == \"22.9\") ? new Buffer([80,83,68,86,50,50,46,57,165,160,13]) :\n                (msg.payload == \"23.0\") ? new Buffer([80,83,68,86,50,51,46,48,59,144]) :\n                (msg.payload == \"23.1\") ? new Buffer([80,83,68,86,50,51,46,49,19,152,13]) :\n                (msg.payload == \"23.2\") ? new Buffer([80,83,68,86,50,51,46,50,35,251,13]) :\n                (msg.payload == \"23.3\") ? new Buffer([80,83,68,86,50,51,46,51,51,218,13]) :\n                (msg.payload == \"23.4\") ? new Buffer([80,83,68,86,50,51,46,52,67,61,13]) :\n                (msg.payload == \"23.5\") ? new Buffer([80,83,68,86,50,51,46,53,83,28,13]) :\n                (msg.payload == \"23.6\") ? new Buffer([80,83,68,86,50,51,46,54,99,127,13]) :\n                (msg.payload == \"23.7\") ? new Buffer([80,83,68,86,50,51,46,55,115,94,13]) :\n                (msg.payload == \"23.8\") ? new Buffer([80,83,68,86,50,51,46,56,130,177,13]) :\n                (msg.payload == \"23.9\") ? new Buffer([80,83,68,86,50,51,46,57,146,144,13]) :\n                (msg.payload == \"24.0\") ? new Buffer([80,83,68,86,50,52,46,48,134,41,13]) :\n                (msg.payload == \"42.0\") ? new Buffer([80,83,68,86,52,50,46,48,19,16,13]) :\n                (msg.payload == \"42.1\") ? new Buffer([80,83,68,86,52,50,46,49,51,16]) :\n                (msg.payload == \"42.2\") ? new Buffer([80,83,68,86,52,50,46,50,51,82,13]) :\n                (msg.payload == \"42.3\") ? new Buffer([80,83,68,86,52,50,46,51,35,115,13]) :\n                (msg.payload == \"42.4\") ? new Buffer([80,83,68,86,52,50,46,52,83,148,13]) :\n                (msg.payload == \"42.5\") ? new Buffer([80,83,68,86,52,50,46,53,67,181,13]) :\n                (msg.payload == \"42.6\") ? new Buffer([80,83,68,86,52,50,46,54,115,214,13]) :\n                (msg.payload == \"42.7\") ? new Buffer([80,83,68,86,52,50,46,55,99,247,13]) :\n                (msg.payload == \"42.8\") ? new Buffer([80,83,68,86,52,50,46,56,146,24,13]) :\n                (msg.payload == \"42.9\") ? new Buffer([80,83,68,86,52,50,46,57,130,57,13]) :\n                (msg.payload == \"43.0\") ? new Buffer([80,83,68,86,52,51,46,48,36,32,13]) :\n                (msg.payload == \"43.1\") ? new Buffer([80,83,68,86,52,51,46,49,52,1,13]) :\n                (msg.payload == \"43.2\") ? new Buffer([80,83,68,86,52,51,46,50,70,32]) :\n                (msg.payload == \"43.3\") ? new Buffer([80,83,68,86,52,51,46,51,20,67,13]) :\n                (msg.payload == \"43.4\") ? new Buffer([80,83,68,86,52,51,46,52,100,164,13]) :\n                (msg.payload == \"43.5\") ? new Buffer([80,83,68,86,52,51,46,53,116,133,13]) :\n                (msg.payload == \"43.6\") ? new Buffer([80,83,68,86,52,51,46,54,68,230,13]) :\n                (msg.payload == \"43.7\") ? new Buffer([80,83,68,86,52,51,46,55,84,199,13]) :\n                (msg.payload == \"43.8\") ? new Buffer([80,83,68,86,52,51,46,56,165,40,13]) :\n                (msg.payload == \"43.9\") ? new Buffer([80,83,68,86,52,51,46,57,181,9,13]) :\n                (msg.payload == \"44.0\") ? new Buffer([80,83,68,86,52,52,46,48,161,176,13]) :\n                (msg.payload == \"44.1\") ? new Buffer([80,83,68,86,52,52,46,49,177,145,13]) :\n                (msg.payload == \"44.2\") ? new Buffer([80,83,68,86,52,52,46,50,129,242,13]) :\n                (msg.payload == \"44.3\") ? new Buffer([80,83,68,86,52,52,46,51,145,211,13]) :\n                (msg.payload == \"44.4\") ? new Buffer([80,83,68,86,52,52,46,52,225,52,13]) :\n                (msg.payload == \"44.5\") ? new Buffer([80,83,68,86,52,52,46,53,241,21,13]) :\n                (msg.payload == \"44.6\") ? new Buffer([80,83,68,86,52,52,46,54,193,118,13]) :\n                (msg.payload == \"44.7\") ? new Buffer([80,83,68,86,52,52,46,55,209,87,13]) :\n                (msg.payload == \"44.8\") ? new Buffer([80,83,68,86,52,52,46,56,32,184,13]) :\n                (msg.payload == \"44.9\") ? new Buffer([80,83,68,86,52,52,46,57,48,153,13]) :\n                (msg.payload == \"45.0\") ? new Buffer([80,83,68,86,52,53,46,48,150,128,13]) :\n                (msg.payload == \"45.1\") ? new Buffer([80,83,68,86,52,53,46,49,134,161,13]) :\n                (msg.payload == \"45.2\") ? new Buffer([80,83,68,86,52,53,46,50,182,194,13]) :\n                (msg.payload == \"45.3\") ? new Buffer([80,83,68,86,52,53,46,51,166,227,13]) :\n                (msg.payload == \"45.4\") ? new Buffer([80,83,68,86,52,53,46,52,214,4,13]) :\n                (msg.payload == \"45.5\") ? new Buffer([80,83,68,86,52,53,46,53,198,37,13]) :\n                (msg.payload == \"45.6\") ? new Buffer([80,83,68,86,52,53,46,54,246,70,13]) :\n                (msg.payload == \"45.7\") ? new Buffer([80,83,68,86,52,53,46,55,230,103,13]) :\n                (msg.payload == \"45.8\") ? new Buffer([80,83,68,86,52,53,46,56,23,136,13]) :\n                (msg.payload == \"45.9\") ? new Buffer([80,83,68,86,52,53,46,57,122,144]) :\n                (msg.payload == \"46.0\") ? new Buffer([80,83,68,86,52,54,46,48,207,208,13]) :\n                (msg.payload == \"46.1\") ? new Buffer([80,83,68,86,52,54,46,49,223,241,13]) :\n                (msg.payload == \"46.2\") ? new Buffer([80,83,68,86,52,54,46,50,239,146,13]) :\n                (msg.payload == \"46.3\") ? new Buffer([80,83,68,86,52,54,46,51,255,179,13]) :\n                (msg.payload == \"46.4\") ? new Buffer([80,83,68,86,52,54,46,52,143,84,13]) :\n                (msg.payload == \"46.5\") ? new Buffer([80,83,68,86,52,54,46,53,159,117,13]) :\n                (msg.payload == \"46.6\") ? new Buffer([80,83,68,86,52,54,46,54,175,22,13]) :\n                (msg.payload == \"46.7\") ? new Buffer([80,83,68,86,52,54,46,55,191,55,13]) :\n                (msg.payload == \"46.8\") ? new Buffer([80,83,68,86,52,54,46,56,78,216,13]) :\n                (msg.payload == \"46.9\") ? new Buffer([80,83,68,86,52,54,46,57,94,249,13]) :\n                (msg.payload == \"47.0\") ? new Buffer([80,83,68,86,52,55,46,48,248,224,13]) :\n                (msg.payload == \"47.1\") ? new Buffer([80,83,68,86,52,55,46,49,232,193,13]) :\n                (msg.payload == \"47.2\") ? new Buffer([80,83,68,86,52,55,46,50,216,162,13]) :\n                (msg.payload == \"47.3\") ? new Buffer([80,83,68,86,52,55,46,51,200,131,13]) :\n                (msg.payload == \"47.4\") ? new Buffer([80,83,68,86,52,55,46,52,184,100,13]) :\n                (msg.payload == \"47.5\") ? new Buffer([80,83,68,86,52,55,46,53,168,69,13]) :\n                (msg.payload == \"47.6\") ? new Buffer([80,83,68,86,52,55,46,54,152,38,13]) :\n                (msg.payload == \"47.7\") ? new Buffer([80,83,68,86,52,55,46,55,136,7,13]) :\n                (msg.payload == \"47.8\") ? new Buffer([80,83,68,86,52,55,46,56,121,232,13]) :\n                (msg.payload == \"47.9\") ? new Buffer([80,83,68,86,52,55,46,57,105,201,13]) :\n                (msg.payload == \"48.0\") ? new Buffer([80,83,68,86,52,56,46,48,212,209,13]) :\n                'Erreur';\n    }\n\n\n}\nnode.send(msg);",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1040,
        "wires": [
            [
                "010593246c088110",
                "988aabfd9de45b0d"
            ]
        ]
    },
    {
        "id": "a617d17752d34864",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "Transformation des parametres",
        "func": "if (msg.type == \"command\") {\n    node.send(msg);\n}\n\n//Si valeur est diférent de NAK\nif (msg.payload != \"NAK\") {\n\n    /*--------------------------------------------------*/\n    //QPIRI Parametre\n    /*--------------------------------------------------*/\n    if (msg.type == \"qpiri\") {\n\n\n        /***********qmod **************/\n        let dir = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/qpiri_';\n\n        /*-------------------------------------------------*/\n        //parametre 01\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '16') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"UTI\" :\n                (msg.payload == 1) ? msg.payload = \"SOL\" :\n                    (msg.payload == 2) ? msg.payload = \"SBU\" :\n                        msg.payload;\n            node.send(msg);\n\n            /*-------------------------------------------------*/\n            //parametre 05\n            /*-------------------------------------------------*/\n        } else if (msg.topic == dir + '12') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"AGM\" :\n                (msg.payload == 1) ? msg.payload = \"Flooded\" :\n                    (msg.payload == 2) ? msg.payload = \"User\" :\n                        (msg.payload == 3) ? msg.payload = \"Pylon\" :\n                            (msg.payload == 5) ? msg.payload = \"Weco\" :\n                                (msg.payload == 6) ? msg.payload = \"Soltaro\" :\n                                    (msg.payload == 8) ? msg.payload = \"Lib\" :\n                                        (msg.payload == 9) ? msg.payload = \"Lic\" :\n                                            msg.payload;\n            node.send(msg);\n\n\n            /*-------------------------------------------------*/\n            //parametre 11\n            /*-------------------------------------------------*/\n        } else if (msg.topic == dir + '13') {\n\n            let count = msg.payload.length;\n            global.set('onduleurs.onduleur_' + msg.voltronicNum + '.param11_count', count)\n            //option remplace\n\n            node.send(msg);\n\n\n            /*-------------------------------------------------*/\n            //parametre 16\n            /*-------------------------------------------------*/\n        } else if (msg.topic == dir + '17') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"CUE\" :\n                (msg.payload == 1) ? msg.payload = \"CSO\" :\n                    (msg.payload == 2) ? msg.payload = \"SNU\" :\n                        (msg.payload == 3) ? msg.payload = \"OSO\" :\n                            msg.payload;\n\n            node.send(msg);\n\n\n        } else {\n\n            msg.payload = msg.payload;\n            msg.type = msg.type;\n            msg.topic = msg.topic;\n            node.send(msg);\n        }\n\n        /*--------------------------------------------------*/\n        //QMOD Mode solaire\n        /*--------------------------------------------------*/\n    } else if (msg.type == \"qmod\") {\n\n        /***********qmod **************/\n        let dir = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/qmod_';\n\n\n        /*-------------------------------------------------*/\n        //solar mode\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '0') {\n\n\n\n            //option remplace\n            msg.payload = (msg.payload == \"B\") ? msg.payload = \"solaire\" :\n                (msg.payload == \"L\") ? msg.payload = \"edf\" :\n                    (msg.payload == \"F\") ? msg.payload = \"Fault\" :\n                        (msg.payload == \"D\") ? msg.payload = \"Shutdown\" :\n                            (msg.payload == \"S\") ? msg.payload = \"Standby\" :\n                                (msg.payload == \"P\") ? msg.payload = \"Power\" :\n                                    msg.payload;\n\n            node.send(msg);\n\n\n\n        } else {\n\n            msg.payload = msg.payload;\n            msg.type = msg.type;\n            msg.topic = msg.topic;\n            node.send(msg);\n        }\n\n        /*--------------------------------------------------*/\n        // ⚠️ BLOC LED SUPPRIMÉ - Passait de 130 lignes\n        /*--------------------------------------------------*/\n\n    } else if (msg.type == \"date\") {\n\n        /***********date **************/\n        let dir = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/date_';\n\n\n        /*-------------------------------------------------*/\n        //date\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '0') {\n\n            const valeurdate = msg.payload; // Ex. \"086137255\"\n\n            // Extraire les valeurs\n            const annee = parseInt(valeurdate.slice(0, 4), 10);\n            const mois = parseInt(valeurdate.slice(4, 6), 10);\n            const jour = parseInt(valeurdate.slice(6, 8), 10);\n            const heure = parseInt(valeurdate.slice(8, 10), 10);\n            const minute = parseInt(valeurdate.slice(10, 12), 10);\n            const seconde = parseInt(valeurdate.slice(12, 14), 10);\n\n            // Créer l'objet JSON\n            msg.payload = {\n                \"date_temps\": jour + \"-\" + mois + \"-\" + annee + \" \" + heure + \":\" + minute + \":\" + seconde,\n                \"date\": jour + \"-\" + mois + \"-\" + annee,\n                \"temps\": heure + \":\" + minute + \":\" + seconde,\n                \"annee\": annee,\n                \"mois\": mois,\n                \"jour\": jour,\n                \"heure\": heure,\n                \"minute\": minute,\n                \"seconde\": seconde,\n\n            }\n\n            // Envoyer le message\n            node.send(msg);\n\n            //message date seul\n            let topic = msg.topic\n\n            msg.payload = jour + \"-\" + mois + \"-\" + annee;\n            msg.topic = topic + \"_date\"\n            node.send(msg);\n\n            //message heure seul\n            msg.payload = heure + \":\" + minute + \":\" + seconde;\n            msg.topic = topic + \"_heure\"\n            node.send(msg);\n\n\n\n\n\n        }\n\n        /*--------------------------------------------------*/\n        //QPIXS\n        /*--------------------------------------------------*/\n    } else if (msg.type == \"qpiws\") {\n\n        /***********qpiws **************/\n        let dir = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/qpiws_';\n\n\n        /*-------------------------------------------------*/\n        //Code erreur\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '0') {\n\n\n            msg.payload = msg.payload.split(''); //séparation de la valeur en tableau\n            let topic = msg.topic; // récupere le topic \n\n            //garde l'erreur sous forme de tableau\n            let erreurtab = msg.payload;\n\n            //Création d'un objet vide\n            let erreursObj = {}; //\n\n            //Définir chaque erreur\n            erreursObj[\"PV loss\"] = msg.payload[0] == 1;\n            erreursObj[\"Inverter fault\"] = msg.payload[1] == 1;\n            erreursObj[\"Bus Over\"] = msg.payload[2] == 1;\n            erreursObj[\"Bus Under\"] = msg.payload[3] == 1;\n            erreursObj[\"Bus Soft Fail\"] = msg.payload[4] == 1;\n            erreursObj[\"LINE_FAIL\"] = msg.payload[5] == 1;\n            erreursObj[\"OPVShort\"] = msg.payload[6] == 1;\n            erreursObj[\"Inverter voltage too low\"] = msg.payload[7] == 1;\n            erreursObj[\"Inverter voltage too high\"] = msg.payload[8] == 1;\n            erreursObj[\"Over temperature\"] = msg.payload[9] == 1;\n            erreursObj[\"Fan locked\"] = msg.payload[10] == 1;\n            erreursObj[\"Battery voltage high\"] = msg.payload[11] == 1;\n            erreursObj[\"Battery low alarm\"] = msg.payload[12] == 1;\n            erreursObj[\"Reserved_1\"] = msg.payload[13] == 1;\n            erreursObj[\"Battery under shutdown\"] = msg.payload[14] == 1;\n            erreursObj[\"Battery derating\"] = msg.payload[15] == 1;\n            erreursObj[\"Over load\"] = msg.payload[16] == 1;\n            erreursObj[\"Eeprom fault\"] = msg.payload[17] == 1;\n            erreursObj[\"Inverter Over Current\"] = msg.payload[18] == 1;\n            erreursObj[\"Inverter Soft Fail\"] = msg.payload[19] == 1;\n            erreursObj[\"Self Test Fail\"] = msg.payload[20] == 1;\n            erreursObj[\"OP DC Voltage Over\"] = msg.payload[21] == 1;\n            erreursObj[\"Bat Open\"] = msg.payload[22] == 1;\n            erreursObj[\"Current Sensor Fail\"] = msg.payload[23] == 1;\n            erreursObj[\"Reserved_2\"] = msg.payload[24] == 1;\n            erreursObj[\"Reserved_3\"] = msg.payload[25] == 1;\n            erreursObj[\"Reserved_4\"] = msg.payload[26] == 1;\n            erreursObj[\"Reserved_5\"] = msg.payload[27] == 1;\n            erreursObj[\"Reserved_6\"] = msg.payload[28] == 1;\n            erreursObj[\"Reserved_7\"] = msg.payload[29] == 1;\n            erreursObj[\"Reserved_8\"] = msg.payload[30] == 1;\n            erreursObj[\"Battery weak\"] = msg.payload[31] == 1;\n            erreursObj[\"Reserved_9\"] = msg.payload[32] == 1;\n            erreursObj[\"Reserved_10\"] = msg.payload[33] == 1;\n            erreursObj[\"Reserved_11\"] = msg.payload[34] == 1;\n            erreursObj[\"Battery equalization\"] = msg.payload[35] == 1;\n\n            // Création d'un tableau d'erreurs pour affichage\n            let erreurs = Object.keys(erreursObj).filter(key => erreursObj[key]);\n\n            // Si erreur on les affiches\n            if (erreurs.length > 0) {\n                msg.payload = erreurs.join(\", \");\n\n                //sinon il y a aucune erreur\n            } else {\n                msg.payload = \"Aucune erreur\";\n            }\n\n            node.send(msg);\n\n            //on fait un json pour les attributs\n            msg.topic = topic + \"_attrib\"\n            msg.payload = erreursObj;\n            node.send(msg);\n\n            //ici on envoie sous forme de tableau\n            msg.payload = erreurtab;\n            msg.topic = topic + \"_code\"\n            node.send(msg);\n\n\n\n        }\n\n\n\n        /*--------------------------------------------------*/\n        //QPGS vérification multi onduleur\n        /*--------------------------------------------------*/\n    } else if (msg.type.slice(0, -1) == \"qpgs\") {\n\n        // Chemin du qpgs\n        let dir = global.get(\"parametre.mqtt.DirSmart\") + '/' + global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".type\") + '_' + msg.voltronicNum + '/qpgs';\n\n        //bouble de 8 onduleurs\n        for (let i = 1; i <= 8; i++) {\n\n            //qpgsx_0. si onduleur existe\n            if (msg.topic == dir + i + '_0') {\n\n                //si existe est 1, sinon 0\n                if (msg.payload == 1) {\n\n                    node.send(msg)\n                    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + '.qpgs_' + i, true); //ajout XqpgsX (numonduleur + qpgs + numQPGS) existe\n\n\n                } else if (msg.topic == dir + '1_0') {\n\n                    node.send(msg)\n                    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + '.qpgs_' + i, true); //ajout XqpgsX (numonduleur + qpgs + numQPGS) existe\n\n                } else {\n                    node.send(msg)\n                    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + '.qpgs_' + i, false); //ajout XqpgsX (numonduleur + qpgs + numQPGS) existe\n\n                }\n\n                //qpgsX_2 mode solaire\n            } else if (msg.topic == dir + i + '_2') {\n\n                //option remplace\n                msg.payload = (msg.payload == \"B\") ? msg.payload = \"solaire\" :\n                    (msg.payload == \"L\") ? msg.payload = \"edf\" :\n                        (msg.payload == \"F\") ? msg.payload = \"Fault\" :\n                            (msg.payload == \"D\") ? msg.payload = \"Shutdown\" :\n                                (msg.payload == \"S\") ? msg.payload = \"Standby\" :\n                                    (msg.payload == \"P\") ? msg.payload = \"Power\" :\n                                        msg.payload;\n\n                node.send(msg);\n\n                //Autre valeur si bon onduleur\n            } else if (msg.topic.slice(0, -2) == dir + i) {\n\n                node.send(msg)\n\n            }\n\n\n        }\n\n        //on envoie les autres valeurs\n    } else {\n\n        msg.payload = msg.payload;\n        msg.type = msg.type;\n        msg.topic = msg.topic;\n        node.send(msg);\n    }\n\n    //si qpigs2 est egal à nak\n} else if (msg.type == \"qpigs2\" && msg.payload == \"NAK\") {\n\n    //ajout NAK au global a suppr\n    //global.set(msg.type, msg.payload);\n\n    //futur config\n    global.set('onduleurs.onduleur_' + msg.voltronicNum + '.' + msg.type, msg.payload);\n    msg.payload = msg.payload;\n    msg.type = msg.type;\n    msg.topic = msg.topic;\n    node.send(msg);\n\n    // si qpgs1 est égal à nak\n} else if (msg.type == \"qpgs1\" && msg.payload == \"NAK\") {\n\n    //ajout NAK au global\n    global.set(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_1\", false);\n\n    //sinon on fait rien\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 820,
        "wires": [
            [
                "9355216312bfe912"
            ]
        ]
    },
    {
        "id": "988aabfd9de45b0d",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "debug 106",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1040,
        "wires": []
    },
    {
        "id": "ee63eb1e9fe50b88",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "debug",
        "func": "\nlet debug = global.get(\"parametre.config.debug\"); ;\n\nif(debug == true){\n\n    var now = new Date();\n\n    var annee   = now.getFullYear();\n    var mois    = now.getMonth() + 1;\n    var jour    = now.getDate();\n    var heure   = now.getHours();\n    var minute  = now.getMinutes();\n    var seconde = now.getSeconds();\n\n    \n    \n    let date = jour + '/' + mois + '/' + annee + ', ' + heure + ':' + minute + ':' + seconde;\n\n    //msg.payload = date + ', ' + msg.topic + ', voltronic_' + msg.voltronicNum  + ', ' + msg.payload;\n    msg.payload = msg.topic + ', voltronic_' + msg.voltronicNum  + ', ' + msg.payload;\n    node.log(msg.payload);\n\n\n  \n\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "58e1bd9f6bb96874",
        "type": "link in",
        "z": "32d802144ee0875f",
        "name": "To-serial-in",
        "links": [
            "010593246c088110",
            "20daf792de563b06",
            "fb55b2e9876002e5"
        ],
        "x": 65,
        "y": 460,
        "wires": [
            [
                "d12f4cf116cabefb"
            ]
        ]
    },
    {
        "id": "9af4e59534a9f1d0",
        "type": "mqtt in",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "mqtt in dynamique",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "f5eebd81e9f35d6c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 510,
        "y": 1040,
        "wires": [
            [
                "eaaa0f0faf58fbea"
            ]
        ]
    },
    {
        "id": "5604c603df6c6670",
        "type": "inject",
        "z": "32d802144ee0875f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1120,
        "wires": [
            [
                "9efa972d48a512e7"
            ]
        ]
    },
    {
        "id": "9efa972d48a512e7",
        "type": "function",
        "z": "32d802144ee0875f",
        "name": "Test une commande",
        "func": "// Commande POP00; Buffer = 80,79,80,48,48,194,72,13\n// Commande POP01; Buffer = 80,79,80,48,49,210,105,13\n// Commande POP02; Buffer = 80,79,80,48,50,226,11,13\n\n\n\nlet command = \"POP02\"; //Commande\n\n// Encode la commande en HEX\nlet commandHex = Buffer.from(command).toString('hex'); \n\nmsg.payload = Buffer.from(command, \"hex\");\nnode.send(msg);\n\n//Utilise la funtion de conversion crc16 Xmodem\nmsg.payload = crc16(command).toString(16); \nnode.send(msg);\n\n// Commande en hex + calcul crc et ajoute le retour chariot a la fin (0D = 13)\nmsg.payload = commandHex + crc16(command).toString(16) + \"0D\"; \n\n\n// Transformation de la chaine de caractere en Buffer\nmsg.payload = Buffer.from(msg.payload, \"hex\");\nnode.send(msg);\n\n//Fonction de calcul crc16 XModem\nfunction crc16(str, crc = 0, xorout = 0) {\n    for(let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n        t = (crc >> 8) ^ str.charCodeAt(i);\n        t ^= t >> 4;\n        crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n    }\n    return crc ^ xorout;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 1120,
        "wires": [
            [
                "3ea27926ef366719"
            ]
        ]
    },
    {
        "id": "3ea27926ef366719",
        "type": "debug",
        "z": "32d802144ee0875f",
        "name": "debug 181",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1120,
        "wires": []
    },
    {
        "id": "eaaa0f0faf58fbea",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e4f7a7ca05b15835",
        "name": "Futur fonction parametre ",
        "func": "\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\n\n/********************* si ip *********************/\nfor (let i = 1; i <= count; i++) {\n\n    let dir = global.get(\"parametre.mqtt.DirSmart\") + '/Modification-voltronic/' + i + '/Param';\n    //let payload = '';\n    \n\n    /*-------------------------------------------------*/\n    //parametre 01\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '01') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"POP\";\n        //option remplace\n        msg.option = (msg.payload == \"UTI\") ? \"00\" :\n                     (msg.payload == \"SOL\") ? \"01\" :\n                     (msg.payload == \"SBU\") ? \"02\" :\n                     'Erreur';\n        msg.payload =  msg.option;\n        \n    }\n\n    /*-------------------------------------------------*/\n    //parametre 02\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '02') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"MNCHGC\";\n        //option remplace\n        msg.option =   (global.get(\"onduleurs.onduleur_\" + i + \".qpgs_1\") == false) ? msg.payload :\n                        \"0\" + msg.payload;\n\n    }\n    /*-------------------------------------------------*/\n    //parametre 05\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '05') {\n    \n        msg.voltronicNum = i;\n        \n        msg.command = \"PBT\";\n        //option remplace\n        msg.option = (msg.payload == \"AGM\") ? \"00\" :\n                    (msg.payload == \"Flooded\") ? \"01\" :\n                    (msg.payload == \"User\") ? \"02\" :\n                    (msg.payload == \"Pylon\") ? \"03\" :\n                    (msg.payload == \"Weco\") ? \"05\" :\n                    (msg.payload == \"Soltaro\") ? \"06\" :\n                    (msg.payload == \"Lib\") ? \"08\" :\n                    (msg.payload == \"Lic\") ? \"09\" :\n                    'Erreur';\n        msg.payload = msg.option;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 11\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '11') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"MUCHGC\";\n        //option remplace\n        if (global.get(\"onduleurs.onduleur_\" + i + \".qpgs_1\") === \"NAK\"){\n            msg.option =  msg.payload;\n        }else{\n            msg.option =  \"0\" + msg.payload;\n        }\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 12\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '12') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBCV\";\n        //option remplace\n\n        let payload = msg.payload.toString();\n        // Vérifier si la longueur de la chaîne est 2 (par exemple \"49\")\n        if (payload.length === 2) {\n            // Ajouter \".0\" à la fin de la chaîne\n            msg.option = payload + \".0\";\n        } else {\n            // Si ce n'est pas une valeur de deux caractères, on laisse tel quel\n            msg.option = payload;\n        }\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 13\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '13') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBDV\";\n        \n        //option remplace\n        let payload = msg.payload.toString();\n        // Vérifier si la longueur de la chaîne est 2 (par exemple \"49\")\n        if (payload.length === 2) {\n            // Ajouter \".0\" à la fin de la chaîne\n            msg.option = payload + \".0\";\n        } else {\n            // Si ce n'est pas une valeur de deux caractères, on laisse tel quel\n            msg.option = payload;\n        }\n        \n    }\n\n    /*-------------------------------------------------*/\n    //parametre 16\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '16') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PCP\";\n        //option remplace\n        msg.option = (msg.payload == \"CSO\") ? \"01\" :\n                    (msg.payload == \"SNU\") ? \"02\" :\n                    (msg.payload == \"OSO\") ? \"03\" :\n                    'Erreur';\n        msg.payload = msg.option;\n\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 26\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '26') {\n\n        \n        //option remplace\n        msg.voltronicNum = i;\n        \n        msg.command = \"PCVV\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 27\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '27') {\n\n        msg.voltronicNum = i;\n\n        msg.command = \"PBFT\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 29\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '29') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PSDV\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre Date\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + 'Date') {\n\n        msg.voltronicNum = i;\n        const now = new Date();\n\n        const year = String(now.getFullYear()).slice(-2); // Derniers 2 chiffres de l'année\n        const month = String(now.getMonth() + 1).padStart(2, '0'); // Mois (0-11 donc +1)\n        const day = String(now.getDate()).padStart(2, '0'); // Jour\n        const hours = String(now.getHours()).padStart(2, '0'); // Heures\n        const minutes = String(now.getMinutes()).padStart(2, '0'); // Minutes\n        const seconds = String(now.getSeconds()).padStart(2, '0'); // Secondes\n\n        msg.command = \"DAT\";\n        msg.option = year + month + day + hours + minutes + seconds ;\n        \n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre  Set battery re-charge capacity\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + 'qdop8') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBCC\";\n\n        msg.payload = msg.payload.toString();\n\n        if (msg.payload.length === 1) {\n            // Si 1 caractère, ajoute deux 00 devant\n            msg.payload = \"00\" + msg.payload;\n        } else if (msg.payload.length === 2) {\n            // Si 2 caractères,  un 0 devant\n            msg.payload = \"0\" + msg.payload;\n        }\n        //option remplace\n        msg.option = msg.payload;\n\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre Set battery re-discharge capacity\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + 'qdop9') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBDC\";\n        msg.payload = msg.payload.toString();\n\n        if (msg.payload.length === 1) {\n            // Si 1 caractère, ajoute deux 00 devant\n            msg.payload = \"00\" + msg.payload;\n        } else if (msg.payload.length === 2) {\n            // Si 2 caractères,  un 0 devant\n            msg.payload = \"0\" + msg.payload;\n        }\n        //option remplace\n        msg.option = msg.payload;\n        \n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre Set battery re-discharge capacity\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + 'qdop10') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PSDC\";\n        \n        msg.payload = msg.payload.toString();\n\n        if (msg.payload.length === 1) {\n            // Si 1 caractère, ajoute deux 00 devant\n            msg.payload = \"00\" + msg.payload;\n        } else if (msg.payload.length === 2) {\n            // Si 2 caractères,  un 0 devant\n            msg.payload = \"0\" + msg.payload;\n        }\n        //option remplace\n        msg.option = msg.payload;\n\n    }\n\n    /*-------------------------------------------------*/\n    //Autre (commande manuel)\n    /*-------------------------------------------------*/\n\n    if (msg.topic == dir + 'Com') {\n\n        msg.voltronicNum = i;\n        msg.topic = \"command\";\n        msg.command = msg.payload;\n        msg.option = '';\n    }\n}\n\n\nlet command = msg.command + msg.option ; //Commande a envoyer\nmsg.payload = command;\n\n// Encode la commande en HEX\nlet commandHex = Buffer.from(command).toString('hex'); \n\n// Commande en hex + calcul crc et ajoute le retour chariot a la fin\nmsg.payload = commandHex + crc16(command).toString(16) + \"0D\"; \n\n// Transformation de la chaine de caractere en Buffer\n//msg.topic = \"false\";\nmsg.payload = Buffer.from(msg.payload, \"hex\");\nnode.send(msg);\n\n/****************************************** */\n//Evoyer un QPIRI, QDOP ou un QLED pour rafraichir les valeurs\n/****************************************** */\n// Liste des commandes LED\nconst commandesLED = [\"PLEDE\", \"PLEDB\", \"PLEDM\", \"PLEDC1\", \"PLEDC2\"];\nconst commandesQDOP = [\"PBCC\", \"PBDC\", \"PSDC\"];\n\n// Sauvegarde du voltronicNum\nlet voltronicNumLocal = msg.voltronicNum;\n\n// Déterminer le topic et la commande à envoyer\nlet topicRefresh, commandToSend;\n\nif (commandesLED.includes(msg.command)) {\n    topicRefresh = \"qled\";\n    commandToSend = \"QLED\";\n} else if (commandesQDOP.includes(msg.command)) {\n    topicRefresh = \"qdop\";\n    commandToSend = \"QDOP\"; \n} else {\n    topicRefresh = \"qpiri\";\n    commandToSend = \"QPIRI\"; \n}\n\n// Timer 1 seconde pour envoyer le message\nsetTimeout(() => {\n    // Calcul CRC correct sur la commande ASCII\n    let commandHex = Buffer.from(commandToSend).toString('hex'); \n    msg.payload = commandHex + crc16(command).toString(16) + \"0D\"; \n    msg.topic = topicRefresh;\n    msg.payload = Buffer.from(msg.payload, \"hex\");\n\n    node.send(msg);\n}, 1000);\n\n\n\n\n\n//Fonction de calcul crc16 XModem\nfunction crc16(str, crc = 0, xorout = 0) {\n    for(let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n        t = (crc >> 8) ^ str.charCodeAt(i);\n        t ^= t >> 4;\n        crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n    }\n    return crc ^ xorout;\n}\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1000,
        "wires": [
            [
                "010593246c088110",
                "988aabfd9de45b0d"
            ]
        ]
    },
    {
        "id": "9d9541adb4b07967",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "Vérification",
        "func": "\nif (msg.payload == undefined) {\n    msg.payload = \"[warning] La valeur récupérée sur l'onduleur n°\" + msg.voltronicNum + \" n'est pas au bon format. Si l'erreur persiste, vérifiez votre câblage.\";\n    \n    node.send([msg,msg]);\n\n}else{\n    \n    let premierCaractere = msg.payload[0];\n\n    if (premierCaractere == \"(\"){\n        msg.pass = msg.topic + \"_pass\"\n        node.send([msg,]);\n    }else{\n        msg.payload = \"[warning] L'onduleur n°\" + msg.voltronicNum + \" ne récupère pas le bon format, vérifiez votre câblage.\";\n        if (msg.topic == \"qpig\") {\n            msg.topic = \"erreur\";\n            node.send([,msg ]);\n        \n        }\n    }\n\n}\n\nif (msg.status == \"ERR_TIMEOUT\") {\n    node.warn(\"[Error] Votre communication sur l'onduleur n° \" + msg.voltronicNum + \" est en timeOut. Augmentez votre intervalle de temps de communication.\");\n    return null;\n}",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 780,
        "wires": [
            [
                "ee63eb1e9fe50b88",
                "218e550a06f8765b",
                "8ba013a847b39d93"
            ],
            [
                "9fe3c612a10376d0"
            ]
        ]
    },
    {
        "id": "9fe3c612a10376d0",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "erreur",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 860,
        "wires": []
    },
    {
        "id": "494546931c642171",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "Requete",
        "func": "/* ==================== CODE CORRIGÉ - AVEC DÉMARRAGE + 10 MIN ==================== */\n\n// Compteur global pour gérer les cycles\nlet compteur = flow.get(\"compteur_\" + msg.voltronicNum) || 0;\ncompteur++;\nflow.set(\"compteur_\" + msg.voltronicNum, compteur);\n\n// Flag pour savoir si c'est le premier cycle (démarrage)\nlet firstRun = flow.get(\"firstRun_\" + msg.voltronicNum);\nif (firstRun === undefined) {\n    firstRun = true;\n    flow.set(\"firstRun_\" + msg.voltronicNum, true);\n}\n\n// ⚠️ IMPORTANT: Capturer voltronicNum pour les setTimeout\nconst voltronicNum = msg.voltronicNum;\n\n/* ==================== QPIGS - TOUJOURS (chaque cycle = 3s) ==================== */\n\nmsg.topic = \"qpig\";\nmsg.payload = createMessage(\"QPIGS\", voltronicNum);\nnode.send(msg);\n\n/* ==================== QPIGS2 - TOUJOURS (si full version) ==================== */\n\nif (global.get(\"onduleurs.onduleur_\" + voltronicNum + \".full\") === true) {\n    if (global.get('onduleurs.onduleur_' + voltronicNum + '.qpigs2') !== \"NAK\") {\n        setTimeout(function() {\n            const newMsg = {\n                topic: \"qpigs2\",\n                payload: createMessage(\"QPIGS2\", voltronicNum),\n                voltronicNum: voltronicNum\n            };\n            node.send(newMsg);\n        }, 50);\n    }\n}\n\n/* ==================== PARAMÈTRES - Au démarrage OU toutes les 10 minutes ==================== */\n\n// Envoyer les paramètres si :\n// - C'est le premier cycle (démarrage)\n// - OU toutes les 200 cycles (10 minutes)\nif (firstRun || compteur >= 200) {\n    \n    // Désactiver le flag firstRun après le premier passage\n    if (firstRun) {\n        flow.set(\"firstRun_\" + voltronicNum, false);\n        node.warn(\"🚀 Premier cycle détecté - Envoi des paramètres au démarrage (Onduleur \" + voltronicNum + \")\");\n    }\n    \n    // Reset compteur si on atteint 200 (10 minutes)\n    if (compteur >= 200) {\n        flow.set(\"compteur_\" + voltronicNum, 0);\n        node.warn(\"⏰ 10 minutes écoulées - Refresh des paramètres (Onduleur \" + voltronicNum + \")\");\n    }\n    \n    // QMOD - Mode solaire\n    setTimeout(function() {\n        const newMsg = {\n            topic: \"qmod\",\n            payload: createMessage(\"QMOD\", voltronicNum),\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 100);\n    \n    // QPIWS - Info erreur\n    setTimeout(function() {\n        const newMsg = {\n            topic: \"qpiws\",\n            payload: createMessage(\"QPIWS\", voltronicNum),\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 200);\n    \n    // QPIRI - Paramètres\n    setTimeout(function() {\n        const newMsg = {\n            topic: \"qpiri\",\n            payload: createMessage(\"QPIRI\", voltronicNum),\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 300);\n    \n    // QED - Énergie PV jour\n    setTimeout(function() {\n        const now = new Date();\n        const year = now.getFullYear().toString();\n        const month = (now.getMonth() + 1).toString().padStart(2, '0');\n        const day = now.getDate().toString().padStart(2, '0');\n        const dateStr = year + month + day;\n        \n        const newMsg = {\n            topic: \"qed\",\n            payload: createMessage(\"QED\" + dateStr, voltronicNum),\n            energieDate: dateStr,\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 400);\n    \n    // QLD - Énergie Load jour\n    setTimeout(function() {\n        const now = new Date();\n        const year = now.getFullYear().toString();\n        const month = (now.getMonth() + 1).toString().padStart(2, '0');\n        const day = now.getDate().toString().padStart(2, '0');\n        const dateStr = year + month + day;\n        \n        const newMsg = {\n            topic: \"qld\",\n            payload: createMessage(\"QLD\" + dateStr, voltronicNum),\n            energieDate: dateStr,\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 500);\n    \n    // QDI\n    setTimeout(function() {\n        const newMsg = {\n            topic: \"qdi\",\n            payload: createMessage(\"QDI\", voltronicNum),\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 600);\n    \n    // QT - Date\n    setTimeout(function() {\n        const newMsg = {\n            topic: \"date\",\n            payload: createMessage(\"QT\", voltronicNum),\n            voltronicNum: voltronicNum\n        };\n        node.send(newMsg);\n    }, 700);\n}\n\n/* ==================== FONCTIONS ==================== */\n\nfunction createMessage(command, voltronicNum) {\n    // Fonction CRC16 XModem\n    function crc16(str, crc = 0, xorout = 0) {\n        for (let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n            t = (crc >> 8) ^ str.charCodeAt(i);\n            t ^= t >> 4;\n            crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n        }\n        return crc ^ xorout;\n    }\n    \n    // Encode la commande en HEX et ajoute le CRC\n    let commandHex = Buffer.from(command).toString('hex');\n    let crcHex = crc16(command).toString(16).padStart(4, '0');\n    let messageHex = commandHex + crcHex + \"0D\";\n    return Buffer.from(messageHex, \"hex\");\n}\n\n/* ==================== WATCHDOG ==================== */\n\nconst interval = 30000; // Alerte si pas de réponse depuis 30s\n\nconst currentTime = Date.now();\nlet lastSent = flow.get(\"lastSentOnduleur\" + voltronicNum) || 0;\n\nif (currentTime - lastSent >= interval) {\n    const alertMsg = {\n        payload: \"Alerte : Pas de mise à jour reçue depuis plus de 30 secondes ! Onduleur \" + voltronicNum,\n        topic: \"erreur\",\n        voltronicNum: voltronicNum\n    };\n    node.send([null, alertMsg]);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 60,
        "wires": [
            [
                "fb55b2e9876002e5"
            ]
        ]
    },
    {
        "id": "2a1ae6354e3e82fc",
        "type": "inject",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "pass",
                "v": "date_pass",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 690,
        "y": 40,
        "wires": [
            [
                "66d8ce3eb3df562a"
            ]
        ]
    },
    {
        "id": "fb55b2e9876002e5",
        "type": "link out",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "To-serial-ou",
        "mode": "link",
        "links": [
            "58e1bd9f6bb96874"
        ],
        "x": 1085,
        "y": 60,
        "wires": []
    },
    {
        "id": "66d8ce3eb3df562a",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "true",
        "func": "// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\");\n\nfor (let i = 1; i <= count; i++) {\n    //vérification si l'onduleur est voltronic\n    if (global.get(\"onduleurs.onduleur_\" + i + \".type\") == 'voltronic') {\n        msg.voltronicNum = i;\n        flow.set(\"dernierMessageTemps_\" + msg.voltronicNum, Date.now());\n        node.send(msg);\n    }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 40,
        "wires": [
            [
                "494546931c642171"
            ]
        ]
    },
    {
        "id": "048161c342e3b83c",
        "type": "inject",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "sans rep",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 680,
        "y": 80,
        "wires": [
            [
                "c46bba48725a7c7b"
            ]
        ]
    },
    {
        "id": "c46bba48725a7c7b",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "watchd",
        "func": "// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\");\n\nfor (let i = 1; i <= count; i++) {\n    //vérification si l'onduleur est voltronic\n    if (global.get(\"onduleurs.onduleur_\" + i + \".type\") == 'voltronic') {\n        msg.voltronicNum = i;\n\n        // Vérifier si la date a été mise à jour\n        let tempsEcoule = Date.now() - flow.get(\"dernierMessageTemps_\" + msg.voltronicNum);\n\n        // Vérifier si plus de 10 secondes se sont écoulées et si l'alerte n'a pas déjà été envoyée\n        if (tempsEcoule >= 10000) {\n            // Si 10 secondes se sont écoulées et que la date n'a pas changé, envoyer un message\n            msg.pass = \"date_pass\";\n\n            flow.set(\"ancienneValeur_\" + msg.voltronicNum, msg.pass);\n            node.send(msg);\n        }\n    }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 80,
        "wires": [
            [
                "494546931c642171",
                "3145a80e45f7d3be"
            ]
        ]
    },
    {
        "id": "3145a80e45f7d3be",
        "type": "debug",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "debug 205",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "pass",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 120,
        "wires": []
    },
    {
        "id": "a52dbd3db16c7b47",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "ancien Requete",
        "func": "/* QPIGS */\n\nif (msg.pass === \"date_pass\") {\n    msg.topic = \"qpig\";\n    msg.payload = createMessage(\"QPIGS\", msg.voltronicNum); \n    node.send(msg);\n}\n\n/* QMOD */\nif (msg.pass === \"qpig_pass\") {\n    msg.topic = \"qmod\";\n    msg.payload = createMessage(\"QMOD\", msg.voltronicNum); \n    node.send(msg);\n}\n\n/* QPIWS */\nif (msg.pass === \"qmod_pass\") {\n    msg.topic = \"qpiws\";\n    msg.payload = createMessage(\"QPIWS\", msg.voltronicNum); \n    node.send(msg);\n}\n\n/* QFLAG */\nif (msg.pass === \"qpiws_pass\") {\n    msg.topic = \"qflag\";\n    msg.payload = createMessage(\"QFLAG\", msg.voltronicNum); \n    node.send(msg);\n}\n\n/* QPIRI - Parametre */\nif (msg.pass === \"qflag_pass\") {\n    msg.topic = \"qpiri\";\n    msg.payload = createMessage(\"QPIRI\", msg.voltronicNum);\n    node.send(msg);\n}\n\n//si full version on envoie aussi les commandes\nif ( global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".full\") === false ){\n\n    if (msg.pass === \"qpiri_pass\") {\n        msg.topic = \"qpig\";\n        msg.payload = createMessage(\"QPIGS\", msg.voltronicNum); \n        node.send(msg);\n    }\n\n} else {\n\n    /* QBEQI */\n    if (msg.pass === \"qpiri_pass\") {\n        msg.topic = \"qbeqi\";\n        msg.payload = createMessage(\"QBEQI\", msg.voltronicNum);\n        node.send(msg);\n    }\n\n    /* QPIGS2 - PV2 */\n    if (msg.pass === \"qbeqi_pass\") {\n        if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qpigs2') !== \"NAK\") {\n            msg.topic = \"qpigs2\";\n            msg.payload = createMessage(\"QPIGS2\", msg.voltronicNum);\n            node.send(msg);\n        } else {\n            msg.pass = \"qpigs2_pass\";\n        }\n    }\n\n    /* QLED Led */\n    if (msg.pass === \"qpigs2_pass\") {\n        if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qled') !== \"NAK\") {\n            msg.topic = \"qled\";\n            msg.payload = createMessage(\"QLED\", msg.voltronicNum);\n            node.send(msg);\n        } else {\n            msg.pass = \"qled_pass\";\n        }\n    }\n\n    /* QT - Date */\n    if (msg.pass === \"qled_pass\") {\n\n        if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qled') !== \"NAK\") {\n\n            msg.topic = \"date\";\n            msg.payload = createMessage(\"QT\", msg.voltronicNum);\n            node.send(msg);\n\n        } else {\n      \n            msg.topic = \"qpig\";\n            msg.payload = createMessage(\"QPIGS\", msg.voltronicNum); \n            node.send(msg);\n            \n        }\n\n    }\n\n}\n\n\n\n/*\nif (msg.pass === \"date_pass\") {\n    msg.topic = \"qpig\";\n    msg.payload = createMessage(\"QPIGS\", msg.voltronicNum); \n    node.send(msg);\n}\n\nif (msg.pass === \"qpig_pass\") {\n    msg.topic = \"qmod\";\n    msg.payload = createMessage(\"QMOD\", msg.voltronicNum); \n    node.send(msg);\n}\n\nif (msg.pass === \"qmod_pass\") {\n    msg.topic = \"qpiws\";\n    msg.payload = createMessage(\"QPIWS\", msg.voltronicNum); \n    node.send(msg);\n}\n\nif (msg.pass === \"qpiws_pass\") {\n    msg.topic = \"qbeqi\";\n    msg.payload = createMessage(\"QBEQI\", msg.voltronicNum);\n    node.send(msg);\n}\n\nif (msg.pass === \"qbeqi_pass\") {\n    msg.topic = \"qflag\";\n    msg.payload = createMessage(\"QFLAG\", msg.voltronicNum); \n    node.send(msg);\n}\n\nif (msg.pass === \"qflag_pass\") {\n    msg.topic = \"qpiri\";\n    msg.payload = createMessage(\"QPIRI\", msg.voltronicNum);\n    node.send(msg);\n}\n\nif (msg.pass === \"qpiri_pass\") {\n    if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qpigs2') !== \"NAK\") {\n        msg.topic = \"qpigs2\";\n        msg.payload = createMessage(\"QPIGS2\", msg.voltronicNum);\n        node.send(msg);\n    } else {\n        msg.pass = \"qpigs2_pass\";\n    }\n}\n\nif (msg.pass === \"qpigs2_pass\") {\n    if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qled') !== \"NAK\") {\n        msg.topic = \"qled\";\n        msg.payload = createMessage(\"QLED\", msg.voltronicNum);\n        node.send(msg);\n    } else {\n        msg.pass = \"qled_pass\";\n    }\n}\n\nif (msg.pass === \"qled_pass\") {\n    if (global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qled') !== \"NAK\") {\n        msg.topic = \"date\";\n        msg.payload = createMessage(\"QT\", msg.voltronicNum);\n        node.send(msg);\n    } else {\n        msg.pass = \"date_pass\";\n    }\n}\n\n*/\nfunction createMessage(command, voltronicNum) {\n    // Encode la commande en HEX et ajoute le CRC\n    let commandHex = Buffer.from(command).toString('hex');\n    let crc = crc16(command).toString(16); // Calcul du CRC16\n    let messageHex = commandHex + crc + \"0D\"; // Ajout du CRC et du retour chariot\n    return Buffer.from(messageHex, \"hex\");\n}\n\n// Fonction de calcul CRC16 XModem\nfunction crc16(str, crc = 0, xorout = 0) {\n    for (let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n        t = (crc >> 8) ^ str.charCodeAt(i);\n        t ^= t >> 4;\n        crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n    }\n    return crc ^ xorout;\n}\n\n    /*\n    if (msg.pass === msg.topic) {\n        if ( global.get('onduleurs.onduleur_' + msg.voltronicNum + '.qpgs') != false ){\n        \n        let seconde = tempIntervalRequete * 11;\n        for (let i = 2; i <= 8; i++) {\n            setTimeout(function () {\n                msg.topic = \"qpgs\" + i;\n                msg.payload =   (i == 1 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_1\") == true) ? new Buffer([81,80,71,83,49,47,251,13]) :\n                                (i == 2 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_2\") == true) ? new Buffer([81,80,71,83,50,31,152,13]) :\n                                (i == 3 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_3\") == true) ? new Buffer([81,80,71,83,51,15,185,13]) :\n                                (i == 4 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_4\") == true) ? new Buffer([81,80,71,83,52,127,94,13]) :\n                                (i == 5 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_5\") == true) ? new Buffer([81,80,71,83,53,111,127,13]) :\n                                (i == 6 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_6\") == true) ? new Buffer([81,80,71,83,54,95,28,13]) :\n                                (i == 7 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_7\") == true) ? new Buffer([81,80,71,83,55,79,61,13]) :\n                                (i == 8 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_8\") == true) ? new Buffer([81,80,71,83,56,190,210,13]) :\n                                (i == 9 && global.get(\"onduleurs.onduleur_\" + msg.voltronicNum + \".qpgs_9\") == true) ? new Buffer([81,80,71,83,57,174,243,13]) :\n                            'erreur';\n                    if (msg.payload != 'erreur'){\n\n                        node.send(msg);\n                        \n                    }\n\n            }, seconde+i*1100 );\n        }\n\n        }\n    }*/\n\n\n\n\n\n\n\n    const interval = 30000; // Utilise 2 minute par défaut\n\n\n    // Récupérer le temps actuel\n    const currentTime = Date.now();\n\n    // Vérifier le temps de la dernière exécution\n    let lastSent = flow.get(\"lastSentOnduleur\" + msg.voltronicNum) || 0;\n\n    // Si le temps est suppérieur, envoie le message\n    if (currentTime - lastSent >= interval) {\n\n                msg.payload = \"Alerte : Pas de mise à jour reçue depuis plus de 2 minutes ! \" + msg.voltronicNum;\n                msg.topic = \"erreur\"\n                node.send([, msg]);\n\n\n    }\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 20,
        "wires": [
            []
        ]
    },
    {
        "id": "b22c0cf4954eccef",
        "type": "function",
        "z": "32d802144ee0875f",
        "g": "66692b8d9715fc59",
        "name": "Ancien Temps d'attente",
        "func": "// Récupérer la valeur précédente stockée dans un contexte global\nlet ancienneValeur = flow.get(\"ancienneValeur_\" + msg.voltronicNum);\n\n// Variable pour vérifier si un message a été reçu récemment\nlet dernierMessageTemps = flow.get(\"dernierMessageTemps\") || Date.now();\n\nif (ancienneValeur !== msg.pass){\n\n    // Si c'est différent, mettre à jour l'ancienne valeur et envoyer le message\n    flow.set(\"ancienneValeur_\" + msg.voltronicNum, msg.pass);\n\n    // Mettre à jour l'heure du dernier message\n    flow.set(\"dernierMessageTemps_\" + msg.voltronicNum, Date.now());\n\n    // Réinitialiser la variable d'alerte\n    flow.set(\"alerteEnvoyee\", false);\n\n    setTimeout(function () {\n        // Mise à jour de l'heure du dernier message avant envoi\n        flow.set(\"dernierMessageTemps_\" + msg.voltronicNum, Date.now());\n\n        // Envoyer le message\n        node.send(msg);\n\n    }, global.get(\"parametre.config.interval\") * 1000);  // intervalle en secondes\n\n}\n\n/*\nAttente\n\n    // Délai de 10 secondes pour vérifier si la date a été mise à jour\n    setTimeout(function () {\n        // Vérifier si la date a été mise à jour\n        let tempsEcoule = Date.now() - flow.get(\"dernierMessageTemps_\" + msg.voltronicNum);\n\n        // Vérifier si plus de 10 secondes se sont écoulées et si l'alerte n'a pas déjà été envoyée\n        if (tempsEcoule >= 9000 && !flow.get(\"alerteEnvoyee\")) {\n            // Si 10 secondes se sont écoulées et que la date n'a pas changé, envoyer un message\n            node.send(msg);\n\n            // Marquer l'alerte comme envoyée pour ne pas renvoyer plusieurs fois\n            flow.set(\"alerteEnvoyee\", true);\n        } \n    }, global.get(\"parametre.config.interval\") * 1000 + 10000); // 10 secondes\n\n*/\n\n/*\nancienne \n\n// Récupérer la valeur précédente stockée dans un contexte global\nlet ancienneValeur = flow.get(\"ancienneValeur\");\n\n// Variable pour vérifier si un message a été reçu récemment\nlet dernierMessageTemps = flow.get(\"dernierMessageTemps\") || Date.now();\n\n// Vérifier si la valeur actuelle est différente de l'ancienne\nif (msg.payload !== ancienneValeur) {\n    // Si c'est différent, mettre à jour l'ancienne valeur et envoyer le message\n    flow.set(\"ancienneValeur\", msg.payload);\n\n    // Mettre à jour l'heure du dernier message\n    flow.set(\"dernierMessageTemps\", Date.now());\n\n    setTimeout(function () {\n        // Mise à jour de l'heure du dernier message avant envoi\n        flow.set(\"dernierMessageTemps\", Date.now());\n\n        // Envoyer le message\n        node.send(msg);\n        \n    }, global.get(\"parametre.config.interval\") * 1000);  // intervalle en secondes\n\n}\n*/\n/*\nsetTimeout(function () {\n    node.send(msg);\n}, global.get(\"parametre.config.interval\") * 1000);\n\n*/\n\n\n/*function runScript() {\n    // Récupérer l'intervalle global\n    const interval = global.get(\"parametre.config.interval\") * 1000 || 1000; // Utilise 7 secondes par défaut\n\n    // Récupérer le temps actuel\n    const currentTime = Date.now();\n\n    // Vérifier le temps de la dernière exécution\n    let lastSent = context.get(\"lastSent\" + msg.voltronicNum) || 0;\n\n    // Si 7 secondes se sont écoulées, envoie le message\n    if (currentTime - lastSent >= interval) {\n        context.set(\"lastSent\" + msg.voltronicNum, currentTime); // Met à jour le temps de dernière exécution\n        node.send(msg);  // Envoie le message\n    }else {\n        // Si le temps n'est pas encore écoulé, redémarre le script après 1,5 seconde\n        setTimeout(runScript, global.get(\"parametre.config.interval\") * 1500);\n       \n    }\n\n    // Sinon, retourne null pour ne rien envoyer\n    return null;\n}\n\n// Appel initial du script\nrunScript();\n*/\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "024340133e946a50",
        "type": "inject",
        "z": "32d802144ee0875f",
        "g": "e7bbe1762d32303e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "voltronicNum",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "qdop",
        "payload": "(1 3 0 0 00.0 42.4 999 40 020 060 015 015 00 23 46.0 000 020T}",
        "payloadType": "str",
        "x": 150,
        "y": 720,
        "wires": [
            [
                "8ba013a847b39d93"
            ]
        ]
    },
    {
        "id": "e185a78aa8ae6fea",
        "type": "function",
        "z": "32d802144ee0875f",
        "name": "Futur fonction parametre ",
        "func": "\n// nombre d'entrée onduleur\nlet count = global.get(\"countUSBOnduleur\")\n\n/********************* si ip *********************/\nfor (let i = 1; i <= count; i++) {\n\n    let dir = global.get(\"parametre.mqtt.DirSmart\") + '/Modification-voltronic/' + i + '/Param';\n    //let payload = '';\n    \n\n    /*-------------------------------------------------*/\n    //parametre 01\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '01') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"POP\";\n        //option remplace\n        msg.option = (msg.payload == \"UTI\") ? \"00\" :\n                     (msg.payload == \"SOL\") ? \"01\" :\n                     (msg.payload == \"SBU\") ? \"02\" :\n                     'Erreur';\n        msg.payload =  msg.option;\n        \n    }\n\n    /*-------------------------------------------------*/\n    //parametre 02\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '02') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"MNCHGC\";\n        //option remplace\n        msg.option =   (global.get(\"onduleurs.onduleur_\" + i + \".qpgs_1\") == false) ? msg.payload :\n                        \"0\" + msg.payload;\n\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 05\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '05') {\n    \n        msg.voltronicNum = i;\n        \n        msg.command = \"PBT\";\n        //option remplace\n        msg.option = (msg.payload == \"AGM\") ? \"00\" :\n                    (msg.payload == \"Flooded\") ? \"01\" :\n                    (msg.payload == \"User\") ? \"02\" :\n                    (msg.payload == \"Pylon\") ? \"03\" :\n                    (msg.payload == \"Weco\") ? \"05\" :\n                    (msg.payload == \"Soltaro\") ? \"06\" :\n                    (msg.payload == \"Lib\") ? \"08\" :\n                    (msg.payload == \"Lic\") ? \"09\" :\n                    'Erreur';\n        msg.payload = msg.option;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 11 - ✅ MUCHGC + 4 chiffres (0100, 0040...)\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '11') {\n        msg.voltronicNum = i;\n\n        msg.command = \"MUCHGC\";\n\n        // Nettoie 'A' et convertit\n        let cleanAmp = msg.payload.toString().replace(/[A]/gi, '');\n        let amp = parseInt(cleanAmp).toString();\n\n        // TOUJOURS 4 chiffres (MUCHGC0100)\n        msg.option = \"0\" + amp.padStart(3, '0');\n\n        node.status({\n            fill: \"yellow\",\n            shape: \"ring\",\n            text: `MUCHGC${msg.option}`\n        });\n    }\n\n\n    /*-------------------------------------------------*/\n    //parametre 12\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '12') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBCV\";\n        //option remplace\n\n        let payload = msg.payload.toString();\n        // Vérifier si la longueur de la chaîne est 2 (par exemple \"49\")\n        if (payload.length === 2) {\n            // Ajouter \".0\" à la fin de la chaîne\n            msg.option = payload + \".0\";\n        } else {\n            // Si ce n'est pas une valeur de deux caractères, on laisse tel quel\n            msg.option = payload;\n        }\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 13\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '13') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PBDV\";\n        \n        //option remplace\n        let payload = msg.payload.toString();\n        // Vérifier si la longueur de la chaîne est 2 (par exemple \"49\")\n        if (payload.length === 2) {\n            // Ajouter \".0\" à la fin de la chaîne\n            msg.option = payload + \".0\";\n        } else {\n            // Si ce n'est pas une valeur de deux caractères, on laisse tel quel\n            msg.option = payload;\n        }\n        \n    }\n\n    /*-------------------------------------------------*/\n    //parametre 16\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '16') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PCP\";\n        //option remplace\n        msg.option = (msg.payload == \"CSO\") ? \"01\" :\n                    (msg.payload == \"SNU\") ? \"02\" :\n                    (msg.payload == \"OSO\") ? \"03\" :\n                    'Erreur';\n        msg.payload = msg.option;\n\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 26\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '26') {\n\n        \n        //option remplace\n        msg.voltronicNum = i;\n        \n        msg.command = \"PCVV\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 27\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '27') {\n\n        msg.voltronicNum = i;\n\n        msg.command = \"PBFT\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //parametre 29\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '29') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PSDV\";\n        //option remplace\n        msg.option = msg.payload;\n    }\n\n    /*-------------------------------------------------*/\n    //Parametre 91 Led Enable or Disable\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '91' || msg.topic == dir + '96' || msg.topic == dir + '97' || msg.topic == dir + '98') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDE\";\n        //option remplace\n         msg.option = (msg.payload == \"ON\") ? \"1\" :\n                    (msg.payload == \"OFF\") ? \"0\" :\n                    'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 92 Luminosité Led\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '92') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDB\";\n        //option remplace\n         msg.option = (msg.payload == \"Faible\") ? \"0\" :\n                    (msg.payload == \"Moyen\") ? \"1\" :\n                    (msg.payload == \"Haut\") ? \"2\" :\n                    'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 93 Vitesse Led\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '93') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDB\";\n        //option remplace\n         msg.option = (msg.payload == \"Faible\") ? \"0\" :\n                    (msg.payload == \"Moyen\") ? \"1\" :\n                    (msg.payload == \"Rapide\") ? \"2\" :\n                    'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 94 Effet Led\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '94') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDM\";\n        //option remplace\n        msg.option = (msg.payload == \"Circulaire\") ? \"0\" :\n                    (msg.payload == \"Roue\") ? \"1\" :\n                    (msg.payload == \"Chasing\") ? \"2\" :\n                    (msg.payload == \"Fixe\") ? \"3\" :\n                    'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 95 Effet Led DATA\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '95') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDM\";\n        //option remplace\n        msg.option = (msg.payload == \"Puissance PV\") ? \"0\" :\n                    (msg.payload == \"SoC Batterie\") ? \"1\" :\n                    (msg.payload == \"Pourcentage de charge\") ? \"2\" :\n                    (msg.payload == \"Source\") ? \"3\" :\n                    (msg.payload == \"Charge Decharge\") ? \"4\" :\n                    'Erreur';\n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 96 Led RVB\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '96RVB') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDC1\";\n        //option remplace\n        \n        function formatNumber(num) {\n            return String(num).padStart(3, '0');\n        }\n\n        // Vérifie si msg.payload est une chaîne et la convertit en tableau de nombres\n        if (typeof msg.payload === 'string') {\n            msg.payload = msg.payload.split(',').map(Number);\n        }\n\n        // Vérifie que msg.payload est un tableau avant d'appliquer map\n        if (Array.isArray(msg.payload)) {\n            msg.option = msg.payload.map(formatNumber).join('');\n        } \n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 97 Led RVB\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '97RVB') {\n\n        msg.voltronicNum = i;\n        \n        msg.command = \"PLEDC2\";\n        //option remplace\n         function formatNumber(num) {\n            return String(num).padStart(3, '0');\n        }\n\n        // Vérifie si msg.payload est une chaîne et la convertit en tableau de nombres\n        if (typeof msg.payload === 'string') {\n            msg.payload = msg.payload.split(',').map(Number);\n        }\n\n        // Vérifie que msg.payload est un tableau avant d'appliquer map\n        if (Array.isArray(msg.payload)) {\n            msg.option = msg.payload.map(formatNumber).join('');\n        } \n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre 98 Led RVB\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + '98RVB') {\n\n         function formatNumber(num) {\n            return String(num).padStart(3, '0');\n        }\n\n        // Vérifie si msg.payload est une chaîne et la convertit en tableau de nombres\n        if (typeof msg.payload === 'string') {\n            msg.payload = msg.payload.split(',').map(Number);\n        }\n\n        // Vérifie que msg.payload est un tableau avant d'appliquer map\n        if (Array.isArray(msg.payload)) {\n            msg.option = msg.payload.map(formatNumber).join('');\n        } \n    }\n\n    /*-------------------------------------------------*/\n    //Paramètre Date\n    /*-------------------------------------------------*/\n    if (msg.topic == dir + 'Date') {\n\n        msg.voltronicNum = i;\n        const now = new Date();\n\n        const year = String(now.getFullYear()).slice(-2); // Derniers 2 chiffres de l'année\n        const month = String(now.getMonth() + 1).padStart(2, '0'); // Mois (0-11 donc +1)\n        const day = String(now.getDate()).padStart(2, '0'); // Jour\n        const hours = String(now.getHours()).padStart(2, '0'); // Heures\n        const minutes = String(now.getMinutes()).padStart(2, '0'); // Minutes\n        const seconds = String(now.getSeconds()).padStart(2, '0'); // Secondes\n\n        msg.command = \"DAT\";\n        msg.option = year + month + day + hours + minutes + seconds ;\n        \n    }\n\n    /*-------------------------------------------------*/\n    //Autre (commande manuel)\n    /*-------------------------------------------------*/\n\n    if (msg.topic == dir + 'Com') {\n\n        msg.voltronicNum = i;\n        msg.topic = \"command\";\n        msg.command = msg.payload;\n        msg.option = '';\n    }\n}\n\n\nlet command = msg.command + msg.option ; //Commande a envoyer\nmsg.payload = command;\n\n// Encode la commande en HEX\nlet commandHex = Buffer.from(command).toString('hex'); \n\n// Commande en hex + calcul crc et ajoute le retour chariot a la fin\nmsg.payload = commandHex + crc16(command).toString(16) + \"0D\"; \n\n// Transformation de la chaine de caractere en Buffer\n//msg.topic = \"false\";\nmsg.payload = Buffer.from(msg.payload, \"hex\");\nnode.send(msg);\n\n/****************************************** */\n//Evoyer un QPIRI ou un QLED pour rafraichir\n/****************************************** */\n// Liste des commandes LED\nconst commandesLED = [\"PLEDE\", \"PLEDB\", \"PLEDM\", \"PLEDC1\", \"PLEDC2\"];\n\n// Sauvegarde du voltronicNum\nlet voltronicNumLocal = msg.voltronicNum;\n\n// Déterminer le topic et la commande à envoyer\nlet topicRefresh, commandToSend;\n\nif (commandesLED.includes(msg.command)) {\n    topicRefresh = \"qled\";\n    commandToSend = \"QLED\"; // QLED pur, pas de numéro ajouté\n} else {\n    topicRefresh = \"qpiri\";\n    commandToSend = \"QPIRI\"; // QPIRI pur\n}\n\n// Timer 1 seconde pour envoyer le message\nsetTimeout(() => {\n    // Calcul CRC correct sur la commande ASCII\n    let commandHex = Buffer.from(commandToSend).toString('hex'); \n    msg.payload = commandHex + crc16(command).toString(16) + \"0D\"; \n    msg.topic = topicRefresh;\n    msg.payload = Buffer.from(msg.payload, \"hex\");\n\n    node.send(msg);\n}, 1000);\n\n\n\n\n\n//Fonction de calcul crc16 XModem\nfunction crc16(str, crc = 0, xorout = 0) {\n    for(let i = 0, t; i < str.length; i++, crc &= 0xFFFF) {\n        t = (crc >> 8) ^ str.charCodeAt(i);\n        t ^= t >> 4;\n        crc = (crc << 8) ^ (t << 12) ^ (t << 5) ^ t;\n    }\n    return crc ^ xorout;\n}\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "a39e83cd73162cb3",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-node-serialport": "2.0.3"
        }
    }
]